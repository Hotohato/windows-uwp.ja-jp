---
author: normesta
Description: This article lists things you need to know before packaging your desktop application. You may not need to do much to get your app ready for the packaging process.
Search.Product: eADQiWindows 10XVcnh
title: デスクトップ アプリケーション (デスクトップ ブリッジ) のパッケージを準備します。
ms.author: normesta
ms.date: 05/18/20188
ms.topic: article
keywords: Windows 10, UWP
ms.assetid: 71a57ca2-ca00-471d-8ad9-52f285f3022e
ms.localizationpriority: medium
ms.openlocfilehash: 3a0b3a9f5ce7c03b8add9cc459bade684b9daf21
ms.sourcegitcommit: 144f5f127fc4fbd852f2f6780ef26054192d68fc
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/03/2018
ms.locfileid: "5995543"
---
# <a name="prepare-to-package-a-desktop-application"></a>デスクトップ アプリケーションのパッケージを準備します。

この記事では、デスクトップ アプリをパッケージ化する前に理解しておく必要のあることについて説明します。 アプリケーションをパッケージ化プロセスの準備に多くの作業をする必要はありませんが、以下の項目のいずれか該当する場合、アプリケーション、パッケージ化の前に対処する必要があります。 ライセンスと自動更新は Microsoft Store で処理されるため、これらのタスクに関連した機能はコードベースから削除できます。

>[!IMPORTANT]
>デスクトップ アプリケーションの Windows アプリ パッケージを作成する機能 (それ以外の場合、デスクトップ ブリッジとも呼ばれるは Windows 10 バージョン 1607 で導入されましたし、Windows 10 Anniversary Update (10.0 をターゲットとするプロジェクトでのみ使用できますビルド 14393) 以降の Visual Studio でリリースされます。

+ __アプリケーションには、.NET 4.6.2 より前のバージョンが必要です__。 アプリケーションが .NET 4.6.2 上で実行されているかどうかを確認する必要があります。 4.6.2 より前のバージョンを要求したり、再配布したりすることはできません。 これは、Windows 10 Anniversary Update で出荷された .NET のバージョンです。 このバージョンで、アプリケーションの動作を確認するとにより、アプリケーションは Windows 10 の今後の更新プログラムと互換性が引き続きされます。  アプリケーションが .NET Framework 4.0 以降を対象と .NET 4.6.2 上で実行することを想定していますが、まだテストする必要があります。

+ __管理者特権のセキュリティ権限で常にアプリケーションを実行__します。 アプリケーションは、対話ユーザーとして実行中に動作する必要があります。 Microsoft Store からアプリをインストールするユーザーには、標準ユーザーに対する正しく実行できない方法で管理者特権で実行するアプリケーションを必要とするため、システム管理者しないがあります。 機能の一部で昇格を必要とするアプリは、Microsoft Store では受け入れられません。

+ __アプリケーションは、カーネル モード ドライバーや Windows サービスが必要です__。 ブリッジはアプリには適していますが、システム アカウントで実行する必要があるカーネル モード ドライバーや Windows サービスはサポートしていません。 Windows サービスの代わりに、[バックグラウンド タスク](https://msdn.microsoft.com/windows/uwp/launch-resume/create-and-register-a-background-task)を使います。

+ __アプリのモジュールが、Windows アプリ パッケージに含まれていないプロセスに読み込まれるインプロセスである__。 これは許可されていません。つまり、[シェルの拡張機能](https://msdn.microsoft.com/library/windows/desktop/dd758089.aspx)などのインプロセスの拡張機能はサポートされていません。 ただし、同じパッケージに 2 つのアプリが含まれている場合に、そのアプリ間でプロセス間通信することはできます。

+ __アプリケーションは、カスタム アプリケーション ユーザー モデル ID (AUMID) を使用__します。 場合は、プロセスは、独自の AUMID を設定する[SetCurrentProcessExplicitAppUserModelID](https://msdn.microsoft.com/library/windows/desktop/dd378422.aspx)を呼び出し、アプリケーション モデル環境/windows アプリ パッケージで生成された AUMID しか使えませんが可能性があります。 カスタムの AUMID を定義することはできません。

+ __アプリが HKEY_LOCAL_MACHINE (HKLM) レジストリ ハイブを変更__します。 しようとしたり、アプリケーションを HKLM キーを作成するか、変更のためのいずれかを開いて、アクセス拒否エラーが発生します。 アプリケーションが独自のプライベート仮想化されたビュー、レジストリのユーザーやマシン全体レジストリ ハイブ (HKLM は) の概念は適用されないので注意してください。 HKLM を使って実現していたことを、HKEY_CURRENT_USER (HKCU) に書き込むなど別の方法で実現する必要があります。

+ __アプリケーションが別のアプリを起動する手段として ddeexec レジストリ サブキーを使用__します。 代わりに、[アプリ パッケージ マニフェスト](https://msdn.microsoft.com/library/windows/apps/br211474.aspx)のさまざまなアクティブ化可能* な拡張機能で構成する DelegateExecute verb ハンドラーの 1 つを使います。

+ __AppData フォルダーまたはレジストリを別のアプリとデータを共有するために、アプリケーションに書き込みます__。 変換後、AppData はローカル アプリ データ ストアにリダイレクトされます。このストアは、各 UWP アプリのプライベート ストアです。

  アプリが HKEY_LOCAL_MACHINE レジストリ ハイブに書き込んだすべてのエントリは、分離されたバイナリ ファイルにリダイレクトされ、アプリケーションが HKEY_CURRENT_USER レジストリ ハイブに書き込んだすべてのエントリは、プライベート ユーザーごと、アプリごとの場所に配置されます。 ファイルとレジストリのリダイレクトの詳細については、「[デスクトップ ブリッジの内側](desktop-to-uwp-behind-the-scenes.md)」をご覧ください。  

  プロセス間データ共有に別の方法を使います。 詳しくは、「[設定と他のアプリ データを保存して取得する](https://msdn.microsoft.com/windows/uwp/app-settings/store-and-retrieve-app-data)」をご覧ください。

+ __アプリケーションが、アプリのインストール ディレクトリに書き込む__。 たとえば、アプリケーションは、exe と同じディレクトリに格納されているログ ファイルに書き込みます。 この書き込みは、サポートされていないため、ローカル アプリ データ ストアなどの別の場所にする必要があります。

+ に __、アプリケーションのインストールがユーザーの操作を必要と__なります。 アプリケーションのインストーラーはサイレントで実行できる必要があり、すべての前提条件をクリーンな OS イメージに既定では存在しないをインストールする必要があります。

+ __アプリケーションが現在の作業ディレクトリを使用__します。 ランタイムでは、パッケージ化されたデスクトップ アプリケーションは、デスクトップで以前に指定したと同じ作業ディレクトリを取得しません。LNK ショートカットです。 適切なディレクトリのことが正しく動作するアプリケーションの重要な場合は、実行時に CWD を変更する必要があります。

+ __アプリで UIAccess が必要__になります。 アプリケーションが UAC マニフェストの `requestedExecutionLevel` 要素で `UIAccess=true` を指定している場合の UWP への変換は現在サポートされていません。 詳しくは、「[UI オートメーション セキュリティの概要](https://msdn.microsoft.com/library/ms742884.aspx)」をご覧ください。

+ __アプリケーションは、COM オブジェクトを公開__します。 パッケージ内のプロセスと拡張機能は、インプロセスとアウト プロセス (OOP) の両方で、COM サーバーおよび OLE サーバーを登録して使用できます。  Creators Update では、Packaged COM のサポートが追加されています。これにより、パッケージ外部で表示されるようになった OOP COM サーバーおよび OLE サーバーを登録できるようになります。  [COM サーバーおよび OLE ドキュメントのデスクトップ ブリッジ用サポート](https://blogs.windows.com/buildingapps/2017/04/13/com-server-ole-document-support-desktop-bridge/#bjPyETFgtpZBGrS1.97)に関するブログをご覧ください。

   Packaged COM のサポートは、既存の COM API に使用できますが、Packaged COM の場所はプライベートであるため、レジストリの読み取りに直接依存するアプリケーションの拡張機能には使用できません。

+ __アプリケーションが他のプロセスで使用するための GAC アセンブリを公開__します。 現在のリリースで、アプリケーションは、Windows アプリ パッケージ外部の実行可能ファイルから生成されたプロセスで使用する GAC アセンブリを公開することはできません。 パッケージ内のプロセスは、通常どおり、GAC アセンブリを登録して使用できますが、外部からは認識されません。 つまり、OLE などの相互運用機能のシナリオは、外部プロセスによって呼び出された場合、機能しません。

+ __アプリがサポートされていない方法では、C ランタイム ライブラリ (CRT) にリンク__しています。 Microsoft C/C++ ランタイム ライブラリは、Microsoft Windows オペレーティング システムのプログラミングのルーチンを提供します。 これらのルーチンは、C および C++ 言語では提供されない、多くの一般的なプログラミング タスクを自動化します。 アプリで C/C++ ランタイム ライブラリを使用している場合は、サポートされている方法でリンクされていることを確認する必要があります。

    Visual Studio 2017 は、現在のバージョンの CRT に対して、コードで共通の DLL ファイルを使用できるようにするダイナミック リンクと、コードに直接ライブラリをリンクするスタティック リンクの両方をサポートしています。 可能であれば、アプリケーションの使用をダイナミック リンク VS 2017 をお勧めします。

    以前のバージョンの Visual Studio でのサポートは異なります。 詳しくは、次の表をご覧ください。

    <table>
    <th>Visual Studio のバージョン</td><th>ダイナミック リンク</th><th>スタティック リンク</th></th>
    <tr><td>2005 (VC 8)</td><td>サポートされない</td><td>サポートされる</td>
    <tr><td>2008 (VC 9)</td><td>サポートされない</td><td>サポートされる</td>
    <tr><td>2010 (VC 10)</td><td>サポートされる</td><td>サポートされる</td>
    <tr><td>2012 (VC 11)</td><td>サポートされる</td><td>サポートされない</td>
    <tr><td>2013 (VC 12)</td><td>サポートされる</td><td>サポートされない</td>
    <tr><td>2015 および 2017 (VC 14)</td><td>サポートされる</td><td>サポートされる</td>
    </table>

    注: いずれの場合も、最新の公開されている CRT にリンクする必要があります。

+ __アプリケーションをインストールし Windows のサイド バイ サイド フォルダーからアセンブリを読み込みます__。 たとえば、アプリケーションでは、C ランタイム ライブラリ VC8 または VC9 を使用しは動的にリンク Windows サイド バイ サイド フォルダーから、つまり、コードが共有フォルダーから共通の DLL ファイルを使用しています。 これはサポートされていません。 再頒布可能なライブラリ ファイルをコードに直接リンクして、静的にリンクする必要があります。

+ __アプリケーションが System32/SysWOW64 フォルダーで依存関係を使用__します。 DLL が機能するためには、Windows アプリ パッケージの仮想ファイル システム部分にそれらの DLL を含める必要があります。 これにより、アプリケーションが、Dll が**System32**にインストールされていたかのように動作する/**SysWOW64**フォルダー。 パッケージのルートで **VFS** という名前のフォルダーを作成します。 そのフォルダー内に、**SystemX64** フォルダーと **SystemX86**フォルダーを作成します。 **SystemX86** フォルダーに DLL の 32 ビット バージョンを格納し、**SystemX64** フォルダーに 64 ビット バージョンを格納します。

+ __アプリが VCLibs フレームワーク パッケージを使っている__。 VCLibs 11 ライブラリは、Windows アプリ パッケージで依存関係として定義されている場合、Microsoft Store から直接インストールできます。 たとえば、アプリが Dev11 VCLibs パッケージを使用した場合、次に変更を加えるアプリケーション パッケージのマニフェスト: 下、`<Dependencies>`ノードを追加します。  
`<PackageDependency Name="Microsoft.VCLibs.110.00.UWPDesktop" MinVersion="11.0.24217.0" Publisher="CN=Microsoft Corporation, O=Microsoft Corporation, L=Redmond, S=Washington, C=US" />`  
Microsoft Store からインストールするとき、アプリをインストールする前に VCLibs フレームワークの適切なバージョン (x86 または x64) がインストールされます。  
サイドローディングによって、アプリケーションがインストールされている場合、依存関係がインストールしないされます。 コンピューター上に依存関係を手動でインストールするには、デスクトップ ブリッジ用の適切な VCLibs フレームワーク パッケージをダウンロードしてインストールする必要があります。 これらのシナリオについて詳しくは、[Centennial プロジェクトで Visual C++ ラインタイムを使用する方法に関するページ](https://blogs.msdn.microsoft.com/vcblog/2016/07/07/using-visual-c-runtime-in-centennial-project/)をご覧ください。

  **フレームワーク パッケージ**:

  * [デスクトップ ブリッジ用の VC 14.0 フレームワーク パッケージ](https://www.microsoft.com/download/details.aspx?id=53175)
  * [デスクトップ ブリッジ用の VC 12.0 フレームワーク パッケージ](https://www.microsoft.com/download/details.aspx?id=53176)
  * [デスクトップ ブリッジ用の VC 11.0 フレームワーク パッケージ](https://www.microsoft.com/download/details.aspx?id=53340)


+ __アプリケーションにカスタム ジャンプ リストが含まれています__。 ジャンプ リストを使用する場合は、いくつかの問題と注意事項があります。

    - __アプリのアーキテクチャが OS と一致しない。__  ジャンプ リスト現在正しく機能していないアプリケーションと OS のアーキテクチャが一致しない場合 (x86、x64 で実行されているアプリケーション Windows)。 この時点ではありません回避策以外のアーキテクチャを一致アプリケーションを再コンパイルします。

    - __アプリケーションがジャンプ リストの項目を作成し[icustomdestinationlist:](https://msdn.microsoft.com/library/windows/desktop/dd378403(v=vs.85).aspx)または[SetCurrentProcessExplicitAppUserModelID](https://msdn.microsoft.com/library/windows/desktop/dd378422(v=vs.85).aspx)を呼び出します__。 プログラムによって AppID をコードに設定しないでください。 そうすると、ジャンプ リストの項目が表示されません。 アプリケーションは、カスタム Id が必要な場合は、マニフェスト ファイルを使用してを指定します。 手順については、[デスクトップ アプリケーションを手動でパッケージ](desktop-to-uwp-manual-conversion.md)を参照してください。 アプリケーションの AppID は *YOUR_PRAID_HERE* セクションに指定されます。

    - __アプリケーションは、パッケージの実行可能ファイルを参照するジャンプ リスト シェル リンクを追加__します。 ジャンプ リストから直接、パッケージ内の実行可能ファイルを起動することはできません (アプリ自体の .exe の絶対パスを使用する場合は除く)。 代わりに、(これは、パスで同じように、キーワードを使って開始する場合は、パッケージ化されたデスクトップ アプリケーションをにより) アプリの実行エイリアスを登録し、代わりに、エイリアス リンク先のパスを設定します。 AppExecutionAlias 拡張機能の使用方法について詳しくは、 [Windows 10 によるデスクトップ アプリケーションの統合](desktop-to-uwp-extensions.md)を参照してください。 元の .exe に一致するジャンプ リストのリンク アセットが必要な場合は、他のカスタム項目と同様に、[**SetIconLocation**](https://msdn.microsoft.com/library/windows/desktop/bb761047(v=vs.85).aspx) を使用してアイコンなどのアセットを設定し、PKEY_Title を使用して名前を表示します。

    - __アプリケーションは、絶対パスを使用して、アプリのパッケージ内のアセットを参照するジャンプ リストの項目を追加__します。 アプリケーションのインストール パスには、そのパッケージ更新されると、アセット (アイコン、ドキュメント、実行可能ファイル、およびなど) などの位置の変更を変更できます。 ジャンプ リストの項目は、絶対パスを指定には、このようなアセットを参照する場合、アプリケーションがそのジャンプ リストを定期的に (アプリケーションの起動時など) を更新する必要がありますパスが正しく解決されるようにします。 または、UWP [**Windows.UI.StartScreen.JumpList**](https://msdn.microsoft.com/library/windows/apps/windows.ui.startscreen.jumplist.aspx) API を使用します。この API では、package-relative ms-resource URI スキーマ (これは言語、DPI、ハイ コントラストにも対応します) を使用して、文字列アセットと画像アセットを参照できます。

+ __アプリケーションがタスクを実行するユーティリティを開始__します。 PowerShell や Cmd.exe など、コマンド ユーティリティの起動は避けてください。 実際には、ユーザーは、Windows 10 S を実行するシステム上にアプリケーションをインストールする場合、アプリケーションできませんを一切起動します。 Windows 10 秒と互換性が必要なすべてのアプリを Microsoft ストアに提出するため、Microsoft Store に申請からアプリケーションがブロックされる可能性がこの

ユーティリティの起動は、オペレーティング システムからの情報の取得、レジストリへのアクセス、システム機能へのアクセスなどを行うための手段として便利であることが少なくありません。 ただし、このような作業を実行するには、代わりに UWP API を使用することができます。 これらの Api は、実行するには別に実行可能ファイルは必要ありませんが、さらに重要なアプリケーションとパッケージ外に到達から続けるために、高パフォーマンスのします。 アプリの設計の分離、信頼性、セキュリティ パッケージ化して、アプリケーションの Windows 10 秒を実行しているシステムでは正しく動作するアプリケーションに付属するいると一貫性を維持します。

+ また __、アプリケーションのホストで、アドイン、プラグイン、アドイン、または拡張機能__します。   多くの場合、COM スタイルの拡張機能は、引き続き動作します。ただし、拡張機能がパッケージ化されておらず、完全信頼としてインストールされている場合に限られます。 これらのインストーラーが、完全に信頼できる機能を使用してレジストリを変更し、ホスト アプリケーションがそれらを参照する場合は、いつでも、拡張ファイルを配置するためです。

   ただし、これらの拡張機能は、パッケージ化、Windows アプリ パッケージとしてインストールされた場合、正しく動作しません (ホスト アプリケーションと拡張機能) は、各パッケージが相互の分離されるためです。 に関する詳細をどのようにアプリケーションはシステムから分離された、[デスクトップ ブリッジの内側](desktop-to-uwp-behind-the-scenes.md)を参照してください。

 Windows 10 S を実行するシステムにユーザーがインストールするすべてのアプリケーションおよび拡張機能は、Windows アプリ パッケージとしてインストールされる必要があります。 したがって、拡張機能をパッケージ化する、またはパッケージ化を奨励する場合、ホスト アプリケーションのパッケージと拡張機能パッケージをすべての間の通信を容易に可能性がありますか検討してください。 1 つの方法として、[アプリ サービス](../launch-resume/app-services.md)を使用することもできます。

+ __アプリケーションがコードを生成__します。 アプリケーションは、メモリ内消費されるコードを生成できますが、ディスクに生成されたコードを避けるため、Windows アプリ認定プロセスがアプリの申請する前に、そのコードを検証できないためです。 Windows 10 秒を実行するシステムでディスクにコードを記述するアプリを正しく動作しませんも、Windows 10 秒と互換性が必要なすべてのアプリを Microsoft ストアに提出するため、Microsoft Store に申請からアプリケーションがブロックされる可能性がこの

>[!IMPORTANT]
> Windows アプリ パッケージを作成したら、Windows 10 秒を実行するシステムで正しく動作するために、アプリケーションをテストしてください。すべてのアプリを Microsoft Store に提出する必要があります互換性がある互換性のない Windows 10 秒アプリはストアの受け入れられません。 「[Windows アプリの Windows 10 S 対応をテストする](desktop-to-uwp-test-windows-s.md)」をご覧ください。

## <a name="next-steps"></a>次のステップ

**質問に対する回答を見つける**

ご質問がある場合は、 Stack Overflow でお問い合わせください。 Microsoft のチームでは、これらの[タグ](http://stackoverflow.com/questions/tagged/project-centennial+or+desktop-bridge)をチェックしています。 [こちら](https://social.msdn.microsoft.com/Forums/en-US/home?filter=alltypes&sort=relevancedesc&searchTerm=%5BDesktop%20Converter%5D)から質問することもできます。

**フィードバックの提供または機能の提案を行う**

[UserVoice](https://wpdev.uservoice.com/forums/110705-universal-windows-platform/category/161895-desktop-bridge-centennial) のページをご覧ください。

**デスクトップ アプリの Windows アプリ パッケージを作成する**

「[Windows アプリ パッケージを作成する](desktop-to-uwp-root.md#convert)」をご覧ください。
