---
title: RTA のベスト プラクティス
author: KevinAsgari
description: Xbox Live リアルタイム アクティビティ サービスを使うときのベスト プラクティスについて説明します。
ms.assetid: 543b78e3-d06b-4969-95db-2cb996a8bbd3
ms.author: kevinasg
ms.date: 04/04/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: xbox live, xbox, ゲーム, uwp, windows 10, xbox one, リアルタイム アクティビティ
ms.localizationpriority: medium
ms.openlocfilehash: a80d25ee14ada799bce5d9e341869522e600e6a5
ms.sourcegitcommit: 1c6325aa572868b789fcdd2efc9203f67a83872a
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/17/2018
ms.locfileid: "4749037"
---
# <a name="real-time-activity-rta-best-practices"></a>リアルタイム アクティビティ (RTA) のベスト プラクティス
これらのベスト プラクティスにより、タイトルで RTA を最大限に活用できます。


## <a name="the-basics"></a>基本

RTA は、WebSocket セッションを使用してクライアントとの固定接続を作成します。 それにより、サービスは統計情報をデベロッパーに提供します。 クライアントは認証接続要求を送信する必要があり、RTA は、その要求で提供されたトークンを使用して接続を作成できることを確認し、接続を確立します。

接続が確立されると、アプリケーションは特定の統計情報のサブスクライブを要求できます。 サブスクリプションが成功すると、RTA は、応答のペイロードとして、現在の値といくつかの追加のメタデータ (統計情報の型など) を返します。 その後、RTA は、クライアントのサブスクライブ中にその統計情報に更新が発生すれば、その更新情報を送信します。

タイトルがリアルタイムでの統計情報の更新を必要としない場合は、その統計情報に対するサブスクリプションを終了する必要があります。


## <a name="handling-disconnects"></a>切断の処理

タイトルは、ユーザーの認証トークンが期限切れになるとサービスによってセッションが終了されることを認識しておく必要があります。 タイトルは、そのようなイベントの発生を検出し、再接続して、それまでサブスクライブしていたすべての統計情報を再度サブスクライブする必要があります。

RTA の接続は、設計上、再接続するクライアントを強制的に 2 時間後閉じられます。 これは、メッセージの帯域幅に保存する接続の認証トークンがキャッシュされるためです。 最終的にトークンの期限が切れます。 接続を閉じると、強制的に再接続してクライアントが強制的に認証トークンを更新します。

クライアントは、ユーザーの ISP に問題がある場合、またはタイトルのプロセスが一時停止された場合にも切断されることがあります。 この切断が発生した場合は、クライアントに知らせるために WebSocket イベントが発生します。 通常は、サービスから切断を処理できるようにすることが最良の方法です。

> [!WARNING]
> クライアントがマルチプレイヤー セッションは、RTA を使用して、30 秒間の切断された場合は、[マルチプレイヤー セッション Directory(MPSD)](../multiplayer/multiplayer-appendix/multiplayer-session-directory.md) RTA セッションが閉じられ、セッションからユーザーが開始を検出します。 RTA クライアントが接続が閉じられたときに検出、再接続を開始し、MPSD セッションを終了する前にサブスクライブすることです。

## <a name="managing-subscriptions"></a>サブスクリプションの管理

トークンが期限切れになったときのサブスクリプションの管理に関して、タイトルは、どのサブスクリプションが作成されたかを常に追跡する必要があります。 サブスクリプションが成功すると、RTA は、サブスクライブされた各統計情報の一意の識別子を返します。 その統計情報に対するその後のすべての更新では、統計情報の名前ではなくこの識別子が使用されます。 これは、帯域幅を節約するためです。 クライアントは、統計情報と RTA のサブスクリプション ID の自身のマッピングを維持する必要があります。


## <a name="unsubscribing"></a>サブスクライブ解除

使用されていないサブスクリプションを保持することはお勧めできません。 サービスでは、ユーザーがタイトルごとに一度に保持できるサブスクリプション数に制限があります。 何から何までサブスクライブしていると、その制限に達する可能性があり、そのために一部の重要な統計情報をサブスクライブできなくなる可能性があります  (サブスクリプションの制限の詳細については、この後の「**調整**」を参照してください)。

たとえば、タイトルでは特定のシーンに対するサブスクリプションのみが必要であるとします。 ユーザーがそのシーンに入ったときに、タイトルはサブスクライブする必要があります。 ユーザーがそのシーンを離れたときには、それらの統計情報のサブスクライブを解除する必要があります。 また、サブスクリプションを一切必要としない場合は unsubscribe-all メッセージを使用できます。

サブスクライブの解除後、その統計情報のサブスクリプション ID は使用されなくなります。


## <a name="awareness-of-latent-items-in-the-queue"></a>キュー内の潜在項目について

統計情報のサブスクライブ解除時に、その統計情報の更新があるにもかかわらずそれがクライアントにまだ届いていない場合があります。 そのため、タイトルが統計情報のサブスクライブを解除しても、その統計情報に関する 1 ～ 2 個の更新をまだ受け取る可能性があることに注意してください。

サブスクリプション ID を認識できない場合は、その統計情報の更新を無視することをお勧めします。


## <a name="ignore-messages-you-do-not-understand"></a>理解できないメッセージは無視する

メッセージ プロトコルは更新される可能性があります。 アプリケーションが新しいメッセージに縛られないようにするために、タイトルでは、不明な種類のメッセージはそのまま破棄することをお勧めします。


## <a name="throttles"></a>調整

RTA はサービスに対して一定の調整を行います。

-   UserStats: 1000
-   Presence: 2500

調整の制限に達すると、クライアントはサブスクライブ/サブスクライブ解除呼び出しの一部としてエラーを受け取るか、または切断されます。 どちらの場合も、エラー メッセージまたは切断メッセージと共に、到達した調整の制限に関する詳細情報がクライアントに提供されます。

タイトルの開発時には、これらの概念を心に留めておいてください。 何か極端なことをしようとすると、サービスが呼び出しを制限する可能性があるため、アプリケーションのエクスペリエンスが低下する場合があります。 現在、サービスではアプリケーションのインスタンスあたり、統計情報に対する 1000 個のサブスクリプションが認められています。 それに加えて、アプリケーションのインスタンスでは、プレゼンスの更新のためにユーザーのユーザー リスト全体をサブスクライブすることもできます。 この数は調整中であり、今後のリリースで変更される可能性があります。
