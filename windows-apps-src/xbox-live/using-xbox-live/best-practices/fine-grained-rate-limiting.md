---
title: Xbox Live のきめ細かなレート制限
description: Xbox Live のきめ細かなレート制限のしくみと、タイトルがレート制限されないようにする方法について説明します。
ms.assetid: ceca4784-9fe3-47c2-94c3-eb582ddf47d6
ms.date: 04/04/2017
ms.topic: article
keywords: xbox live, xbox, ゲーム, uwp, windows 10, xbox one, スロットリング, レート制限
ms.localizationpriority: medium
ms.openlocfilehash: b79a4f0a873ffaf5dd824a0c9832f61aa4a7d77f
ms.sourcegitcommit: 49d58bc66c1c9f2a4f81473bcb25af79e2b1088d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/11/2018
ms.locfileid: "8919054"
---
# <a name="xbox-live-fine-grained-rate-limiting"></a>Xbox Live のきめ細かなレート制限

## <a name="introduction"></a>概要

この記事では、Xbox Live のきめ細かなレート制限 (Fine Grained Rate Limiting: FGRL) の概要を示します。 この記事では、レート制限とは何かを要約することに加えて、制限が適用されているかどうかの判断や、制限が適用されている場合に活用できるツールやリソースの判断に役立つ情報を提供します。

## <a name="terminology-guide"></a>用語ガイド

| 用語         | 定義                                                  |
|--------------|-----------------------------------------------------------------------------
| FGRL         | きめ細かなレート制限                                                  
| XSAPI        | Xbox Services アプリケーション プログラム インターフェイス                                 
| CU           | コンテンツ アップデート                                                              
| バースト        | 短い期間のうちに受け取った要求の量を表します          
| サステイン      | ある期間にわたって絶え間なく受信される大量の呼び出しを表します
| ユーザー + タイトル | ユーザーとタイトルのペアリングを 1 つのエンティティとして表します                    
| XLTA         | Xbox Live Trace Analyzer ツール。タイトルのレートが制限されているかどうかを判断するために使用されます。

## <a name="xbox-live-fine-grained-rate-limiting"></a>Xbox Live のきめ細かなレート制限

**きめ細かなレート制限**は、さまざまなタイトル間で共有される Xbox Live リソースの**公平な使用**を促進するために導入されました。 このソリューションはほとんどの伝統的な制限システムに似ており、あるエンティティが所定の期間内に行った要求数のカウントをサービスに保持させます。

サービスで指定された制限に達したエンティティは拒否状態に移行され、そのエンティティからのすべての着信要求が却下されるようになります。 所定の期間が終了し、エンティティと関連付けられたカウントがリセットされてはじめて、エンティティはこの状態を脱することができます。

きめ細かなレート制限では、前述したものと同じコア構造を使用しますが、1 つのエンティティを追跡する代わりに、FGRL は**ユーザーとタイトル**の組み合わせを追跡し、関連付けられたカウントを 1 つではなく **2 つの**異なる**制限**と比較します。 FGRL の二重制限はサービスごとに施行されます。つまり、GameClips の要求カウントが Presence の要求カウントに影響を及ぼすことはありません。 以下のセクションでは、ユーザーとタイトルのペアリング、二重制限、HTTP 429 制限応答オブジェクトについて詳しく説明します。

## <a name="fair-usage"></a>公平な使用

どのようなゲームやアプリをユーザーがプレイしていても、同じ高品質のエクスペリエンスが個々のユーザーに提供されるべきだというのが Xbox Live の考えです。 FGRL は次のシナリオを解決するために設計されています。

デベロッパー A がリリースしたタイトルはすべての Xbox Live ベスト プラクティスに従っており、サービスの最適な使用が保証されている一方で、デベロッパー B もタイトルをリリースしましたが、こちらのタイトルには未知のバグがあります。 このバグによってタイトルおよび各ユーザーがプレゼンス情報を大量送信し、サービスの負荷が高まります。 サービスは速度が低下し、最終的には停止して、問題を引き起こしたのがデベロッパー B のバグであったにもかかわらず、デベロッパー A のユーザーのエクスペリエンスも損ないます。 FGRL が実装されていたならば、サービスは動作不良タイトルからの要求の受信を停止し、公平に分配されたサービス リソースをデベロッパー A のタイトルに供給できていたでしょう。

## <a name="title-and-user-granularity"></a>タイトルとユーザーの細分度

タイトルとユーザーの組み合わせは、Xbox Live リソースの公平な使用を保証するための鍵として選ばれました。 ユーザーだけの追跡では、ユーザー エクスペリエンスが各タイトルの統合に翻弄されるシナリオが生まれます。 たとえば、ほとんどのタイトルでは People サービスを既に使用していますが、公平な使用という目的のために、5 分間で 100 回までは要求を許容する、きめ細かなレート制限を People サービスに対して設定するとします。 ユーザーがプレイするゲームで 1 分間に 100 回の要求を行った場合、制限を超過し、ユーザーは People サービスに対してそれ以上の要求ができなくなります。同じ期間中にユーザーがホーム画面に戻ってフレンド リストをクリックしますが、既に制限を超えているので、ユーザーが制限状態になったのはホーム画面が原因でないにもかかわらず、5 分の期間が過ぎるまでフレンド リストの呼び出しは失敗します。

タイトルのみに基づいた制限はこれに代わる方法ですが、同じく不公平な結果を生みます。 タイトルごとに制限を設定すると、タイトルの人気度が無視され、ただ単に、制限に達するまで先着順に要求が処理されます。

ユーザーとタイトルのペアリングにより、どのタイトルもアクティブ ユーザー数に応じた適切な量を超えてリソースを使用しない一方で、個々のユーザーには一貫した量のリソースが配分されることが保証されます。

![](../../images/FGRL.png)

上の図は、要求が処理される流れの概要を示しています。 まず、要求が生成され、目的のサービスによって受信されます。 要求を受信したら、システムは、ユーザーとタイトルの総合でサービスにアクセスした回数をチェックします。 制限内に収まっている場合、要求は通常どおり処理されます。 要求が制限以上になっている場合、サービスは要求を破棄し、代わりに 429 応答を返します。 応答では、期間が切り替わってユーザーとタイトルの要求が処理可能になるまでの時間を示します。

## <a name="burst-and-sustain-limits"></a>バーストと持続の制限

従来のレート制限は、所定の期間にわたって追跡されるエンドポイントあたり 1 つの制限で構成されます。 この期間は、エンティティの要求カウントが追跡される時間の長さを表します。 期間が終わるとエンティティのカウントは 0 にリセットされ、再び追跡が始まります。

このアプローチはほとんどの API に対して機能しますが、Xbox Live を呼び出すゲームやアプリにとっての柔軟性は不十分でした。 前述のソリューションは、ユーザーによる呼び出しが、一貫していて、安定的で、予測可能な方法で行われることを想定しています。 Xbox Live のケースでは、サービスおよび要求側のタイトル/アプリごとに、呼び出しパターンが著しく異なります。

このケースでは、1 つの制限だけを使用すると、呼び出しパターン範囲の両端で妥協が必要になります。 Xbox Live のソリューションでは 2 つの期間と制限を使用します。 短いほうの期間をバースト期間、長いほうの期間をサステイン期間と呼びます。 FGRL のバースト期間は常に 15 秒であり、サステイン期間は常に 300 秒 (5 分) です。つまり、5 分のサステイン期間に 20 のバースト期間が含まれます。 バースト制限とサステイン制限はどちらも同時に追跡を行っており、そのような性質上、同時に要求をカウントします。 バースト制限とサステイン制限はどちらもサービスで設定されます。つまり、サービスごとに固有のバースト カウントとサステイン カウントがあります。 これら 2 つの制限がどのように連動するかの理解に役立つよう、次の表では、FGRL を実装したサービスを何度も要求するタイトルをプレイしているユーザーを示します。 このケースでは、バースト制限は 15 秒間に 30 回の要求、サステイン制限は 5 分間に 100 回の要求です。

| 期間 (秒)  | バースト期間内の要求数  | サステイン期間内の要求数  | 15 秒の期間中にスロットルされた要求数 | どちらの制限? (バースト、サステイン、または両方)  |
|-------------|--------------|----------------|-----------------------------------------------------|---------------------------|
| 0-15        | 35           | 35             | 5                                                   | バースト                     |
| 15-30       | 28           | 63             | 0                                                   | 該当なし                       |
| 30-45       | 21           | 84             | 0                                                   | 該当なし                       |
| 45-60       | 36           | 120            | 20                                                  | 両方                      |
| 60-75       | 24           | 144            | 24                                                  | サステイン                   |
| …           | …            | …              |                                                     | …                         |
| 285-300     | 4            | 148            |                                                     | サステイン                   |

表によると、35 回の要求を行ったことにより、ユーザーは最初の 15 秒でバースト制限にかかっています。 超過分の 5 回の要求は破棄され、429 応答が 5 回送信されます。 この 5 回の要求はスロットルされましたが、サステイン制限までのカウントでは引き続き数えられていることに注目してください。 表に示されているように、一度でもどちらかの制限にかかると、両方の制限にかかっている 45 秒からの期間だけでなく、要求が 4 回しか行われていない 285 秒からの期間でも、すべての要求が破棄されています。

## <a name="http-429-response-object"></a>HTTP 429 応答オブジェクト

関連付けられたユーザーとタイトルのカウントがバースト制限またはサステイン制限のどちらか以上になると、サービスは要求の処理をやめ、代わりに HTTP 429 応答を返すようになります。 HTTP 429 コードは "要求が多すぎる" ことを表し、"X 秒後の再試行" を指示する値を含むヘッダーが付属します。 FGRL の 429 応答には、呼び出し側エンティティが再試行までに待たなければならない時間を指定する retry after ヘッダーが含まれます。 再試行までの待ち時間が考慮されて適切に処理されるため、XSAPI を使用するデベロッパーは心配の必要はありません。 実際の応答には以下のフィールドが含まれます。

| フィールド名      | 値の種類 | 例                | 定義                       |
|-----------------|------------|------------------------|----------------------------------|
| Version         | Integer    | `"version":1`          |                                  |
| currentRequests | Integer    | `"currentRequests":13` | 送信された要求の総数    |
| maxRequests     | Integer    | `"maxRequests":10`     | 許可された要求の総数 |
| periodInSeconds | Integer    | `“periodInSeconds”:15` | 期間の長さ                      |
| 種類            | String     | `“type”:”burst”`       | スロットル制限タイプ              |

## <a name="implemented-limits"></a>実装された制限

以下のサービスは FGRL 制限を実装しており、これらの制限は **2016 年 5 月**以降適用されています。 繰り返しますが、これらの制限はすべてのサンドボックスおよびタイトルに共通です。 **Xbox 開発者向けプラットフォームまたはパートナー センター経由で公開され、2016 年前に出荷されたタイトルはレガシーし、したがって除外します。**

| **名前** | **バースト制限** (15 秒間、1 ユーザーおよび 1 タイトルあたり) | **サステイン制限** (300 秒間、1 ユーザーおよび 1 タイトルあたり) | **認定制限** (10x サステイン、300 秒間、1 ユーザーおよび 1 タイトルあたり) |
|----------------------------|---------------------------|----------------------------|----------------------------|
| 統計情報の読み取り                 | 100                       | 300                        | 3000                       |
| プロフィール                    | 10                        | 30                         | 300                        |
| MPSD                       | 30                        | 300                        | 3000                       |
| プレゼンス                   | 読み取り 10、書き込み 3          | 読み取り 100、書き込み 30         | 読み取り 1000、書き込み 300       |
| ソーシャル                     | 10                        | 30                         | 300                        |
| ランキング               | 30                        | 100                        | 1000                       |
| 実績               | 100                       | 300                        | 3000                       |
| スマート マッチ                | 10                        | 100                        | 1000                       |
| ユーザーの投稿                 | 100                       | 300                        | 3000                       |
| 統計情報の書き込み                | 100                       | 300                        | 3000                       |
| プライバシー                    | 10                        | 30                         | 300                        |
| クラブ                      | 10                        | 30                         | 300                        |

上の表は、FGRL の対象に選ばれたサービスの現在のリストを表します。 このリストは最終版ではなく、新しいサービスや既存のサービスが追加される可能性があります。 サービスが追加される場合、表を更新し告知を行います。 表に記載されている制限も最終的なものではありません。 サービスの変更や進化に伴って制限も変更される可能性がありますが、変更時はその旨を告知し、必要なレガシー免除措置を講じます。

**2018 年 4 月**現在、サステイン制限 (レートの制限が有効になる制限) の 10 倍を超えている場合、タイトルは認定されません。  たとえば、上の表で指定されているように、FGRL が有効になるサステイン制限が、300 秒間に 300 の呼び出しに設定されている場合、300 秒間に呼び出しが 3000 以上であるタイトルは認定されません。 

## <a name="service-mapping-and-title-effects-of-rate-limiting"></a>サービスのマッピングとタイトルのレート制限の効果

| **名前** | **サービス エンドポイント** | **予想される FGRL のゲームへの影響**
| --- | :---: | --- 
| 統計情報の読み取り | userstats.xboxlive.com | 実績やランキングのエントリが更新または取得されません。
| プロフィール | profile.xboxlive.com | プレイヤーのデータが正しく更新または表示されません。
| MPSD | sessiondirectory.xboxlive.com | 参加/招待が正常に完了せず、セッションが適切に作成または更新されないため、タイトルのエラーの原因となる場合があります。
| プレゼンス | presence.xboxlive.com | プレイヤーのゲーム内のプレゼンスが不正確になります。
| ソーシャル | social.xboxlive.com | フレンドに関するすべての書き込み (例: フレンドを追加する、フレンドをお気に入りに登録する) に影響し、フレンドに関する読み取り (例: フレンド リストを取得する) に影響する可能性があります。 開発者は、読み取りでは social.xboxlive.com ではなく、peoplehub を呼び出すことをお勧めします。
| ランキング | leaderboards.xboxlive.com | ランキングのゲーム内 UX が設定/更新されません。
| 実績 | achievements.xboxlive.com | ロック解除されている実績のゲーム内 UX が更新されません。
| スマート マッチ | momatch.xboxlive.com | マッチが正常に設定されません。
| ユーザーの投稿 | userposts.xboxlive.com | ユーザーの投稿が表示されません。
| 統計情報の書き込み | statswrite.xboxlive.com | 実績やランキングのエントリが更新されません。
| プライバシー | privacy.xboxlive.com | プライバシー エラーによって、すべての呼び出し元のアクセスがブロックされる可能性があります。
| クラブ | Clubhub.xboxlive.com | プレイヤーがゲーム内のクラブを表示できない可能性があります。

**注:** 最新の API マッピングは定期的に更新されており、[Live Trace Analyzer API マッピングに関するページ](https://github.com/Microsoft/xbox-live-trace-analyzer/blob/master/Source/XboxLiveTraceAnalyzer.APIMap.csv)で参照できます。

## <a name="faq"></a>FAQ

## <a name="how-can-i-determine-i-am-being-throttled-and-what-steps-can-i-take"></a>スロットルされているかどうかの判断方法と可能な対処手順

「[Xbox Live Best Practices](best-practices-for-calling-xbox-live.md)」ドキュメントを参照してください。呼び出しパターンを改善するための手順に加えて、スロットリングの問題を通知および軽減するために XSAPI アサーション、XSAPI Social Manager、XSAPI Multiplayer Manager をどのように使用できるかを説明しています。

Xbox Live 呼び出しのトレースを記録してから、[Xbox Live Trace Analyzer ツール](https://docs.microsoft.com/windows/uwp/xbox-live/tools/analyze-service-calls)を使用して、そのトレースを分析することもできます。  トレースを記録するには、Fiddler を使用して .SAZ ファイルを記録するか、XSAPI の組み込みトレース ログを使用します。 XSAPI でトレースをオンにする方法の詳細については、Xbox Live ドキュメントのページ「Xbox Live サービスへの呼び出しを分析する」を参照してください。 トレースを用意すると、スロットリングされた呼び出しの検出時に Xbox Live Trace Analyzer ツールが警告を発します。

ベスト プラクティス ドキュメントは GDNP から入手でき、1602 以降の SDK および XDK ドキュメントに含まれています。

### <a name="can-limits-change"></a>制限が変更される可能性はありますか。

公表された制限を今後変更する意図はありません。 しかしながら、必要が生じた場合、一部の制限が厳しくなる可能性はあります。その場合、RETAIL にリリース済みのタイトルは、更新された制限の適用が免除されます。

### <a name="are-more-services-going-to-get-limits"></a>制限が適用されるサービスは増えますか。

はい。より多くのサービス、また新しいサービスで制限が導入されます。 しかしながら、この最初の FGRL リリースと同様、必要な告知を行い、適切な予防措置を講じます。

### <a name="when-will-these-changes-take-effect"></a>これらの変更はいつ発効しますか。

レート制限は **2016 年 5 月**以降適用されています。  **2018 年 4 月**現在、指定されたサステイン制限の 10 倍を超えるタイトルは、Xbox 認定プロセスで認定されません。

### <a name="what-if-we-cant-adhere-to-the-limits"></a>制限を守れない場合どうなりますか。

「[Xbox Live Best Practices](best-practices-for-calling-xbox-live.md)」を参照し、必ず、記載されている手順に従ってください。  何らかのソーシャル サービスでレート制限の適用を受けている場合は、[Social Manager](../../social-platform/intro-to-social-manager.md) の使用も検討してください。

これらの手順に従ってもなお、制限を守ることが難しい場合は、担当のデベロッパー アカウント マネージャーにご連絡ください。

**注: 指定されたサステイン制限の 10 倍以上のタイトルは、2018年 4 月以降認定されません**。  たとえば、上の表で指定されているように、FGRL が有効になるサステイン制限が、300 秒間に 300 の呼び出しに設定されている場合、300 秒間に呼び出しが 3000 以上であるタイトルは認定されません。

### <a name="what-about-my-existing-title"></a>既存のタイトルはどうなりますか。

2018 年 4 月以前に RETAIL にあったタイトルはレガシーとみなされ、制限が免除されます。

### <a name="content-updates"></a>コンテンツ アップデートはどうですか。

レガシーまたは適用免除タイトルについてはコンテンツ アップデートも免除対象になりますが、ゲームのサービス統合部分を最適化するためのツールおよびアセットを利用することを強くお勧めします。

### <a name="can-i-get-an-exemption-for-my-game-until-i-can-make-a-content-update"></a>コンテンツ アップデートが可能になるまでの間、ゲームへの適用免除を申請できますか。

担当のデベロッパー アカウント マネージャーにお問い合わせください。
