---
title: ゲーム セッションの可視性と参加可能性
author: KevinAsgari
description: Xbox Live ゲーム セッションおよびゲーム パーティーの可視性と参加可能性について説明します。
ms.assetid: 39b6dac1-0c6b-4dc1-9fe0-3cb7c471fbab
ms.author: kevinasg
ms.date: 04/04/2017
ms.topic: article
keywords: xbox live, xbox, ゲーム, uwp, windows 10, xbox one
ms.localizationpriority: medium
ms.openlocfilehash: c039a2c78824de64c503786d911bb3427e53cf64
ms.sourcegitcommit: cd00bb829306871e5103db481cf224ea7fb613f0
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/01/2018
ms.locfileid: "5865308"
---
# <a name="game-session-and-game-party-visibility-and-joinability"></a>ゲーム セッションおよびゲーム パーティーの可視性と参加可能性

Xbox One では、ゲーム セッションに対する*可視性*およびゲーム パーティーに対する*参加可能性*によってマルチプレイヤー エクスペリエンスに対するアクセスが制御されます。 セッションへの参加およびゲーム セッションやパーティーへのプレイヤーの招待に対して優れたユーザー エクスペリエンスを提供するには、タイトル デベロッパーはこれらの設定を理解する必要があります。 このホワイト ペーパーでは、可視性と参加可能性の違い、およびユーザーに最善のマルチプレイヤー ユーザー フローを提供するためにタイトルで使用することが推奨される具体的な設定について説明します。

## <a name="game-session-visibility"></a>ゲーム セッションの可視性


マルチプレイヤー セッション ディレクトリ (MPSD) のセッション アクセスは、セッションの*可視性*とセッションの*参加可能性*という 2 つの設定によって制御されます。 これらの設定を使用すると、セッションへのアクセスを MPSD レベルで制限できます。

1 番目のアクセス制御方法はセッションの可視性です。 セッションの可視性は、セッションの作成時に設定される定数です。 この定数は、通常、セッション テンプレートで定義され、セッションに対する読み取りアクセスと書き込みアクセスができるユーザーの種類を決定します。 可視性設定の値は次のとおりです。

-   *Open* - すべてのユーザーがセッションを読み書きできます。

-   *Visible* - セッションの読み取りはすべてのユーザーが可能ですが、セッションの書き込みは参加済みで予約済みのプレイヤーだけが可能です。

-   *Private* - 参加済みで予約済みのプレイヤーだけがセッションを読み書きできます。

> **注意:** 可視性を private に設定すると、招待されたプレイヤーは **join()** を繰り返し呼び出すことが必要になる場合があります。 招待がプラットフォーム UI を介して送信される場合は、そのプレイヤーがセッションで予約される前に、他のプレイヤーがそれを受信する可能性があります。 このような競合状態では、参加しているプレイヤーに対する予約がプライベート セッションまたは可視セッションで必要になるため、招待されたプレイヤーに対する **join()** の呼び出しが失敗する場合があります。
>
> 予約が存在しない場合、セッションでアクセス エラー (HTTP/403) が発生します。 その場合、招待されたプレイヤーは **join()** 操作を繰り返す必要がありますが、5 秒間隔以上の頻度では再試行しないようにする必要があります。 プレイヤーに対する参加フローの間の競合状態を避けるため、タイトルではセッション可視性を open に設定することをお勧めします。

## <a name="game-session-joinability"></a>ゲーム セッションの参加可能性


2 番目のアクセス制御方法は参加可能性です。 参加可能性は、セッションの有効期間の間に動的に設定でき、セッションに参加できるユーザーの種類を決定します。 セッション joinabilityare の値:

-   *なし* (既定値) - セッションに参加できるユーザーに制限はありません。

-   *Local* - ローカル ユーザーのみがセッションに参加できます。

-   *Followed* - ローカル ユーザーおよび他のセッション メンバーによってフォローされているユーザーのみが、予約なしでセッションに参加できます。

セッション ホストまたはアービターは、参加可能性の設定を使用してプライベート セッションを作成できます。参加可能性を Local または Followed にすると、ゲーム セッションへのアクセスを制限してプライベートにできます。

さらに、必要に応じて古いセッション招待をホスト レベルで拒否できるように、セッション ホストまたはアービターはセッションの参加可能性を追跡する必要があります。 たとえば、セッションがいっぱいになるまでに招待されたプレイヤーがセッションまたはパーティーに参加するために到着しなかった場合、ホストまたはアービターは、参加しているプレイヤーに対し、セッションがロックされたため、セッションおよびパーティーから自動的に離脱する必要があることを指示できます。

**注意:** ゲーム セッションの参加可能性は、パーティー アプリの UI には反映されません。 参加可能性が制限されている場合であっても、パーティー アプリの招待 UI および **ShowSendInvitesAsync** はゲーム セッションの招待を許可します。

## <a name="game-party-joinability"></a>ゲーム パーティーの参加可能性


MPSD セッションの制御に加えて、タイトルはゲーム パーティーの参加可能性状態を制御することもできます。 この設定を使用して、ゲーム パーティーのアクセスをパーティー レベルで制限できます。

ゲーム パーティーを作成した後は、パーティーの参加可能性を動的に変更できます。 ゲーム パーティーの参加可能性の状態はパーティー招待 UI に反映されます。 次の値に設定できます。

-   *Invite-only* - ゲーム パーティーに参加するためには招待が必要です。

-   *Joinable by Friends* (既定値) *—* プレイヤーがゲーム パーティーに参加するためにはフレンド関係が必要です (パーティーに参加するには、パーティー メンバーが参加しているプレイヤーをフォローしている必要があります)。

参加可能性を使用して招待のみのゲーム パーティーを作成できます。 パーティーへのアクセスを制限し、プレイヤーが参加するための招待を受け取ることを必須にするには、参加可能性を "招待のみ" に設定する必要があります。

**注意:** パーティーの参加可能性はセッションの参加可能性に影響を与えませんが、パーティーの参加可能性はパーティー アプリの UI に反映されます。 プレイヤーは、タイトルの外部でパーティー アプリのパーティーの参加可能性を手動で変更できます。

## <a name="recommendations"></a>推奨事項


以下の推奨事項は、最も一般的なタイトル シナリオに適用されます。 タイトルは、可能であればこれらの設定に従う必要があり、新しいプレイヤーがセッションで許可されるかどうかに関する最終的で正式な決定を、タイトル内ロジックを使用して行う必要があります。

### <a name="recommended-game-session-visibility-open"></a>ゲーム セッションの推奨される可視性: open

オープン状態のゲーム セッションではプレイヤーの予約が必要なく、招待のフローが簡単になります。 招待が送信された後、セッション ホストまたはアービターはプレイヤーをセッション ドキュメントで予約しません。 セッション ホストまたはアービターは、代わりに、招待されたプレイヤーをローカルにのみ追跡します。 これにより、プレイヤーはホストにすぐに接続し、セッションに参加する必要があるかどうか、拒否されたかどうか、待機する必要があるかどうか (待機プレイヤーがサポートされる場合) を判別できます。 アービターまたはホストは最終的な権限であり、新しいメンバーにセッションに留まるか退出するかを応答および指示します。

**注意:** 招待されたプレイヤーは、最終的な決定が行われる前に、タイトルを起動してホストまたはアービターに接続する必要があります。 セッションに空きがない場合、または招待が拒否された場合は、ユーザーにエラー メッセージを表示してもかまいません。

> **注意:** ホストまたはアービターへの接続を確立するには、セキュア デバイス アドレスが必要です。 どのセッション メンバーがセッションの現在のホストまたはアービターか、および招待されたプレイヤーがどのセキュア デバイス アドレスに接続する必要があるかということは、セッションの **HostDeviceToken** を使用して示す必要があります。

### <a name="recommended-game-session-joinability-default-not-set"></a>推奨されるゲーム セッションの参加可能性: 既定 (*設定しない*)

現在、ゲーム セッションの参加可能性はパーティー アプリ UI に反映されず、ユーザーには表示されません。 タイトルのフローを単純にするため、ゲームの参加可能性は既定値のままにする必要があり、すべての参加権限はアービターまたはホストによって処理される必要があります。

### <a name="recommended-game-party-joinability"></a>ゲーム パーティーの推奨される参加可能性

ゲーム パーティーの参加可能性は、タイトルがユーザーに提供しようとしているセッションの種類に依存します。 次の 2 つのシナリオがあります。

-   Open game - オープン状態のゲームの場合、ゲーム パーティーの参加可能性は、既定値 (Joinable by Friends) のままにする必要があります。 これにより、フレンドは招待がなくてもゲーム パーティーに (および拡張によってゲーム セッションに) 参加できます。

-   Private game - プライベート状態またはクローズド状態のゲームの場合、ゲーム パーティーの参加可能性は Invite-only に設定する必要があります。 これは、招待なしでの他のプレイヤーによるパーティー (および拡張によるゲーム セッション) への参加を制限します。

**注意**: プレイヤーは、パーティー アプリを使用してゲーム セッションの参加可能性を手動で変更できます。

どちらの種類のゲームについても、アービターまたはホストはセッションへの参加を許可されるユーザーを決定する最終的な権限であり続ける必要があります。 これにより、open から private にゲーム フローを切り替えることで発生する可能性がある競合状態を解決します。 アービター/ホストがプレイヤーを拒否した場合、拒否されたタイトル インスタンスは、そのプレイヤーをセッションから削除し、プレイヤーがパーティーを離れることもできるようにするためのゲーム内 UI を表示する必要があります。

### <a name="maximum-session-size"></a>セッションの最大サイズ

セッションの最大メンバー サイズを使用して、ゲーム セッションに参加するプレイヤーの数を制限できます。 ただし、この方法で制限すると、特定の切断シナリオの間に空きスポットが埋まっているものと表示されることがあります。 たとえば、ネットワークまたは電源の障害によりプレイヤーが切断された場合、遅延はセッションに直ちに反映されません。 プレゼンス サービスが切断を検出すると直ちに (最大 20 秒) メンバーは非アクティブに設定され、非アクティブ タイムアウトが過ぎるとプレイヤーは削除されます。

一方、ハートビートを使用して切断を検出するピア メッシュは、通常、2 ～ 3 秒以内に切断を認識して、プレイヤー スロットをすぐに空けることができます。 ただし、アービターまたはホストは他のメンバーを削除できません。

この問題に対処するには、セッション メンバーの最大サイズを常に、タイトルが実際にサポートしているプレイヤーの最大数よりも大きい値に設定する必要があります。 たとえば、プレイヤー数が 8 の場合、最大セッション サイズを 12 などと設定する必要があります。 こうすると、古いプレイヤーがまだタイムアウトしていない場合でも、新しいプレイヤーが参加できます。アービターまたはホストは、セッションに空きがないかどうかを判別し、新しいプレイヤーがまだ参加できるかどうかを決定するカスタム セッション プロパティを設定します (**IsFull** : “true”)。 これにより、セッションが参加可能かどうかを参加しているプレイヤーがすばやくチェックできます。

また、アービターまたはホストは、タイムアウトしたメンバーをインデックスで示すカスタム プロパティも保持する必要があります (例: **TimedOutPlayers** : “3, 5, 9”)。 これにより、新しいプレイヤーは現在のセッション メンバーを正しく識別できます。

### <a name="notifying-waiting-players"></a>待機しているプレイヤーへの通知

タイトルでは、ゲーム パーティーに加えて、キュー内のプレイヤー リストを管理することによって待機しているプレイヤーをサポートできます。 プレイヤーがホストに接続したときにゲーム セッションに空きがない場合、プレイヤーはホストの内部待機リストに追加されます。 キューに入れられたプレイヤーは、ゲーム セッションには参加しませんが、ゲーム パーティーには留まっています。 ネットワーク トラフィックを最小にするため、待機しているプレイヤーはこの時点でホストから切断します。

ゲーム セッションのスロットが待機プレイヤー用に空くと、アービターまたはホストは **AddMemberReservation** メソッドを呼び出してプレイヤーのための予約を追加します。 この段階では待機プレイヤーはこの予約をまだ認識しないので、アービターまたはホストは **PullReservedPlayersAsync** メソッドを呼び出す必要があります。 これにより、トーストの構成およびタイトルのフォーカスの状態に応じて、予約されているすべてのプレイヤーに対して UI トーストまたは **GameSessionReady** 通知が発生します。 この通知を受け取ると、新しいプレイヤーはホストに再接続してセッションに参加します。

あるいは、プレイヤーはホストに接続したままにして、スロットが空いたことをホストがプレイヤーに通知した時点でセッションに参加することもできます。 ただし、このフローでは、タイトル以外の UI トーストを表示できません。

**注意:** タイトルが一時停止または終了されるとプレイヤーは自動的にゲーム パーティーから削除されて、それ以上通知を受け取りません。

<a name="client-multiplayer-flow"></a>クライアント マルチプレイヤーのフロー
-----------------------

![](../../images/whitepapers/gamesessionvisibility_image1.png)
![](../../images/whitepapers/gamesessionvisibility_image2.png)
