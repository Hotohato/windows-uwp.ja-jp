---
xx.xxxxxxx: xYYYYxYx-YxYY-YYxx-xxYY-YxYxxYxxYxxY
xxxxx: Xxxxxxxxxxx xxxxxx xxxx
xxxxxxxxxxx: Xxxxxxxxxxx Xxxxxxx xxxx xx xxx xxxxxx xxxx xxxxxxxxx xxxxx xxx xxxxx xxxxxxxx xx xxx xxxxxxxxxxx XXX xxx xxx xxxxx xx. Xxx XXX xxxxxx xxxxxxxxxx xx xxxxxx xxx xxxxxx xxx xx xxxx xxxxxx xxxxxxx xxxx xxxxxxxxxxxx x xxxxxx xxxx xx x xxxxxx xxxx.
---
# Xxxxxxxxxxx xxxxxx xxxx

\[ Xxxxxxx xxx XXX xxxx xx Xxxxxxx YY. Xxx Xxxxxxx Y.x xxxxxxxx, xxx xxx [xxxxxxx](http://go.microsoft.com/fwlink/p/?linkid=619132) \]

Xxxxxxxxxxx Xxxxxxx xxxx xx xxx xxxxxx xxxx xxxxxxxxx xxxxx xxx xxxxx xxxxxxxx xx xxx xxxxxxxxxxx XXX xxx xxx xxxxx xx. Xxx XXX xxxxxx xxxxxxxxxx xx xxxxxx xxx xxxxxx xxx xx xxxx xxxxxx xxxxxxx xxxx xxxxxxxxxxxx x xxxxxx xxxx xx x xxxxxx xxxx.

## Xxxxxxx

Xxxxx xxx xxxxx xxxxxx xxxxx xxxx xxxx xx xxx xxxxxx xxxx xxxxxxxxx xxxx x xxxx xxxxx xxxxx xxxx xxxxxxxx xxxxxxxxxx xxxx xxxxxx xxx xxxxxxx xx x xxxxxx:

-   [
            **Xxxxxx**](https://msdn.microsoft.com/library/windows/apps/Dn706858) – xxxx xxxxxx, xxx xxxxxxxx xx xxx xxxxxxxxxx xxx xxxx, xxx xxxxxxxxx xx xxx xxxxx Xxxxxx xxxxxxx.
-   [
            **XxxxxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/Dn706810) – xxxxxxx xxxx [**Xxxxxx**](https://msdn.microsoft.com/library/windows/apps/Dn706858), xxx xxxx xxx xxxxxxx xx xxxxxx xxxxxxxx.
-   [
            **XxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/Mt589433) – Xxxxxxx xxxx [**XxxxxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/Dn706810) xxx xxxx xxx xxxxxxx xx xxxxxxxxx x xxxxx xx xxxx xxx Xxxxxx xxx xxxxxx xxxxxx xxxxxxxxx xxxxxx, xxxxxxx xx x xxxxx xxxxx.
-   [
            **XxxxxxxxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/Mt589398) – Xxxxxx xxx xxxxxxxxxxx xx xx xxxxxx xx xxx xxxxxxx xx x Xxxxxx. Xxxxx xxx x xxxxxx xx xxxxxxxxxx xx XxxxxxxxxxxXxxxx.

## Xxx XxxxxxxxxxxXxxxxx Xxxxxx

Xx xxx xxxxxx xxxxx xxx x xxxxxx xx xxxxx xxxxx xxxxxxx xxxx xxx xx xxxxxxx xx xxx xxxxxxx xxxxx xxx xxxxxx. Xxxx x xxxxxx xx xxxxxxx xx, xx xxxx xxxx xx xxx xxxxx, xxxxxx YY xxxxxxx, xxx xxxxxx xxxxxx xxxx xxxxxxx xxxxx.

Xxxx xxxxx x xxxxxx xx xxxxx xxxxxxxx xxx xxxxxxx xxxx xxx XXX xxxxxxxxx:

-   Xxxxxxxx x xxxxxxxxxx
-   Xxxxxxxx x XxxxxxXxxxxx xxxx x XxxxxXxxxx
-   Xxxxxxxx x Xxxxxx
-   Xxxxxxxx x Xxxxxx
-   Xxxxxxx Xxxxxxx
-   Xxxxxxxx xxx Xxxxxx’x xxxxxxxx xx xxx xxxxxxxxxx.

Xx xxx xxxxxx xxxxx xxx xxxx xxxxx xxxxxxxxx Xxxxxxx xx xxxx:

-   [
            **Xxxxxx**](https://msdn.microsoft.com/library/windows/apps/Dn706858) – xxxx xxxxxx, xxx xxxxxxxx xx xxx xxxxxxxxxx xxx xxxx, xxx xxxxxxxxx xx xxx xxxxx Xxxxxx xxxxxxx.
-   [
            **XxxxxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/Dn706810) – xxxxxxx xxxx Xxxxxx, xxx xxxx xxx xxxxxxx xx xxxxxx xxxxxxxx.
-   [
            **XxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/Mt589433) – Xxxxxxx xxxx Xxxxxx xxx xxxx xxx xxxxxxx xx xxxxxxxxx x xxxxx xx xxxx xxx Xxxxxx xxx xxxxxx xxxxxx xxxxxxxxx xxxxxx, xxxxxxx xx x xxxxx xxxxx.

Xxxxx xxxx xxxxxx xxxxx’x xxxxx xxxxxxxx xxxx Xxxxxxxxxx xx xxxx xxxxxxx xxxxxxx, xx xxxxxxxx xxx xxxxxxxx xxxxxx xxxx xxx xx xxxxx xxxxxxx xxx.

## Xxxxxxxx x Xxxxxxxxxx

Xxxxxxxx x [**Xxxxxxxxxx**](https://msdn.microsoft.com/library/windows/apps/Dn706789) xxx xxxxxxx xx xxx xxx xx x xxxxxxx xx x xxxxxxxx xx x xxxxxx xxxx. Xxx xxxxxxxxx xxxxxxx xxxxx xxxxxxxx x xxx **Xxxxxxxxxx**:

```cs
_compositor = new Compositor();
```

## Xxxxxxxx x XxxxxxXxxxxx xxx XxxxxXxxxx

Xxxxx xxx [**Xxxxxxxxxx**](https://msdn.microsoft.com/library/windows/apps/Dn706789) xx'x xxxx xx xxxxxx xxxxxxx xxxxxxxx xxx xxxx xxxx, xxxx xx x [**XxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/Mt589433) xxx x [**XxxxxxxxxxxXxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/Mt589399):

```cs
var visual = _compositor.CreateSpriteVisual();
visual.Brush = _compositor.CreateColorBrush(Color.FromArgb(0xFF, 0xFF, 0xFF, 0xFF));
```

Xxxxx xxxx xx xxxx x xxx xxxxx xx xxxx xx xxxxxxxxxxxx x xxxxxxxx xxxxxxx, [**XxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/Mt589433) xxxxxxx xxx xxx xxxxx xx xxx xxxxxxx xxxxxx. Xxx **XxxxxxXxxxxx** xxxxxx xxx xxxxx xxxxxxxxxxx xxx xxxxxxxxx xx xxxxx, xxxxx xxx xxxxxx xxxxxxxx. Xxx **XxxxxxXxxxxx** xx x xxxxxx xxxxxx xxxx xxxx xxx xxxx x YX xxxxxxxxx xxxx x xxxxx, xx xxxx xxxx x xxxxx xxxxx.

## Xxxxxxxx x Xxxxxx

Xxx [**Xxxxxxxxxx**](https://msdn.microsoft.com/library/windows/apps/Dn706789) xxx xxxx xx xxxx xx xxxxxx xxxxx xx x [**Xxxxxx**](https://msdn.microsoft.com/library/windows/apps/Dn706858). Xxxxx xx xx xxxxxxx xxxx xxx xxxxxx xx xxxxx xxx [**XxxxxXxxx**](https://msdn.microsoft.com/library/windows/apps/Dn706825) xx xxxx xxxx xxxx xx xxx xxxxxx:

```cs
var clip = _compositor.CreateInsetClip();
clip.LeftInset = 1.0f;
clip.RightInset = 1.0f;
clip.TopInset = 1.0f;
clip.BottomInset = 1.0f;
_currentVisual.Clip = clip;
```

Xxxx: Xxxx xxxxx xxxxxxx xx xxx XXX [**XxxxxXxxx**](https://msdn.microsoft.com/library/windows/apps/Dn706825) xxx xxxx xxxxxxxxxx xxxxxxx xx xxx xxxxxxxxxx.

## <span id="Rotating_a_Clip">
            </span>
            <span id="rotating_a_clip">
            </span>
            <span id="ROTATING_A_CLIP">
            </span>Xxxxxxxx x Xxxx

X [**Xxxxxx**](https://msdn.microsoft.com/library/windows/apps/Dn706858) xxx xx xxxxxxxxxxx xxxx x xxxxxxxx. Xxxx xxxx [**XxxxxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/windows.ui.composition.visual.rotationangle) xxxxxxxx xxxx xxxxxxx xxx xxxxxxx. Xx xxxxxxxx xx xxxxxxx, xxx xx’x xxxx xx xxxxxxx xxxxxxx xx xxxxx xx xxx xxxxxxxxx xxxxxxx:

```cs
child.RotationAngleInDegrees = 45.0f;
```

Xxxxxxxx xx xxxx xxx xxxxxxx xx x xxx xx xxxxxxxxx xxxxxxxxxx xxxxxxxx xx xxx XXX xx xxxx xxxxx xxxxx xxxxxx. Xxxxxx xxxxxxx Xxxxxx, Xxxxx, Xxxxxxxxxxx, XxxxxxxxXxxx xxx x YxY XxxxxxxxxXxxxxx.

## Xxxxxxx Xxxxxxx

Xxxxxxx xxx xxxxxxx xx x xxxxxx xx x xxxxxx xxxxxxxxx xxxxx x xxxxx xxxxx. Xxx xxxxxxx, xx xxx xxxxxx xxx xxx xxxxxxx xxxxx xx .Y xxxxxxx:

```cs
visual.Opacity = 0.8f;
```

Xxxx xxxxxxxx, xxx [**Xxxxxxx**](https://msdn.microsoft.com/library/windows/apps/windows.ui.composition.visual.opacity) xxxxxxxx xxx xx xxxxxxxx.

## Xxxxxxxx xxx Xxxxxx'x xxxxxxxx xx xxx xxxxxxxxxx

Xxx Xxxxxxxxxxx XXX xxxxxx xxx x Xxxxxx'x xxxxxxxx xx x [**XxxxxxXxxxxxxxxx**](https://msdn.microsoft.com/library/windows/apps/Dn706858collection) xx xx xxxxxxx xx x xxxxxx xx xxxx, xx xxx xx xxxxxx xxxxx xxxxxxx Xxxxxx xxxx [**XxxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/Dn706858collection_insertabove), xxxxxx xxxxx xxxx [**XxxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/Dn706858collection_insertbelow), xxxx xx xxx xxx xxxx [**XxxxxxXxXxx**](https://msdn.microsoft.com/library/windows/apps/Dn706858collection_insertattop) xx xxx xxxxxx xxxx [**XxxxxxXxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/Dn706858collection_insertatbottom).

Xx xxx xxxxxx x [**Xxxxxx**](https://msdn.microsoft.com/library/windows/apps/Dn706858) xxxx xxx xxxx xxxxxxx xx xx xxxxxx xx xxx xxx:

```cs
parent.Children.InsertAtTop(_currentVisual);
```

## Xxxx Xxxxxxx

Xx xxx xxxx xxxxxx, xxx xx xxx xxxxxxxx xxxxx xxx xxxx xxxxxxxx xx xxxxxxxxx xxx xxxx x xxxxxx xxxx xx [**Xxxxxx**](https://msdn.microsoft.com/library/windows/apps/Dn706858) xxxxxxx xx xxxxxx xxxxxxx xxxxxxx xxxxx XXXX, XXX, xx XxxxxxX. Xxxx xxxxxx xxxxx xxx xxxxx **Xxxxxx** xxxxxxx xxx xxxxxxx xxx xxxxx xxx xxx xxxxxxxxxx xxx xxxxxxx.

```cs
using System;
using System.Collections.Generic;
using System.Linq;
using System.Numerics;
using System.Text;
using System.Threading.Tasks;
using Windows.ApplicationModel.Core;
using Windows.Foundation;
using Windows.UI;
using Windows.UI.Composition;
using Windows.UI.Core;

namespace compositionvisual
{
    class VisualProperties : IFrameworkView
    {
        //------------------------------------------------------------------------------
        //
        // VisualProperties.Initialize
        //
        // This method is called during startup to associate the IFrameworkView with the
        // CoreApplicationView.
        //
        //------------------------------------------------------------------------------

        void IFrameworkView.Initialize(CoreApplicationView view)
        {
            _view = view;
            _random = new Random();
        }

        //------------------------------------------------------------------------------
        //
        // VisualProperties.SetWindow
        //
        // This method is called when the CoreApplication has created a new CoreWindow,
        // allowing the application to configure the window and start producing content
        // to display.
        //
        //------------------------------------------------------------------------------

        void IFrameworkView.SetWindow(CoreWindow window)
        {
            _window = window;
            InitNewComposition();
            _window.PointerPressed += OnPointerPressed;
            _window.PointerMoved += OnPointerMoved;
            _window.PointerReleased += OnPointerReleased;
        }

        //------------------------------------------------------------------------------
        //
        // VisualProperties.OnPointerPressed
        //
        // This method is called when the user touches the screen, taps it with a stylus
        // or clicks the mouse.
        //
        //------------------------------------------------------------------------------

        void OnPointerPressed(CoreWindow window, PointerEventArgs args)
        {
            Point position = args.CurrentPoint.Position;

            //
            // Walk our list of visuals to determine who, if anybody, was selected
            //
            foreach (var child in _root.Children)
            {
                //
                // Did we hit this child?
                //
                Vector3 offset = child.Offset;
                Vector2 size = child.Size;

                if ((position.X >= offset.X) &&
                    (position.X < offset.X + size.X) &&
                    (position.Y >= offset.Y) &&
                    (position.Y < offset.Y + size.Y))
                {
                    //
                    // This child was hit. Since the children are stored back to front,
                    // the last one hit is the front-most one so it wins
                    //
                    _currentVisual = child as ContainerVisual;
                    _offsetBias = new Vector2((float)(offset.X - position.X),
                                              (float)(offset.Y - position.Y));
                }
            }

            //
            // If a visual was hit, bring it to the front of the Z order
            //
            if (_currentVisual != null)
            {
                ContainerVisual parent = _currentVisual.Parent as ContainerVisual;
                parent.Children.Remove(_currentVisual);
                parent.Children.InsertAtTop(_currentVisual);
            }
        }

        //------------------------------------------------------------------------------
        //
        // VisualProperties.OnPointerMoved
        //
        // This method is called when the user moves their finger, stylus or mouse with
        // a button pressed over the screen.
        //
        //------------------------------------------------------------------------------

        void OnPointerMoved(CoreWindow window, PointerEventArgs args)
        {
            //
            // If a visual is selected, drag it with the pointer position and
            // make it opaque while we drag it
            //
            if (_currentVisual != null)
            {
                //
                // Set up the properties of the visual the first time it is
                // dragged. This will last for the duration of the drag
                //
                if (!_dragging)
                {
                    _currentVisual.Opacity = 1.0f;

                    //
                    // Transform the first child of the current visual so that
                    // the image is rotated
                    //
                    foreach (var child in _currentVisual.Children)
                    {
                        child.RotationAngleInDegrees = 45.0f;
                        child.CenterPoint = new Vector3(_currentVisual.Size.X / 2, _currentVisual.Size.Y / 2, 0);
                        break;
                    }

                    //
                    // Clip the visual to its original layout rect by using an inset
                    // clip with a one-pixel margin all around
                    //
                    var clip = _compositor.CreateInsetClip();
                    clip.LeftInset = 1.0f;
                    clip.RightInset = 1.0f;
                    clip.TopInset = 1.0f;
                    clip.BottomInset = 1.0f;
                    _currentVisual.Clip = clip;

                    _dragging = true;
                }

                Point position = args.CurrentPoint.Position;
                _currentVisual.Offset = new Vector3((float)(position.X + _offsetBias.X),
                                                    (float)(position.Y + _offsetBias.Y),
                                                    0.0f);
            }
        }

        //------------------------------------------------------------------------------
        //
        // VisualProperties.OnPointerReleased
        //
        // This method is called when the user lifts their finger or stylus from the
        // screen, or lifts the mouse button.
        //
        //------------------------------------------------------------------------------

        void OnPointerReleased(CoreWindow window, PointerEventArgs args)
        {
            //
            // If a visual was selected, make it transparent again when it is
            // released and restore the transform and clip
            //
            if (_currentVisual != null)
            {
                if (_dragging)
                {
                    //
                    // Remove the transform from the first child
                    //
                    foreach (var child in _currentVisual.Children)
                    {
                        child.RotationAngle = 0.0f;
                        child.CenterPoint = new Vector3(0.0f, 0.0f, 0.0f);
                        break;
                    }

                    _currentVisual.Opacity = 0.8f;
                    _currentVisual.Clip = null;
                    _dragging = false;
                }

                _currentVisual = null;
            }
        }

        //------------------------------------------------------------------------------
        //
        // VisualProperties.Load
        //
        // This method is called when a specific page is being loaded in the
        // application.  It is not used for this application.
        //
        //------------------------------------------------------------------------------

        void IFrameworkView.Load(string unused)
        {

        }

        //------------------------------------------------------------------------------
        //
        // VisualProperties.Run
        //
        // This method is called by CoreApplication.Run() to actually run the
        // dispatcher's message pump.
        //
        //------------------------------------------------------------------------------

        void IFrameworkView.Run()
        {
            _window.Activate();
            _window.Dispatcher.ProcessEvents(CoreProcessEventsOption.ProcessUntilQuit);
        }

        //------------------------------------------------------------------------------
        //
        // VisualProperties.Uninitialize
        //
        // This method is called during shutdown to disconnect the CoreApplicationView,
        // and CoreWindow from the IFrameworkView.
        //
        //------------------------------------------------------------------------------

        void IFrameworkView.Uninitialize()
        {
            _window = null;
            _view = null;
        }

        //------------------------------------------------------------------------------
        //
        // VisualProperties.InitNewComposition
        //
        // This method is called by SetWindow(), where we initialize Composition after
        // the CoreWindow has been created.
        //
        //------------------------------------------------------------------------------

        void InitNewComposition()
        {
            //
            // Set up Windows.UI.Composition Compositor, root ContainerVisual, and associate with
            // the CoreWindow.
            //

            _compositor = new Compositor();

            _root = _compositor.CreateContainerVisual();



            _compositionTarget = _compositor.CreateTargetForCurrentView();
            _compositionTarget.Root = _root;

            //
            // Create a few visuals for our window
            //
            for (int index = 0; index < 20; index++)
            {
                _root.Children.InsertAtTop(CreateChildElement());
            }
        }

        //------------------------------------------------------------------------------
        //
        // VisualProperties.CreateChildElement
        //
        // Creates a small sub-tree to represent a visible element in our application.
        //
        //------------------------------------------------------------------------------

        Visual CreateChildElement()
        {
            //
            // Each element consists of three visuals, which produce the appearance
            // of a framed rectangle
            //
            var element = _compositor.CreateContainerVisual();
            element.Size = new Vector2(100.0f, 100.0f);

            //
            // Position this visual randomly within our window
            //
            element.Offset = new Vector3((float)(_random.NextDouble() * 400), (float)(_random.NextDouble() * 400), 0.0f);

            //
            // The outer rectangle is always white
            //
            //Note to preview API users - SpriteVisual and Color Brush replace SolidColorVisual
            //for example instead of doing 
            //var visual = _compositor.CreateSolidColorVisual() and 
            //visual.Color = Color.FromArgb(0xFF, 0xFF, 0xFF, 0xFF);
            //we now use the below

            var visual = _compositor.CreateSpriteVisual();
            element.Children.InsertAtTop(visual);
            visual.Brush = _compositor.CreateColorBrush(Color.FromArgb(0xFF, 0xFF, 0xFF, 0xFF));
            visual.Size = new Vector2(100.0f, 100.0f);

            //
            // The inner rectangle is inset from the outer by three pixels all around
            //
            var child = _compositor.CreateSpriteVisual();
            visual.Children.InsertAtTop(child);
            child.Offset = new Vector3(3.0f, 3.0f, 0.0f);
            child.Size = new Vector2(94.0f, 94.0f);

            //
            // Pick a random color for every rectangle
            //
            byte red = (byte)(0xFF * (0.2f + (_random.NextDouble() / 0.8f)));
            byte green = (byte)(0xFF * (0.2f + (_random.NextDouble() / 0.8f)));
            byte blue = (byte)(0xFF * (0.2f + (_random.NextDouble() / 0.8f)));
            child.Brush = _compositor.CreateColorBrush(Color.FromArgb(0xFF, red, green, blue));

            //
            // Make the subtree root visual partially transparent. This will cause each visual in the subtree
            // to render partially transparent, since a visual's opacity is multiplied with its parent's
            // opacity
            //
            element.Opacity = 0.8f;

            return element;
        }

        // CoreWindow / CoreApplicationView
        private CoreWindow _window;
        private CoreApplicationView _view;

        // Windows.UI.Composition
        private Compositor _compositor;
        private CompositionTarget _compositionTarget;
        private ContainerVisual _root;
        private ContainerVisual _currentVisual;
        private Vector2 _offsetBias;
        private bool _dragging;

        // Helpers
        private Random _random;
    }


    public sealed class VisualPropertiesFactory : IFrameworkViewSource
    {
        //------------------------------------------------------------------------------
        //
        // VisualPropertiesFactory.CreateView
        //
        // This method is called by CoreApplication to provide a new IFrameworkView for
        // a CoreWindow that is being created.
        //
        //------------------------------------------------------------------------------

        IFrameworkView IFrameworkViewSource.CreateView()
        {
            return new VisualProperties();
        }


        //------------------------------------------------------------------------------
        //
        // main
        //
        //------------------------------------------------------------------------------

        static int Main(string[] args)
        {
            CoreApplication.Run(new VisualPropertiesFactory());

            return 0;
        }
    }
}
```

 

 




<!--HONumber=Mar16_HO1-->
