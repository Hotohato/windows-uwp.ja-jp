---
xxxxx: XxxxxxX xxx XXXX xxxxxxx
xxxxxxxxxxx: Xxx xxx xxx Xxxxxxxxxx Xxxxxxxxxxx Xxxxxx Xxxxxxxx (XXXX) xxx Xxxxxxxxx XxxxxxX xxxxxxxx xx xxxx Xxxxxxxxx Xxxxxxx Xxxxxxxx (XXX) xxxx.
xx.xxxxxxx: YxxYYYYx-YYxx-YYYx-YYYY-YxYYxxxxYxYx
---

# XxxxxxX xxx XXXX xxxxxxx


\[ Xxxxxxx xxx XXX xxxx xx Xxxxxxx YY. Xxx Xxxxxxx Y.x xxxxxxxx, xxx xxx [xxxxxxx](http://go.microsoft.com/fwlink/p/?linkid=619132) \]

Xxx xxx xxx Xxxxxxxxxx Xxxxxxxxxxx Xxxxxx Xxxxxxxx (XXXX) xxx Xxxxxxxxx XxxxxxX xxxxxxxx xx xxxx Xxxxxxxxx Xxxxxxx Xxxxxxxx (XXX) xxxx. Xxx xxxxxxxxxxx xx XXXX xxx XxxxxxX xxxx xxx xxxxx xxxxxxxx xxxx xxxxxxxxx xxxxxxxxxx xxxx xxxxxxx xxxx xxxx XxxxxxX-xxxxxxxx xxxxxxx, xxx xx xxxxxxxxxxxx xxxxxx xxx xxxxxxxx-xxxxxxxxx xxxx. Xxxx xxxxx xxxxxxxx xxx xxxxxxxxx xx x XXX xxx xxxx xxxx XxxxxxX xxx xxxxxxxxxx xxx xxxxxxxxx xxxxx xx xxx xxxx xxxxxxxx xxxx XXX xxx xx xxxx xxxx XxxxxxX.

> **Xxxx**  XxxxxxX XXXx xxx xxx xxxxxxx xx Xxxxxxx Xxxxxxx xxxxx, xx xxx xxxxxxxxx xxx Xxxxxx X++ xxxxxxxxx xxxxxxxxxx (X++/XX) xx xxxxxxx XXXXXXX xxxxxxxxxx xxxx xxxxxxx xxxx XxxxxxX. Xxxx, xxx xxx xxxxxx x XXX xxx xxxx X# xxx XXXX xxxx xxxx XxxxxxX, xx xxx xxxx xxx XxxxxxX xxxxx xx x xxxxxxxx Xxxxxxx Xxxxxxx xxxxxxxx xxxx.

 

## XXXX xxx XxxxxxX


XxxxxxX xxxxxxxx xxx xxxxxxxx xxxxxxxxx xxx YX xxx YX xxxxxxxx: XxxxxxYX xxx Xxxxxxxxx XxxxxxYX. Xxxxxxxx XXXX xxxxxxxx xxxxxxx xxx xxxxx YX xxxxxxxxxx xxx xxxxxxx, xxxx xxxx, xxxx xx xxxxxxxx xxx xxxxxx, xxxx xxxx xxxxxxx xxxxxxxx xxxxxxx. Xxx xxxxx, xxx xxx xxx XxxxxxYX xxx XxxxxxYX xx xxxxxx xxxx xx xxx xx xxx xxxxxxxx xxx xxx XXXX xxx xxxxxxxxxx xxxx.

Xx xxx XXXX xxx XxxxxxX xxxxxxx xxxxxxxx, xxx xxxx xx xxxx xxxxx xxx xxxxxxxx:

-   Xxxxxx xxxxxxxx xxx xxxxx xxxxxxx xx xxx xxxxxxx, xxxxxxx xx XXXX, xxxx xxx xxx xxx XxxxxxX xx xxxx xxxx xxxxxxxxxx, xxxxx [**Xxxxxxx::XX::Xxxx::Xxxxx::Xxxxx**](https://msdn.microsoft.com/library/windows/apps/br228076) xxxxx. Xxx xxxxxx xxxxxxxx, xxx xxx'x xxxxxxx xxx xxxxx xx xxxxxxx xxx xxxx xxxxx(x). Xxx xxxxxxx xx xxx xxxxxx xxxxxxx xxx xxxxxx xx xxx XXXX xxxxxxxxx'x xxxxxxx.
-   Xxx xxxx xxxxx xxxxxx. Xxxx xxxxxxxx xxx xxxx xxxxxx xx xxx XxxxxxX xxxxxxxxx xxxxxxxx, xxx xxxx xx xxxxxx xxxx xx xxxxxxxxx xxx xxxxxxx xxxxx xxx xxxxxx xxxxxx xx xxxxxxxx.

Xxxxxxxx xxxx xxx xxx xxxxx XxxxxxX xxx. Xxxx xx xx xxxx xx xxxxxxxxx xx xxxxxxx x xxxxxx xxxxxxx xxxx xxxx xxxxxx xxx xxxxxxxxxx xx xxx xxxxxxx xxxxxx? Xxx xxx xxxxxxxxxx xxxxxxx xx xxxxxxxx xx xxxxx xxxxxxxx, xx xxx xxxxx xx xxx xxxxxx? Xxxx xx xxxxxxx xxxxxx xxxx xxxxx xx xx xxxxxxxx xxx xxxxxxxxxx xx xxxx-xxxx, xx xx x xxxx?

Xxxx xxx'xx xxxxxxxxxx xxx xxx xxxxxx xx xxx XxxxxxX, xxx xxx xxx xx xxxxx Xxxxxxx Xxxxxxx xxxxx xx xxxxxxxxxxx XxxxxxX xxxxxxxxx xxxx xxxx Xxxxxxx Xxxxx xxx:

-   Xx xxx xxxx xx xxxxxxx x xxxxxx xxxxx, xx xxxx x xxxxxxx xxxxx xx xxxxx-xxxxxx xxxxxxxxx, xxxx xx x xxxxxx xxxxxxx xxxx [**Xxxxxxx::XX::Xxxx::Xxxxx::Xxxxxxx::XxxxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/hh702041). Xxxx xxxx xxxxxxx x xxxxx XxxxxxX xxxxxxx xxxxxxx. Xxxxxxxxx, xxx xxx xxxx xxxx xxxx xxxxxxxxx xx xxxxx xx xxxxxxx xx x xxxxxx xxx xxxxxxx xx x xxxxxxxx xx XX xxxxxxx. Xx xxxxx'x xxxx xxxx xxx xxxx-xxxx xxxxxxxxxxxxx, xxxx xx x xxxx-xxxxxxxxxxx xxxx. Xxxx'x xxxxxxx xxxxxxx xx x **XxxxxxxXxxxxXxxxxx** xxxxxx xxx xxxxxx xx XXXX xxxx xxxxxxxxx xxxxxxx, xxx xxxx xxx xxxxxxxxx xxxxxxx xxxx xxx xxxxxx xxxxxxxx xxx xxxxxxx xx xxx xxxx, xxxx x xxxxxxxxxxx xxxxx xxxx xx x xxxxxxxxx xxxx xxxxxxxx xx xxxx-xxxx xxxxx. Xxxxxxx xxx xxxxx xxxxx xxxxxx xxx xxxxxxx xxxxxxxx xx xxxx xxxxxxxxxxx, xxxxxx!

    [
            **XxxxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/hh702041) xxxxxxxx xxxxxxx xxx xx xxxxxxxxxx xxxx xxxxx XXXX XX xxxxxxxx. Xxx xxx xxxxxxxxx xx xxxxxxx xxxx , xxx xxx XXXX xxxxxxxxx xxxxxxxx xxx xxxxxxx xx x-xxxxx xxxxxx.

-   Xx xxx xxxxx xx xxxxxx xxxx xxx xxxxxxxx xxxxxx xxxx xxxxxx, xxx xxx xx xxxxxx xx xxxxxx xx xxx xxxx, xxx [**Xxxxxxx::XX::Xxxx::Xxxxx::Xxxxxxx::XxxxxxxXxxxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/hh702050). Xxxx xxxx xxxxxxx x xxxxx XxxxxxX xxxxxxx xxxxxxx xxxx xx xxxxxx xxxx xxx xxxxxx. Xxxx [**XxxxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/hh702041), xxx xxx xxxx xxxx xxxxxxxxx x xxxxxxx xxxxx xx xxxxxxx xxxxxxxxxxx. Xxx, xxxx xxxx **XxxxxxxXxxxxXxxxxx**, xx xxxxx'x xxxx xxxx xxx xxxx-xxxxxxxxxxx xxxxx. Xxxx xxxxxxxx xx XXXX xxxxxxxx xxxx xxxxx xxx x **XxxxxxxXxxxxxxXxxxxXxxxxx** xxx xxx xxxxxxxx, xx x xxxxx, xxxxx-xxxxx xxxxxxxx xxxxxx.

-   Xx xxx xxx xxxxx XxxxxxX xx xxxxxxx xxxxxxxx xxxxxxx xx xxxx-xxxx, xx xx x xxxxxxxxx xxxxx xxx xxxxxxx xxxx xxxx xx xxxxxxx xxx-xxxxxxx xxxxxxxxx, xxx xxx [**XxxxXxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/dn252834) xxxxx, xx xxx xxx xxxxxxx xxx xxxxxxxx xxxxxxx xxxxxxx xx xxx XXXX xxxxxxxxx xxxxxxx xxxxx. Xxxx xxxx xxxxxxx xxx xx xxxxxx xxx xxxxxxxx xxxxxx'x xxxx xxxxx ([**XXXXXXxxxXxxxxY**](https://msdn.microsoft.com/library/windows/desktop/hh404631)) xxxxxxxx xxx xxxxx XXXX xxxx xxx xxxxxx xxxxxx. Xxxx xxxx xxxxx xxxxx xxx xxxxx xxx xxxxx xxxx-xxxxxx XxxxxxX xxxx xxxx xxxxxxx x XXXX-xxxxx xxxx xxxxxxxxx. Xxx xxxx xxxx XxxxxxX xxxx xx xxx xxxx xxxxxxxx, xxxxxxxxx xxx Xxxxxxxxx XxxxxxX Xxxxxxxx Xxxxxxxxxxxxxx (XXXX), XxxxxxYX, xxx XxxxxxYX xxxxxxxxxxxx. Xxx xxxx xxxx, xxx [Xxxxxxxxxxx Xxxxx xxx XxxxxxYX YY](https://msdn.microsoft.com/library/windows/desktop/ff476345).

## XxxxxxxXxxxxXxxxxx


[
            **XxxxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/hh702041) xxxxxxxx XxxxxxX xxxxxx xxxxxxxx xx xxxx xxxx xxx xxxx xxxxxxxx xxx xxxx xxxx xxx xxxxxxx.

Xxxx xx xxx xxxxx xxxxxxx xxx xxxxxxxx xxx xxxxxxxx x [**XxxxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/hh702041) xxxxxx xx xxx xxxx xxxxxx:

1.  Xxxxxx xxx xxxx xx xxx xxxxxx xxxxxxx xx xxxxxxx xxx xxxxxx xxx xxxxx xx xxx [**XxxxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/hh702041) xxxxxxxxxxx. Xxx xxx xxxx xxxxxxxx xxxxxxx xxx xxxxxxx xxxxx xxxxx (xxxxxxx) xxxxxxx.

    Xxx xxxxxxx:

    `SurfaceImageSource^ surfaceImageSource = ref new SurfaceImageSource(400, 300);`

2.  Xxx x xxxxxxx xx [**XXxxxxxxXxxxxXxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/hh848322). Xxxx xxx [**XxxxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/hh702041) xxxxxx xx [**XXxxxxxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/br205821) (xx **XXxxxxxx**), xxx xxxx **XxxxxXxxxxxxxx** xx xx xx xxx xxx xxxxxxxxxx **XXxxxxxxXxxxxXxxxxxXxxxxx** xxxxxxxxxxxxxx. Xxx xxx xxx xxxxxxx xxxxxxx xx xxxx xxxxxxxxxxxxxx xx xxx xxx xxxxxx xxx xxx xxx xxxx xxxxxxxxxx.

    ```cpp
    Microsoft::WRL::ComPtr<ISurfaceImageSourceNative> m_sisNative;
    // ...
    IInspectable* sisInspectable = (IInspectable*) reinterpret_cast<IInspectable*>(surfaceImageSource);
    sisInspectable->QueryInterface(__uuidof(ISurfaceImageSourceNative), (void **)&m_sisNative);
    ```

3.  Xxx xxx XXXX xxxxxx xx xxxxx xxxxxxx [**XYXYYXxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476082) xxx xxxx xxxxxxx xxx xxxxxx xxx xxxxxxx xx [**XXxxxxxxXxxxxXxxxxxXxxxxx::XxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/hh848325). Xxx xxxxxxx:

    ```cpp
    Microsoft::WRL::ComPtr<ID3D11Device>              m_d3dDevice;
    Microsoft::WRL::ComPtr<ID3D11DeviceContext>           m_d3dContext;
    // ...
    D3D11CreateDevice(
            NULL,
            D3D_DRIVER_TYPE_HARDWARE,
            NULL,
            flags,
            featureLevels,
            ARRAYSIZE(featureLevels),
            D3D11_SDK_VERSION,
            &m_d3dDevice,
            NULL,
            &m_d3dContext
            )
        );  
    Microsoft::WRL::ComPtr<IDXGIDevice> dxgiDevice;
    m_d3dDevice.As(&dxgiDevice);
    // ...
    m_sisNative->SetDevice(dxgiDevice.Get());
    ```

4.  Xxxxxxx x xxxxxxx xx [**XXXXXXxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/bb174565) xxxxxx xx [**XXxxxxxxXxxxxXxxxxxXxxxxx::XxxxxXxxx**](https://msdn.microsoft.com/library/windows/desktop/hh848323), xxx xxxx xxxx xxxx xxxxxxx xxxxx XxxxxxX. Xxxx xxx xxxx xxxxxxxxx xxx xxxxxx xx xxx *xxxxxxXxxx* xxxxxxxxx xx xxxxx.

    > **Xxxx**   Xxx xxx xxxx xxxx xxx xxxxxxxxxxx [**XxxxxXxxx**](https://msdn.microsoft.com/library/windows/desktop/hh848323) xxxxxxxxx xxxxxx xx x xxxx xxx [**XXXXXXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/bb174527).

     

    This method returns the point (x,y) offset of the updated target rectangle in the *offset* parameter. You use this offset to determine where to draw into inside the [**IDXGISurface**](https://msdn.microsoft.com/library/windows/desktop/bb174565).

    ```cpp
    ComPtr<IDXGISurface> surface;

    HRESULT beginDrawHR = m_sisNative->BeginDraw(updateRect, &surface, &offset);
    if (beginDrawHR == DXGI_ERROR_DEVICE_REMOVED || beginDrawHR == DXGI_ERROR_DEVICE_RESET)
    {
              // Device changed
    }
    else
    {
        // Draw to IDXGISurface (the surface paramater)
    }
    ```

5.  Xxxx [**XXxxxxxxXxxxxXxxxxxXxxxxx::XxxXxxx**](https://msdn.microsoft.com/library/windows/desktop/hh848324) xx xxxxxxxx xxx xxxxxx. Xxxx xxxx xxxxxx xx xx [**XxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/br210101).

    ```cpp
    m_sisNative->EndDraw();
    // ...
    // The SurfaceImageSource object's underlying ISurfaceImageSourceNative object contains the completed bitmap.
    ImageBrush^ brush = ref new ImageBrush();
    brush->ImageSource = surfaceImageSource;
    ```

6.  Xxx xxx [**XxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/br210101) xx xxxx xxx xxxxxx.

> **Xxxx**   Xxxxxxx [**XxxxxxxXxxxxXxxxxx::XxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/br243255) (xxxxxxxxx xxxx **XXxxxxxXxxxxx::XxxXxxxxx**) xxxxxxxxx xxxxxx xx xxxxxxxxx. Xx xxx xxxx xx xxxx xxxx [**XxxxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/hh702041) xxxxxx.

 

## XxxxxxxXxxxxxxXxxxxXxxxxx


[
            **XxxxxxxXxxxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/hh702050) xxxxxxx [**XxxxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/hh702041) xxxx xxx xxxxxxx xx xxxxxxxxxxx xxxxxx xxxx xxxx xxx xxx xx xxxxxx xxx xx xxx xxxxxxx xxxx xx xxxxxxxxxxx xx xxxxxx xxxxxxxxx.

[
            **XxxxxxxXxxxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/hh702050) xxxxxxx xxxx [**XxxxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/hh702041) xx xxxx xx xxxx x xxxxxxxx, [**XXxxxxxxXxxxxxxXxxxxXxxxxxXxxxxxxxxXxxxxx::XxxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/hh848337), xxxx xxx xxxxxxxxx xx xxxxxx xxxxxxx xx xxx xxxxxxx xx xxxx xxxxxx xxxxxxx xx xxx xxxxxx. Xxx xx xxx xxxx xx xxxxx xxxxxxx xxxx xxx xxxxxx, xx xxx XXXX xxxxxxxxx xxxxx xxxx xx xxxx xxx xxx.

Xxxx xx xxxxx xxxxxxx xxx xxxxxxxx xxx xxxxxxxx x [**XxxxxxxXxxxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/hh702050) xxxxxx xx xxx xxxxxxxxxx:

1.  Xxxxxx xx xxxxxxxx xx [**XxxxxxxXxxxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/hh702050) xxxx xxx xxxx xxx xxxx. Xxx xxxxxxx:

    `VirtualSurfaceImageSource^ virtualSIS = ref new VirtualSurfaceImageSource(2000, 2000);`

2.  Xxx x xxxxxxx xx [**XXxxxxxxXxxxxxxXxxxxXxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/hh848328). Xxxx xxx [**XxxxxxxXxxxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/hh702050) xxxxxx xx [**XXxxxxxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/br205821) xx [**XXxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ms680509), xxx xxxx [**XxxxxXxxxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ms682521) xx xx xx xxx xxx xxxxxxxxxx **XXxxxxxxXxxxxxxXxxxxXxxxxxXxxxxx** xxxxxxxxxxxxxx. Xxx xxx xxx xxxxxxx xxxxxxx xx xxxx xxxxxxxxxxxxxx xx xxx xxx xxxxxx xxx xxx xxx xxxx xxxxxxxxxx.

    ```cpp
    Microsoft::WRL::ComPtr<IVirtualSurfaceImageSourceNative>  m_vsisNative;
    // ...
    IInspectable* vsisInspectable = (IInspectable*) reinterpret_cast<IInspectable*>(virtualSIS);
    vsisInspectable->QueryInterface(__uuidof(IVirtualSurfaceImageSourceNative), (void **)&m_vsisNative);
    ```

3.  Xxx xxx XXXX xxxxxx xx xxxxxxx [**XXxxxxxxXxxxxxxXxxxxXxxxxxXxxxxx::XxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/hh848325). Xxx xxxxxxx:

    ```cpp
    Microsoft::WRL::ComPtr<ID3D11Device>              m_d3dDevice;
    Microsoft::WRL::ComPtr<ID3D11DeviceContext>           m_d3dContext;
    // ...
    D3D11CreateDevice(
            NULL,
            D3D_DRIVER_TYPE_HARDWARE,
            NULL,
            flags,
            featureLevels,
            ARRAYSIZE(featureLevels),
            D3D11_SDK_VERSION,
            &m_d3dDevice,
            NULL,
            &m_d3dContext
            )
        );  
    Microsoft::WRL::ComPtr<IDXGIDevice> dxgiDevice;
    m_d3dDevice.As(&dxgiDevice);
    // ...
    m_vsisNative->SetDevice(dxgiDevice.Get());
    ```

4.  Xxxx [**XXxxxxxxXxxxxxxXxxxxXxxxxxXxxxxx::XxxxxxxxXxxXxxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/hh848334), xxxxxxx xx x xxxxxxxxx xx xxxx xxxxxxxxxxxxxx xx [**XXxxxxxxXxxxxxxXxxxxxxXxxxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/hh848336).

    ```cpp
    class MyContentImageSource : public IVirtualSurfaceUpdatesCallbackNative
    {
    // ...
      private:
         virtual HRESULT STDMETHODCALLTYPE UpdatesNeeded() override;
    }

    // ...

    HRESULT STDMETHODCALLTYPE MyContentImageSource::UpdatesNeeded()
    {
      // .. Perform drawing here ...
    }
    void MyContentImageSource::Initialize()
    {
      // ...
      m_vsisNative->RegisterForUpdatesNeeded(this);
      // ...
    }
    ```

    Xxx xxxxxxxxx xxxxx xxxx xxxxxxxxxxxxxx xx [**XXxxxxxxXxxxxxxXxxxxxxXxxxxxxxXxxxxx::XxxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/hh848334) xxxx x xxxxxx xx xxx [**XxxxxxxXxxxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/hh702050) xxxxx xx xx xxxxxxx.

    Xxxx xxx xxxxxx xxxxxx xxxx xxx xxxxxxxxx xxxxxxxxxx xxx xxxxxx xxxxx xx xx xxxxx (xxxx xx xxxx xxx xxxx xxxx xx xxxxx xxx xxxx xx xxx xxxxxxx), xx xxxxx xxx xxx xxx xxxxxx [**XXxxxxxxXxxxxxxXxxxxXxxxxxXxxxxx::Xxxxxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/hh848332) xx xxxx xxxxxx.

5.  Xx [**XXxxxxxxXxxxxxxXxxxxXxxxxxXxxxxx::XxxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/hh848337), xxx xxx [**XXxxxxxxXxxxxxxXxxxxXxxxxxXxxxxx::XxxXxxxxxXxxxXxxxx**](https://msdn.microsoft.com/library/windows/desktop/hh848329) xxx [**XXxxxxxxXxxxxxxXxxxxXxxxxxXxxxxx::XxxXxxxxxXxxxx**](https://msdn.microsoft.com/library/windows/desktop/hh848330) xxxxxxx xx xxxxxxxxx xxxxx xxxxxx(x) xx xxx xxxxxxx xxxx xx xxxxx.

    ```cpp
    HRESULT STDMETHODCALLTYPE MyContentImageSource::UpdatesNeeded()
    {
        HRESULT hr = S_OK;

        try
        {
            ULONG drawingBoundsCount = 0;  

                  m_vsisNative->GetUpdateRectCount(&drawingBoundsCount);
            std::unique_ptr<RECT[]> drawingBounds(new RECT[drawingBoundsCount]);
            m_vsisNative->GetUpdateRects(drawingBounds.get(), drawingBoundsCount);
            
            for (ULONG i = 0; i < drawingBoundsCount; ++i)
            {
                // Drawing code here ...
            }
        }
        catch (Platform::Exception^ exception)
        {
            hr = exception->HResult;
        }

        return hr;
    }
    ```

6.  Xxxxxx, xxx xxxx xxxxxx xxxx xxxx xx xxxxxxx:

    1.  Xxxxxxx x xxxxxxx xx xxx [**XXXXXXxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/bb174565) xxxxxx xx [**XXxxxxxxXxxxxxxXxxxxXxxxxxXxxxxx::XxxxxXxxx**](https://msdn.microsoft.com/library/windows/desktop/hh848323), xxx xxxx xxxx xxxx xxxxxxx xxxxx XxxxxxX. Xxxx xxx xxxx xxxxxxxxx xxx xxxxxx xx xxx *xxxxxxXxxx* xxxxxxxxx xxxx xx xxxxx.

        Xx xxxx [**XxXxxxxxxXxxxxXxxxxxXxxxxx::XxxxxXxxx**](https://msdn.microsoft.com/library/windows/desktop/hh848323), xxxx xxxxxx xxxxxxx xxx xxxxx (x,x) xxxxxx xx xxx xxxxxxx xxxxxx xxxxxxxxx xx xxx *xxxxxx* xxxxxxxxx. Xxx xxx xxxx xxxxxx xx xxxxxxxxx xxxxx xx xxxx xxxx xxxxxx xxx [**XXXXXXxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/bb174565).

        > **Xxxx**   Xxx xxx xxxx xxxx xxx xxxxxxxxxxx [**XxxxxXxxx**](https://msdn.microsoft.com/library/windows/desktop/hh848323) xxxxxxxxx xxxxxx xx x xxxx xxx [**XXXXXXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/bb174527).

         

        ```cpp
        ComPtr<IDXGISurface> bigSurface;

        HRESULT beginDrawHR = m_vsisNative->BeginDraw(updateRect, &bigSurface, &offset);
        if (beginDrawHR == DXGI_ERROR_DEVICE_REMOVED || beginDrawHR == DXGI_ERROR_DEVICE_RESET)
        {
                  // Device changed
        }
        else
        {
            // Draw to IDXGISurface
        }
        ```

    2.  Draw the specific content to that region, but constrain your drawing to the bounded regions for better performance.

    3.  Call [**IVirtualSurfaceImageSourceNative::EndDraw**](https://msdn.microsoft.com/library/windows/desktop/hh848324). The result is a bitmap.

## XxxxXxxxxXxxxx xxx xxxxxx


[
            **XxxxXxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/dn252834) xx xxx Xxxxxxx Xxxxxxx xxxx xxxxxxxx xx xxxxxxx xxxx-xxxxxxxxxxx xxxxxxxx xxx xxxxxx, xxxxx xxx xxxxxx xxx xxxx xxxxx xxxxxxxx. Xx xxxx xxxx, xxx xxxxxx xxxx xxx XxxxxxX xxxx xxxxx xxx xxxxxx xxx xxxxxxxxxxxx xx xxxx xxxxxxxx xxxxxxx. Xxx xxx xxxx xxx XXXX xxxxxxxx xx xxx **XxxxXxxxxXxxxx** xxxxxx, xxxx xx xxxxx, xxxxx-xx xxxxxxxx, xxx xxxxx XX xxxxxxxx.

Xx xxxxxx xxxx xxxxxxxxxxx, xxxxx xxx xxxxxxx xxxxxxxxxxx xx xxx [**XxxxXxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/dn252834) xxxx:

-   Xxxxx xxx xx xxxx xxxx Y [**XxxxXxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/dn252834) xxxxxxxxx xxx xxx.
-   Xxx **Xxxxxxx**, **XxxxxxXxxxxxxxx**, **Xxxxxxxxxx**, xxx **Xxxx** xxxxxxxxxx xxxxxxxxx xx [**XxxxXxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/dn252834) xxx xxx xxxxxxxxx.
-   Xxx xxxxxx xxx xxx XxxxxxX xxxx xxxxx'x xxxxxx xxx xxxxx (xx [**XXXX\_XXXX\_XXXXX\_XXXXY**](https://msdn.microsoft.com/library/windows/desktop/hh404528)) xx xxx xxxxxxx xxxxxxxxxx xx xxx xxx xxxxxx. Xx xxx xxx'x, xxx xxxxxxx xxxxxxx xxxx xx xxxxxx (xxxxx **XXXX\_XXXXXXX\_XXXXXXX**) xx xxx.
-   Xxx xxxx xxx xxx XxxxxxX xxxx xxxxx'x xxxxxxx xxxx (xx [**XXXX\_XXXX\_XXXXX\_XXXXY**](https://msdn.microsoft.com/library/windows/desktop/hh404528)) xx **XXXX\_XXXXXXX\_XXXXXXX**.
-   Xxx xxx'x xxx xxx XxxxxxX xxxx xxxxx'x xxxxx xxxx (xx [**XXXX\_XXXX\_XXXXX\_XXXXY**](https://msdn.microsoft.com/library/windows/desktop/hh404528)) xx **XXXX\_XXXXX\_XXXX\_XXXXXXXXXXXXX**.
-   Xxx xxxx xxxxxx xxx XxxxxxX xxxx xxxxx xx xxxxxxx [**XXXXXXxxxxxxY::XxxxxxXxxxXxxxxXxxXxxxxxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/hh404558).

Xxx xxxxxx xxx [**XxxxXxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/dn252834) xxxxx xx xxx xxxxx xx xxxx xxx, xxx xxx xxx xxxxxxx xx xxx XXXX xxxxxxxxx. Xx xxx xxxx xx xxxxxxxxxxx xxx xxxxxxx xx **XxxxXxxxxXxxxx** xx xxxxx xx xxx XXXX xxxxxxxxx, xxxxxxxx xxx xxx [**Xxxxxxx::XX::Xxxx::Xxxxx::XxxxxxxxxxxXxxxxx::Xxxxxxxxx**](https://msdn.microsoft.com/library/windows/apps/br228127) xxxxx. Xxxxxxxxx, xxx xxxx xxxxxxxx xxx xxxxx-xxxxxx xxxxxx xx xxx xxx xx xxxxxx xxx XXXX xxxxxxxx xxxx x xxxxxxxxx xxxxxx xxxx xxx xxx xxxxxxxx xxx **XxxxXxxxxXxxxx**.

Xxxxx xxx xxxx x xxx xxxxxxx xxxx xxxxxxxxx xx xxxxxx xxxxxxxxx xxxx xxx xx xxx [**XxxxXxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/dn252834).

-   [
            **XxxxXxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/dn252834) xxxxxxxx xxxx [**Xxxxxxx::XX::Xxxx::Xxxxxxxx::Xxxx**](https://msdn.microsoft.com/library/windows/apps/br242704), xxx xxxxxxxx xxxxxxx xxxxxx xxxxxxxx. Xxxxxxxxxxx xxxxxxxx xxxx xxx **Xxxx** xxxx xxx xxx xxxxxxxxxx.

-   Xxxxx x XxxxxxX xxxx xxxxx xxx xxxx xxx, xxx xxxxx xxxxxx xxxx xxx xxxxx xxx [**XxxxXxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/dn252834) xxxx xxx xxxx xx xxxx xx xxx xxx xxxxx XXXX xxxxxxx. Xxx xxx'x xxx x xxxxxxxxxx xxxxx xxx **XxxxXxxxxXxxxx**, xxx xxx xxx'x xxxx xx xxxxxx xxxxx xxxxxx xxxx xxx xxx'x [**XxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/br208225) xxxxxx xxxxxxxx xx xxx xx xx XxxxxxX xxxx xxxx xxx'x xxx **XxxxXxxxxXxxxx**.

-   • Xxx xxxxxxx xx xxx xxxxxx XXXX xxxxxxx xxxx xxxxx x xxxxxx xxxxx xx x [**XxxxXxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/dn252834) xx xxxxxxx xx xxx xxxxxx xxxx xx xxx **XxxxXxxxxXxxxx** xxxxxx’x xxxxxxxxx xxxxx. Xxx xxxxxxx xxxx xx xxxxxxxxxxx xxxxxxx xxxxx xxxxxx xxxxxx xxx'x xx xxxxxxxx. Xxxxxxxxx, xxxxx xxx XXXX xxxxxxx xxxx xxx xxxxxxx xxxx x XXXX[**Xxxxxxxxxx**](https://msdn.microsoft.com/library/windows/apps/br210490) xx xxx xxxxxx xxxx xxxxx xx xxxxxxx xxxxx xxxxxx xxxxxx xxx xxxxx xxxxxx xx xxxxxxx xxx xxxx xxxxx xx xxx xxxxxxxxx.

-   Xxxxx xxx xxxxxx xx xxxxxxxxx xxxxxx XXXX xxxxxxxx xxxxx x [**XxxxXxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/dn252834). Xx xxxxxxxx, xxxxx xxxxxxxx xxxx xxx xx xxxxx xxxxxxxxx xxxxx x xxxxxx xxxxxx. Xxx xxxxx xx x xxxxxxxxxxx xxxxxxxx xxxxxxx xxx xxxxxx xx xxxxxxxxx xxxxxx xxxxxxxx xxx xxx xxxx xx xxx xxxxxxxx: xxx xxxx xx xxxxxxxxxxxxx xxxxx XXXX xxxxxxxx xxx xxxxxx xxxxxxx xxxxxxxxxxx. Xxxxxxxx, xxx'x xxxxxx x xxxxxx xxxx-xxxxxx xxxxx XXXX xxxxxxx xxx xxxx xxx'x **XxxxXxxxxXxxxx** xxxxxxx xxxx xxxxxxxxx xxxxxxxx xx xxx xxx xxx xxxxxxxxx xxxxxxxxxxx. Xx x xxxx, xxxxxx xx xxxx xxxx Y xxxxxxxxx XXXX xxxxxx xxxxxxxx xxx xxxx xxx'x **XxxxXxxxxXxxxx**, xxx xxxx xxxxxxx xxxx xxxx x xxxxxx xxxx xxxx xx xxxxx xx xxxxxxxxx xx xxxxxxx xxx xxxxxxx'x xxxxxx xxxxxxx. Xxxxxxx, xxx xxx xxxx xxx xxxxxx xxxx xx xxxxxxxx xxxxx x xxxxx xxxxxxx xx xxx **XxxxXxxxxXxxxx** xxxxxxxxxxxx xxxxxxx xxxxxxx xxxxxxxxxx xxxxxxxxxxx xxx xxxxx.

> **Xxxx**   Xx xxxxxxx, xxxx XxxxxxX xxxx xxxxxx xxxxxx xxxx xxxxxx xx xxxxxxxxx xxxxxxxxxxx, xxx xxxxx xx xxx xxxxxxx xxxxxx xxxx (xxxxx xx xxxxxxx xxx xxxxxx xxxxxx xxxxxxxxxx xx xxxx Xxxxxxx Xxxxx xxxxx). Xxxx xxxxxxx xxxx xxxx xxx xxxx xxx xxxxxxx xxxx xxxxx xxxxxxxxxxxxxx xxxx xx xxxxx'x xxxx xxx xxxxxxx XXXX xxxxxxx. Xx xxx xxx xx xxxxxxx xx xxxxxxxx xxxx, xxxx xxx xxxxxx xxxx [**XXXXXXxxxXxxxxY::XxxXxxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/hh446801) xx xxx xxxxxxxx xxxx xxxxx, xxxxx x xxxxxxxxx xx xxx xxxxxxx xx xxxxxx, xxx xxxx xxxx [**XxxXxxxXxxxx**](https://msdn.microsoft.com/library/windows/desktop/dn302144) xxxxx xx xxx xxxx xxxx xxxxx. Xxxxxxxxx, xxxx xxx xxxxxx xxxx **XxxXxxxXxxxx** xxxxx xx xxx xxxx xxxx xxxxx xxxxxxxx xxx xxxx xxxxx xx xxxxxxx xx xxxxxxx [**XXXXXXxxxXxxxx::XxxxxxXxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/bb174577).

 

Xxxx xx xxxxx xxxxxxx xxx xxxxxxxx xxx xxxxxxxx x [**XxxxXxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/dn252834) xxxxxx xx xxx xxxx xxxxxx:

1.  Xxx xx xxxxxxxx xx x xxxx xxxxx xxxxx xxx xxxx xxx. Xxx xxxxxxxxx xxx xxxxxxxxx xx xxxx XXXX xxxx xxx `<SwapChainPanel>` xxx.

    `Windows::UI::Xaml::Controls::SwapChainPanel^ swapChainPanel;`

    Xxxx xx xx xxxxxxx `<SwapChainPanel>` xxx.

    ```xaml
    <SwapChainPanel x:Name=&quot;swapChainPanel&quot;>
        <SwapChainPanel.ColumnDefinitions>
            <ColumnDefinition Width=&quot;300*&quot;/>
            <ColumnDefinition Width=&quot;1069*&quot;/>
        </SwapChainPanel.ColumnDefinitions>
    …
    ```

2.  Xxx x xxxxxxx xx [**XXxxxXxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/dn302143). Xxxx xxx [**XxxxXxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/dn252834) xxxxxx xx [**XXxxxxxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/br205821) (xx **XXxxxxxx**), xxx xxxx **XxxxxXxxxxxxxx** xx xx xx xxx xxx xxxxxxxxxx **XXxxxXxxxxXxxxxXxxxxx** xxxxxxxxxxxxxx.

    ```cpp
    Microsoft::WRL::ComPtr<ISwapChainPanelNative> m_swapChainNative;
    // ...
    IInspectable* panelInspectable = (IInspectable*) reinterpret_cast<IInspectable*>(swapChainPanel);
    panelInspectable->QueryInterface(__uuidof(ISwapChainPanelNative), (void **)&m_swapChainNative);
    ```

3.  Xxxxxx xxx XXXX xxxxxx xxx xxx xxxx xxxxx, xxx xxx xxx xxxx xxxxx xx [**XXxxxXxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/dn302143) xx xxxxxxx xx xx [**XxxXxxxXxxxx**](https://msdn.microsoft.com/library/windows/desktop/dn302144).

    ```cpp
    Microsoft::WRL::ComPtr<IDXGISwapChain1>               m_swapChain;    
    // ...
    DXGI_SWAP_CHAIN_DESC1 swapChainDesc = {0};
            swapChainDesc.Width = m_bounds.Width;
            swapChainDesc.Height = m_bounds.Height;
            swapChainDesc.Format = DXGI_FORMAT_B8G8R8A8_UNORM;           // This is the most common swapchain format.
            swapChainDesc.Stereo = false; 
            swapChainDesc.SampleDesc.Count = 1;                          // Don't use multi-sampling.
            swapChainDesc.SampleDesc.Quality = 0;
            swapChainDesc.BufferUsage = DXGI_USAGE_RENDER_TARGET_OUTPUT;
            swapChainDesc.BufferCount = 2;
            swapChainDesc.Scaling = DXGI_SCALING_STRETCH;
            swapChainDesc.SwapEffect = DXGI_SWAP_EFFECT_FLIP_SEQUENTIAL; // We recommend using this swap effect for all. applications
            swapChainDesc.Flags = 0;
                    
    // QI for DXGI device
    Microsoft::WRL::ComPtr<IDXGIDevice> dxgiDevice;
    m_d3dDevice.As(&dxgiDevice);

    // Get the DXGI adapter.
    Microsoft::WRL::ComPtr<IDXGIAdapter> dxgiAdapter;
    dxgiDevice->GetAdapter(&dxgiAdapter);

    // Get the DXGI factory.
    Microsoft::WRL::ComPtr<IDXGIFactory2> dxgiFactory;
    dxgiAdapter->GetParent(__uuidof(IDXGIFactory2), &dxgiFactory);
    // Create a swap chain by calling CreateSwapChainForComposition.
    dxgiFactory->CreateSwapChainForComposition(
                m_d3dDevice.Get(),
                &swapChainDesc,
                nullptr,        // Allow on any display. 
                &m_swapChain
                );
            
    m_swapChainNative->SetSwapChain(m_swapChain.Get());
    ```

4.  Xxxx xx xxx XxxxxxX xxxx xxxxx, xxx xxxxxxx xx xx xxxxxxx xxx xxxxxxxx.

    ```cpp
    HRESULT hr = m_swapChain->Present(1, 0);
    ```

    Xxx XXXX xxxxxxxx xxx xxxxxxxxx xxxx xxx Xxxxxxx Xxxxxxx xxxxxx/xxxxxx xxxxx xxxxxxx xx xxxxxx.

## Xxxxxxx xxxxxx


* [**XxxxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/hh702041)
* [**XxxxxxxXxxxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/hh702050)
* [**XxxxXxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/dn252834)
* [**XXxxxXxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/dn302143)
* [Xxxxxxxxxxx Xxxxx xxx XxxxxxYX YY](https://msdn.microsoft.com/library/windows/desktop/ff476345)

 

 




<!--HONumber=Mar16_HO1-->
