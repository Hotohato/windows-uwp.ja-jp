---
xxxxx: Xxxxxx xxxxx xxx xxxxxxxxxxxxx xx xxx Xxxxxx Xxxx xxxxxx
xxxxxxxxxxx: Xxxxxxxxx Xxxxxxx Xxxxxxxx (XXX) xxx xxxxx xxx xx x xxxx xxxxxxx xx xxxxxxx, xxxx xx xxxxxxx xxxxxxxxx, xxxxxxx, xxx xxxxxxx.
xx.xxxxxxx: xYYYxxYY-xYxx-xYxx-YxYY-YYYYxYYxYxxY
---

# Xxxxxx xxxxx xxx xxxxxxxxxxxxx xx xxx Xxxxxx Xxxx xxxxxx


\[ Xxxxxxx xxx XXX xxxx xx Xxxxxxx YY. Xxx Xxxxxxx Y.x xxxxxxxx, xxx xxx [xxxxxxx](http://go.microsoft.com/fwlink/p/?linkid=619132) \]


Xxxxxxxxx Xxxxxxx Xxxxxxxx (XXX) xxx xxxxx xxx xx x xxxx xxxxxxx xx xxxxxxx, xxxx xx xxxxxxx xxxxxxxxx, xxxxxxx, xxx xxxxxxx. X xxxxxx xxx xxxx x xxxx xxxxxxx xx xxxxx xxx xxxxxxx xxxxxxxxxx. Xxxxxxx xxxxxxxx xxxxx xxxxxxx xx xxxxxx xxxx xxxx xx xxxxxxxxxxx x xxxxx xxxxx xx xxxxxxxxxxx xxx xxxxxxxxx xxxxx xxxx xxxxxxxxx. Xxxx xxxxxxxx xxxxxxxxx xxx xxx xxxxxxxxx xx xxxx xx xxxx xxxx xxx xxxx xxxx xxxxx xxxxxxx xxx xxxxx xxx Xxxxxx Xxxx xxxxxxx xxxxx xxxxxxxxx.

> **Xxxx**   Xxx xxxxxx xxxx xxxx xxxxxxxxxxx xx xxxx xxxxxxxx xx xxxxx xx xxx [XxxxxxX Xxxxxx Xxxx xxxx xxxxxx](http://go.microsoft.com/fwlink/?LinkId=624011).

 
Xxxx xxx xxxx xx xxx xxx xxxxxx xxxx xxxx xxxxxxxx xxxxxxxxx xxx xxxx xxx xxxx xxxx xxxxx xx xxxx xxxx:

-   Xxxx xxxxxxxx, xxxxxxx xxxxxxxx xxxxx xxxxxxx xx xxxxxx xxxx xxxx xx xxxxxxxxxxx x xxxxx xxxxx xx xxxxxxxxxxx xxx xxxxxxxxx xxxxx xxxx xxxxxxxxx. Xxxxxxxx xxxx xxxxxxxxxx xxx xxxxxx xxxxx xx xxxxxxxx, xx xxxxxxxx xxxxxxxxx xx xx xxxxxxx xxx xxxxxx xxxxxxxxxx. Xx xxxxxxxx xxx xxxx xxxxxxxxxx xxx xxxxxx XXX xx xxxx xxx xxxx xxxxxx xxxxxxxxx xxxxx xxxxx xxxxxxx.
-   Xx xxxxxxxxxx xxxxx, xxx xxxx xxxxxxxx xxx xxxxxx xxxxxx xxxx xx xxxx xxx xxxxxxx xx xxxxxxxxx, xxxxxxxx, xxx xxxxx. Xx xxxxxxxxxx xxx xxxxxxxxxxxxx, xxxxxx x [**Xxxxxxx::Xxxxxxx::Xxxxxxx::Xxxxxxxxxxxxx**](https://msdn.microsoft.com/library/windows/apps/br225687) xxxxxx xxxx xxx xxxxxxxxxx xxx xxxxxxxxxxx. Xxx Xxxx YYY xxxxxxxxxx xxxxx'x xxxxxxx xxxxxxxxxxxxxx.
-   Xxx xxxxxx-xxxxxx xxxxx, xxxxxxxx xxxxxxx xx xxxxxxx xxxxx xxxx xxx xxxxxxxx Xxxx YYY xxxxxxxxxxx. Xxxx xxx, xxx xxxâ€™x xxxx xx xxxxx xxxx xxxxx xxxxx xxxx xxxxx xxxxxxxxxx.
-   Xxxxxxx Xxxxxxx xxxxxx xxxxxx xxx xxxxxxx xxxxx xxxxxxx.
-   Xxx Xxxx YYY xxxxxxxxxx xxx xxx xxxxxxxxxxxxx xxxxxxx xxxxxxx. Xxxx xx, xxx xxx xxxx xxx xxxx xxxx xxx xxxx xx. Xxx xxxxx, xxxxxx xxxxx xxxxxx xx xxxx xxxxxxxxxx xxxx xxx xxxxxxxxx xx xxxx xxxxx xxxxxxxxxx xxxx.
-   Xxxxxxxx xxxxxxx xx xxxxxxxxx xxxxx xxxxxx xx x xxxxxx xxxxxx. Xxxxx xx xxx xxxxxxxx xxx xxxxx xx xxxxxxxxxxx xx xxxxx xxxxxxxxxx xx xxxx xxxx, xxxx xx xxxxxxx xxxxxxxxxx, xxx xxx xxxx xx xxxxxx xx xxxxx xxxxx xxxx xxxx xx xxxxxxxxx xxxxxx xxxxxxxxxxx.

## Xxxxx xxxxxxx xxxxxxxxx xx Xxxxxx Xxxx


Xxxxxx Xxxx xxxxxxxx Xxxx YYY xxxxxx xxxxxxxxxx xxxxxxx, xxxxx, xxx xxxxx xx xxxxxx xxxx xxxxx, xxx xxx Xxxx YYY xxxxxxxxxx, xxxxx, xxxxx, xxx xxx xxxxxxxxxxxxx xx xxxxxxx xxxx xxxx. Xxxxxx Xxxx xxxx xxx XXxxxx XXX xx xxxx xxx xxxxxxxxxx xxx xxxxx. Xxxxx xxxxxxx xxxxxxxxxxxx xx xxxxx xxx xxxxxxx xx xxxxxxxxx xxxxx. Xx xxxxxxxxxxxxx xx x xxxxxx xxxx xxxxxxxx xxx xxxxx xxxx xx xxxxxxx xxxxx xxx x, x, xxx x xxxx. Xx xxxxx xxx Xxxxxxx Xxxxxxx, xxx xxx xxxx xxx xxxxxxx xxxxx xx xxx xxxxxxxxxxxxx xxxxxx, xx xxxx xx xxxxxxx xxxxx xxxxxx xxxxxxx xxx Xxxxxxx Xxxxxxx xxxxx-xxxxxxxx xxxxxxxxx.

> **Xxxx**  Xxxx xxxxxxxx xxxx xxxxx xx xxxxx xx xxxx xxxxx xxx xxxxx xxxxx xxx xxxxxxx xx xxxxx xx xxx xxxxxx xxxx xxxx xxxxxxx xxxxxx. Xxxxxxx xxxxx xxx xxx xxxxx xxx xxxxxxxx xxxxxxx xxxxxx, xxx xxx xxx xxxxxx xxxxxx xx xxxxxx xxxx xxxxx xxx xxxxxxx xxxx xxxx.

 

> **Xxxx**  Xxx xxxxxxx xxxxxxxx xxxx Xxxxxxxxx xx xxx xxxxxxxxx xxxxxxxx xxx xxx xxxx xx xxxxxxx xxx xxxxxxxxxxx xxxx xxxxxxxx xxxx xxx xxxxxx xxx xxxxxx xx xxxx xxx xxxxxx.

 

## Xxxxxxxxxxxx xxxxx xxxxxxx


Xxx Xxxx YYY xxxxxxxxxx xxxx xxx xxxxxxx xxxxxxxxxxxxxx. Xx xxxxxxxxxx xxxxx, xxx xxxx xxxxxxxx xxx xxxxxxxxx xxxxxx xxxx xx xxxx xxx xxxxxxx xx xxxxxxxxx (xxx xxxxxxx, xxxx xxxx xxxxxxx xxx xxxxx xxxxxx xx xxxxxxx xxx xxxxxx), xxxxxxxx, xxx xxxxx. Xx xxxxxxxxxx xxx xxxxxxxxxxxxx, xxx xxxx xx xxxxxx x [**Xxxxxxx::Xxxxxxx::Xxxxxxx::Xxxxxxxxxxxxx**](https://msdn.microsoft.com/library/windows/apps/br225687) xxxxxx xxxx xxx xxxxxxxxxx xxx xxxxxxxxxxx.

Xxx xxxxxxxxx xxxxxxx xxxxx xxx xxx **XxxxxxXXxxx** xxxxxxxxxxx xxxxxxxxx xxx xxx [**Xxxxxxx::XX::Xxxx::XxxxXxxxxxxxxxxXxxxxXxxxxx::XxxxxxxXxxxxxx**](https://msdn.microsoft.com/library/windows/apps/dn298471), [**Xxxxxxx::XX::Xxxx::XxxxXxxxxxxxxxxXxxxxXxxxxx::XxxxxxxXxxxxxxx**](https://msdn.microsoft.com/library/windows/apps/dn298472), xxx [**Xxxxxxx::XX::Xxxx::XxxxXxxxxxxxxxxXxxxxXxxxxx::XxxxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/dn298469) xxxxxxx xxxxxx xxx xxx [**XxxxXxxxxXxxxx**](https://msdn.microsoft.com/library/windows/apps/dn252834). Xxxxx xxxxxx xxx xxxxxxxxxx xxxxxx xxx xxxxxxxxxxxxxx xxx xxxxxx xxx xxxx xxxx.

Xxxxx xxxxxx xxx xxxxxxx xx x xxxxxxxx xxxxxx xxxx xxxxxxx xxx xxxxx xxxxxxxx.

Xxx xxxx xxxxxxxxxxx xxxxx xxx xxx xxxxxxxxxxx xx xxxxxxxxxxx, xxx [Xxxxxx Xxxx xxxxxxxxxxx xxxxxxxxx](marble-maze-application-structure.md).

```cpp
coreInput->PointerPressed += ref new TypedEventHandler<Object^, PointerEventArgs^>(this, &DirectXPage::OnPointerPressed);
coreInput->PointerMoved += ref new TypedEventHandler<Object^, PointerEventArgs^>(this, &DirectXPage::OnPointerMoved);
coreInput->PointerReleased += ref new TypedEventHandler<Object^, PointerEventArgs^>(this, &DirectXPage::OnPointerReleased);
```

Xxx XxxxxxXxxx xxxxx xxxx xxxxxxx x xxx::xxx xxxxxx xx xxxx xxxxx xxxxxx. Xxx xxx xxx xxxx xxx xxxxxx xx x xxxxx xxxx xxxxxxxx xxxxxxxxxx xxx xxxxx xxxxxxx. Xxxx xxx xxxx xx xxx xxxxxxxx xxxxxxx xxxxx xxxxx xxxxx xxx xxx xxxxxx xx xxx xxxxxx. Xxxxxx Xxxx xxxxx xxxx xxxxx xxxxxx xx xxxxxxxxx xxx xxxxxx xx xxxxx xxx xxxx xx xxxxxx.

```cpp
typedef std::map<int, XMFLOAT2> TouchMap;
TouchMap        m_touches;
```

Xxx XxxxxxXxxx xxxxx xxxxx xx Xxxxxxxxxxxxx xxxxxx.

```cpp
Windows::Devices::Sensors::Accelerometer^           m_accelerometer;
```

Xxx Xxxxxxxxxxxxx xxxxxx xx xxxxxxxxxxx xx xxx XxxxxxXxxx::Xxxxxxxxxx xxxxxx, xx xxxxx xx xxx xxxxxxxxx xxxxxxx. Xxx Xxxxxxx::Xxxxxxx::Xxxxxxx::Xxxxxxxxxxxxx::XxxXxxxxxx xxxxxx xxxxxxx xx xxxxxxxx xx xxx xxxxxxx xxxxxxxxxxxxx. Xx xxxxx xx xx xxxxxxx xxxxxxxxxxxxx, Xxxxxxxxxxxxx::XxxXxxxxxx xxx xxxxx xx x\_xxxxxxxxxxxxx xxxxxxx xxxxxxx.

```cpp
// Returns accelerometer ref if there is one; nullptr otherwise.
m_accelerometer = Windows::Devices::Sensors::Accelerometer::GetDefault();
```

##  Xxxxxxxxxx xxx xxxxx


###  Xxxxxxxx Xxxx YYY xxxxxxxxxx xxxxx

Xxx xxx xxx xxx xxxxx, xxxxx, xx xxx Xxxx YYY xxxxxxxxxx xx xxxxxxxx xxx xxxxx, xx xxxxxxx:

-   Xxx xxx xxxxxxxxxxx xxx xx xxxxxx xxx xxxxxx xxxx xxxx.
-   Xxx xxxxx, xxx X xxxxxx, xx xxx Xxxxx xxxxxx xx xxxx x xxxx xxxx xx xxxxx xxx xxxxxxx xxxx, xxxx xx xxx xxxx-xxxxx xxxxx.
-   Xxx xxx Xxxxx xxxxxx xx xxxxx xx xxxxxx xxx xxxx.
-   Xxxxx xx x xxxx xxxx xxxx xxx xxxxx xx xxxxxx xxxx xxxxxx.

###  Xxxxxxxx xxxxx xxx xxxxx xxxxx

Xx xxxxx Xxxx YYY xxxxxxxxxx xxxxx, xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxxxx xx xxxxx xx xxxxxxx xxxx xxxxxx xxx xxxxx xxxxxxxxx. XXxxxx xxxxxxxx xxxx xxx xxxxxxx xxxxx xx xxx xxxxxxxxxx. Xxxxxxxxx, **XxxxxxXxxx::Xxxxxx** xxxx xxxxxxx xxx xxxxxx xxxx xxxxx, xxx xxxx xxxxxxxx Xxxx YYY xxxxxxxxxx, xxxxxxx xxxx xxxxxx xxx xxxxxxx xxxxxx xxx xxxxxxxx xxxxx xxx xxxxxxx xxxx xxxxxx xx xxxxxxxxx xxxxxxx.

```cpp
// This array contains the constants from XINPUT that map to the 
// particular buttons that are used by the game. 
// The index of the array is used to associate the state of that button in 
// the wasButtonDown, isButtonDown, and combinedButtonPressed variables. 

static const WORD buttons[] = {
    XINPUT_GAMEPAD_A,
    XINPUT_GAMEPAD_START,
    XINPUT_GAMEPAD_DPAD_UP,
    XINPUT_GAMEPAD_DPAD_DOWN,
    XINPUT_GAMEPAD_DPAD_LEFT,
    XINPUT_GAMEPAD_DPAD_RIGHT,
    XINPUT_GAMEPAD_BACK,
};

static const int buttonCount = ARRAYSIZE(buttons);
static bool wasButtonDown[XUSER_MAX_COUNT][buttonCount] = { false, };
bool isButtonDown[XUSER_MAX_COUNT][buttonCount] = { false, };
```

Xxx xxx xxxxxxx xx xx xxxx Xxxx YYY xxxxxxxxxxx xx x Xxxxxxx xxxxxx. Xx xxxxx xxxxxx xx xxxxxx xxx xxxxx xxxxxxxxxx xx xxx xxxxxx xxx, xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxxxxx xxxxx xxxxxx xxx xxxxxxxxxxx.

```cpp
bool combinedButtonPressed[buttonCount] = { false, };
```

Xx xxxx xxxx xxxxxxxx xxxx xxxx xxx xxxxxx, xxx xxxx xx xxxxx xxxxx xxx xxxx xxxxxx xxxxxxxxxx.

Xx x xxxx, xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxx xxxx xxxxxxxxxx xxx xxxxx xxx xxxxx xxx xxxxx xx xxxx xxxxxx.

```cpp
// Account for input on any connected controller.
XINPUT_STATE inputState = {0};
for (DWORD userIndex = 0; userIndex < XUSER_MAX_COUNT; ++userIndex)
{
    DWORD result = XInputGetState(userIndex, &inputState);
    if(result != ERROR_SUCCESS) 
        continue;

    SHORT thumbLeftX = inputState.Gamepad.sThumbLX;
    if (abs(thumbLeftX) < XINPUT_GAMEPAD_LEFT_THUMB_DEADZONE) 
        thumbLeftX = 0;

    SHORT thumbLeftY = inputState.Gamepad.sThumbLY;
    if (abs(thumbLeftY) < XINPUT_GAMEPAD_LEFT_THUMB_DEADZONE) 
        thumbLeftY = 0;

    combinedTiltX += static_cast<float>(thumbLeftX) / 32768.0f;
    combinedTiltY += static_cast<float>(thumbLeftY) / 32768.0f;

    for (int i = 0; i < buttonCount; ++i)
        isButtonDown[userIndex][i] = (inputState.Gamepad.wButtons & buttons[i]) == buttons[i];
}
```

Xxxxx xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxx xxx xxxxx, xx xxxxxxx xxx xxxxxxxx xxxxx xxxxx. Xxx xxxxxxxx xxxxx xxxxx xxxxxx xxxx xxxxx xxxxxxx xxx xxxxxxx xxx xxxx xxx xxxxxxxxxx xxxxxxx. Xxxx xxxxxxx xxx xxxx xx xxxxxxx xx xxxxxx xxxx xx xxx xxxx x xxxxxx xx xxxxxxxxx xxxxxxx, xxx xxx xxxx xxx xxxxxx xx xxxx.

```cpp
bool combinedButtonPressed[buttonCount] = { false, };
for (int i = 0; i < buttonCount; ++i)
{
    for (DWORD userIndex = 0; userIndex < XUSER_MAX_COUNT; ++userIndex)
    {
        bool pressed = !wasButtonDown[userIndex][i] && isButtonDown[userIndex][i];
        combinedButtonPressed[i] = combinedButtonPressed[i] || pressed;
    }
}
```

Xxxxx xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxxxxx xxxxxx xxxxx, xx xxxxxxxx xxx xxxxxxx xxxx xxxx xxxxxx. Xxx xxxxxxx, xxxx xxx Xxxxx xxxxxx (XXXXXX\_XXXXXXX\_XXXXX) xx xxxxxxx, xxx xxxx xxxxx xxxxxxx xxxx xxxxxx xx xxxxxx xx xxxx xxxxxx xx xxxxxx.

```cpp
// Check whether the user paused or resumed the game. 
// XINPUT_GAMEPAD_START  
if (combinedButtonPressed[1] || m_pauseKeyPressed)
{
    m_pauseKeyPressed = false;
    if (m_gameState == GameState::InGameActive)
        SetGameState(GameState::InGamePaused);
    else if (m_gameState == GameState::InGamePaused)
        SetGameState(GameState::InGameActive);
}
```

Xx xxx xxxx xxxx xx xxxxxx, xxx xxxxxx xxxx xxxx xxxxxxx xxxx xxx xxxxxxxxxxx xxx xx xxxxxxx xx xx xxxx. Xx xxx xxxx xxxxxxx xxx xxxxxxx xxxxxxxxx, xxx xxxxxxxxxxx XX xxxxxxx xx xxxxxx xx xxxxx xxxxxx.

```cpp
// Handle menu navigation. 

// XINPUT_GAMEPAD_A or XINPUT_GAMEPAD_START 
bool chooseSelection = (combinedButtonPressed[0] || combinedButtonPressed[1]);

// XINPUT_GAMEPAD_DPAD_UP 
bool moveUp = combinedButtonPressed[2];

// XINPUT_GAMEPAD_DPAD_DOWN 
bool moveDown = combinedButtonPressed[3];                                           

switch (m_gameState)
{
case GameState::MainMenu:
    if (chooseSelection)
    {
        m_audio.PlaySoundEffect(MenuSelectedEvent);

        if (m_startGameButton.GetSelected())
            m_startGameButton.SetPressed(true);

        if (m_highScoreButton.GetSelected())
            m_highScoreButton.SetPressed(true);
    }
    if (moveUp || moveDown)
    {
        m_startGameButton.SetSelected(!m_startGameButton.GetSelected());
        m_highScoreButton.SetSelected(!m_startGameButton.GetSelected());

        m_audio.PlaySoundEffect(MenuChangeEvent);
    }
    break;

case GameState::HighScoreDisplay:
    if (chooseSelection || anyPoints)
        SetGameState(GameState::MainMenu);
    break;

case GameState::PostGameResults:
    if (chooseSelection || anyPoints)
        SetGameState(GameState::HighScoreDisplay);
    break;

case GameState::InGamePaused:
    if (m_pausedText.IsPressed())
    {
        m_pausedText.SetPressed(false);
        SetGameState(GameState::InGameActive); 
    }
    break;
}
```

Xxxxx xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxxxxxx xxxxxxxxxx xxxxx, xx xxxxx xxx xxxxxxx xxxxx xxxxx xxx xxx xxxx xxxxx.

```cpp
// Update the button state for the next frame.
memcpy(wasButtonDown, isButtonDown, sizeof(wasButtonDown));
```

### Xxxxxxxx xxxxx xxx xxxxx xxxxx

Xxx xxxxx xxx xxxxx xxxxx, x xxxx xxxx xx xxxxxx xxxx xxx xxxx xxxxxxx xx xxxxxx xx. Xxx xxxxxxxxx xxxxxxx xxxxx xxx xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxxxxxx xxxxxxx xxxxx xx xxxxxx xxxx xxxxx. Xxx **x\_xxxxxXxxxx** xxxxxx xxxxxxxx xxxxxx xxx xxxxxxxxx xxxxx xxx xxxx xxxxxxx xx xxxxxxx xx xxx xxxxxx. Xxx xxx xx xxxxx Xxxxxx Xxxx xxxxxxxx xxxxxxx xxxxx xx xxxxxxxxx xx xxxxxxx xxxxxx xxxxx xx xxxx xxxxxxxx xx xxx xxxxxxx Xxxxxxxxxx xxxxxxx xxxxx.

```cpp
// Check whether the user chose a button from the UI. 
bool anyPoints = !m_pointQueue.empty();
while (!m_pointQueue.empty())
{
    UserInterface::GetInstance().HitTest(m_pointQueue.front());
    m_pointQueue.pop();
}
```

Xxx **XxxxXxxxxxxxx::XxxXxxx** xxxxxx xxxxxxxxxx xxxxxxx xxx xxxxxxxx xxxxx xx xxxxxxx xx xxx xxxxxx xx xxx XX xxxxxxx. Xxx XX xxxxxxxx xxxx xxxx xxxx xxxx xxx xxxxxx xx xxxxx xxxxxxx. Xxxx xxxxxx xxxx xxx **XxxxxXxXxxx** xxxxxx xxxxxxxx xx xxxxxxxxx xxxxxxx xxx xxxxxxxx xxxxx xx xxxxxxx xx xxx xxxxxx xx xxxx XX xxxxxxx.

```cpp
void UserInterface::HitTest(D2D1_POINT_2F point)
{
    for (auto iter = m_elements.begin(); iter != m_elements.end(); ++iter)
    {
        if (!(*iter)->IsVisible())
            continue;

        TextButton* textButton = dynamic_cast<TextButton*>(*iter);
        if (textButton != nullptr)
        {
            D2D1_RECT_F bounds = (*iter)->GetBounds();
            textButton->SetPressed(PointInRect(point, bounds));
        }
    }
}
```

### Xxxxxxxx xxx xxxx xxxxx

Xxxxx xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxxxxxx xxxxxxxxxx xxx xxxxx xxxxx, xx xxxxxxx xxx xxxx xxxxx xx xxx xxxxxx xxx xxxxxxx.

```cpp
// Update the game state if the user chose a menu option. 
if (m_startGameButton.IsPressed())
{
    SetGameState(GameState::PreGameCountdown);
    m_startGameButton.SetPressed(false);
}
if (m_highScoreButton.IsPressed())
{
    SetGameState(GameState::HighScoreDisplay);
    m_highScoreButton.SetPressed(false);
}
```

##  Xxxxxxxxxxx xxxx xxxx


Xxx xxxx xxxx xxx xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxx xxxxxxxx xx xxxxxx xxx xxxxx xx xxxx xxxxxxx. Xx xxxx xxxx xxxxxxx xxxxx xxxx xxxxxxxx xxxxxxx, xxx xxx xxxxxxxxxx xxx xxxxx xxxx xxx xxxxxxx xxxx xxx xxx xx xxxxxxxxx xx xxxx xxx xxx xxxxx xxxx xxxx'x xxxxxx xx xxxxxxxx. Xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxxxx xxx xxx xx xxxxxxxxx xxxx xxxxxxxxxxx xxxxxxxx xxxx xxx xxxxxxx.

```cpp
float combinedTiltX = 0.0f;
float combinedTiltY = 0.0f;
```

Xxx xxxxx xxxxxxxxx xxx xxxx xxxx xxx xxxxx xxxxxx xx xxxxxxx. Xxx xxxxxxx, xxxxxxx xxxxx xx xxxxxxx xx xxxxx xxx Xxxxxxx Xxxxxxx xxxxx-xxxxxxxx xxxxx. Xxxxxxxxxx, xxx xxxx xxx xxxxx xxxx xxxx xxx Xxxx YYY xxxxxxxxxx xxxx xxx xxxx xx. Xx xxxxxxxxx xxxx xxx xxxxxx xxxxxx xxx xxxxx xxxxxxxxx xxxx xx xxxxxxxxxx xxx x xxxxx xxxxxx. Xxxx xxxxxxx xxxxxxxxx xxx Xxxxxx Xxxx xxxxx xxxxx xxxx xxxx xxxxxx, xxx xx xxxxxxx xxx xxxxxxxx xxxxx xxxxxx, xxx xxx xx xxxx xxx xxxxxxxx xxxxx xxxxxx xx xxxxxx xxx xxxxx xx xxx xxxx.

###  Xxxxxxxxxx xxxxxxx xxxxx

Xxxx xxx xxxx xxxx xxxxxxx xxxxx, xxxx xxx [**Xxxxxxx::XX::Xxxx::XxxxXxxxxxxxxx::XxxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/br208217) xxxxxx xx xxxxxxx xxxxxx xxxxxx. Xxxx xxxx xxxxxx xx xxxx xxxx xxxx xxxxxx xxx xxxxxx xx xxxxxx xxx xxxxx. Xxxxxx Xxxx xxxxxx **XxxxXxxxxxxXxxxxxXxxxxx::XxxxxxxXxxXxXxxxxxx** xx xxxx xxxxxx xx xxxxxxx xxx xxxxxx xxxxxx, xxx xxxx xxxxxxxxxxx xxxxxx. Xxxxx xxxxxx xxx xxxxxxxxx, Xxxxxx Xxxx xxxxxxx xxx xxxxxxxx xxx xxxx xxxxx.

```cpp
// Process windowing events.
CoreWindow::GetForCurrentThread()->Dispatcher->ProcessEvents(CoreProcessEventsOption::ProcessAllIfPresent);
```

Xxx Xxxxxxx Xxxxxxx xxxxx xxx xxxxxxxxxx xxxxxxx xxx xxxx xxxxx xxxx xxxxxxxx. Xxx **XxxxxxXXxx** xxxxx xxxxxxxxx xxx xxxxxx xxx xxxxxxxx xxxxxxx xxxxxxxxxxx xx xxx **XxxxxxXxxx** xxxxx.

```cpp
void DirectXApp::OnPointerPressed(
    _In_ Windows::UI::Core::CoreWindow^ sender,
    _In_ Windows::UI::Core::PointerEventArgs^ args
    )
{
    m_renderer->AddTouch(args->CurrentPoint->PointerId, args->CurrentPoint->Position);
}

void DirectXApp::OnPointerReleased(
    _In_ Windows::UI::Core::CoreWindow^ sender,
    _In_ Windows::UI::Core::PointerEventArgs^ args
    )
{
    m_renderer->RemoveTouch(args->CurrentPoint->PointerId);
}

void DirectXApp::OnPointerMoved(
    _In_ Windows::UI::Core::CoreWindow^ sender,
    _In_ Windows::UI::Core::PointerEventArgs^ args
    )
{
    m_renderer->UpdateTouch(args->CurrentPoint->PointerId, args->CurrentPoint->Position);
}
```

Xxx **XxxxxxXxxx** xxxxx xxxxxx xx xxxxxxx xxxxxx xx xxxxxxxx xxx xxx xxxxxx xxxx xxxxx xxxxx xxxxxx. Xxx **XxxxxxXxxx::XxxXxxxx** xxxxxx xx xxxxxx xxxx xxx xxxxxxx xx xxxxx xxxxxxx, xxx xxxxxxx, xxxx xxx xxxx xxxxxxxxx xxxxxxx xxx xxxxxx xx x xxxxx-xxxxxxx xxxxxx. Xxx **XxxxxxXxxx::XxxXxxxx** xxxxxx xx xxxxxx xxxx xxx xxxxxxx xxxxxxxx xxxxx. Xxx **XxxxxxXxxx::XxxxxxXxxxx** xxxxxx xx xxxxxx xxxx xxx xxxxxxx xx xxxxxxxx, xxx xxxxxxx, xxxx xxx xxxx xxxxx xxxxxxxx xxx xxxxxx.

```cpp
void MarbleMaze::AddTouch(int id, Windows::Foundation::Point point)
{
    m_touches[id] = PointToTouch(point, m_windowBounds);

    m_pointQueue.push(D2D1::Point2F(point.X, point.Y));
}

void MarbleMaze::UpdateTouch(int id, Windows::Foundation::Point point)
{
    if (m_touches.find(id) != m_touches.end())
        m_touches[id] = PointToTouch(point, m_windowBounds);
}

void MarbleMaze::RemoveTouch(int id)
{
    m_touches.erase(id);
}
```

Xxx XxxxxXxXxxxx xxxxxxxx xxxxxxxxxx xxx xxxxxxx xxxxxxx xxxxxxxx xx xxxx xxx xxxxxx xx xx xxx xxxxxx xx xxx xxxxxx, xxx xxxx xxxxxx xxx xxxxxxxxxxx xx xxxx xxxx xxxxx xxxxxxxxxxxxx xxxxxxx -Y.Y xxx +Y.Y. Xxxx xxxxx xx xxxxxx xx xxxxxxxxx xxx xxxx xx xxx xxxx xx x xxxxxxxxxx xxx xxxxxx xxxxxxxxx xxxxx xxxxxxx.

```cpp
inline XMFLOAT2 PointToTouch(Windows::Foundation::Point point, Windows::Foundation::Rect bounds)
{
    float touchRadius = min(bounds.Width, bounds.Height);
    float dx = (point.X - (bounds.Width / 2.0f)) / touchRadius;
    float dy = ((bounds.Height / 2.0f) - point.Y) / touchRadius;

    return XMFLOAT2(dx, dy);
}
```

Xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxxxx xxx xxxxxxxx xxxxx xxxxxx xx xxxxxxxxxxxx xxx xxxx xxxxxx xx x xxxxxxxx xxxxxxx xxxxx. Xxxx xxxxxxx xxxxx xxx xxxxxxxxxx xx xxxxxxxxxxxxx xxxx xxxxxxx xxxxxxxxx xxxxxx.

```cpp
// Account for touch input. 
const float touchScalingFactor = 2.0f;
for (TouchMap::const_iterator iter = m_touches.cbegin(); iter != m_touches.cend(); ++iter)
{
    combinedTiltX += iter->second.x * touchScalingFactor;
    combinedTiltY += iter->second.y * touchScalingFactor;
}
```

### Xxxxxxxxxx xxxxxxxxxxxxx xxxxx

Xx xxxxxxx xxxxxxxxxxxxx xxxxx, xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxx xxx [**Xxxxxxx::Xxxxxxx::Xxxxxxx::Xxxxxxxxxxxxx::XxxXxxxxxxXxxxxxx**](https://msdn.microsoft.com/library/windows/apps/br225699) xxxxxx. Xxxx xxxxxx xxxxxxx x [**Xxxxxxx::Xxxxxxx::Xxxxxxx::XxxxxxxxxxxxxXxxxxxx**](https://msdn.microsoft.com/library/windows/apps/br225688) xxxxxx, xxxxx xxxxxxxxxx xx xxxxxxxxxxxxx xxxxxxx. Xxx **Xxxxxxx::Xxxxxxx::Xxxxxxx::XxxxxxxxxxxxxXxxxxxx::XxxxxxxxxxxxX** xxx **Xxxxxxx::Xxxxxxx::Xxxxxxx::XxxxxxxxxxxxxXxxxxxx::XxxxxxxxxxxxX** xxxxxxxxxx xxxx xxx x-xxxxx xxxxxxxxxxxx xxxxx xxx x xxx x xxxx, xxxxxxxxxxxx.

Xxx xxxxxxxxx xxxxxxx xxxxx xxx xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxx xxx xxxxxxxxxxxxx xxx xxxxxxx xxx xxxxxxxx xxxxx xxxxxx. Xx xxx xxxx xxx xxxxxx, xxxxxxx xxxxxx xxx xxxxxx xx xxxx xxxxxx.

```cpp
// Account for sensors. 
const float acceleromterScalingFactor = 3.5f;
if (m_accelerometer != nullptr)
{
    Windows::Devices::Sensors::AccelerometerReading^ reading =
        m_accelerometer->GetCurrentReading();

    if (reading != nullptr)
    {
        combinedTiltX += static_cast<float>(reading->AccelerationX) * acceleromterScalingFactor;
        combinedTiltY += static_cast<float>(reading->AccelerationY) * acceleromterScalingFactor;
    }
}
```

Xxxxxxx xxx xxxxxx xx xxxx xxxx xx xxxxxxxxxxxxx xx xxxxxxx xx xxx xxxxâ€™x xxxxxxxx, xxxxxx xxxxxx xxxx xxx xxxx x xxxxx Xxxxxxxxxxxxx xxxxxx xxxxxx xxx xxxx xxx xxxxxxxxxxxxx.

### Xxxxxxxxxx Xxxx YYY xxxxxxxxxx xxxxx

Xxx xxxxxxxxx xxxxxxx xxxxx xxx xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxx xxxx xxx Xxxx YYY xxxxxxxxxx xxx xxxxxxx xxx xxxxxxxx xxxxx xxxxxx. Xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxx x xxx xxxx xx xxxxxx xxxxx xx xx xxxxxxxx xxxx xxx xxxxxxxxx xxxxxxxxxx. Xxx **XXxxxxXxxXxxxx** xxxxxx xxxxx xx XXXXXX\_XXXXX xxxxxx xxxx xxxxxxx xxxxx xx xxx xxxxxxxxxx. Xxx **xxxxxxxxXxxxX** xxx **xxxxxxxxXxxxX** xxxxxx xxx xxxxxxx xxxxxxxxx xx xxx x xxx x xxxxxx xx xxx xxxx xxxxxxxxxx.

```cpp
// Account for input on any connected controller.
XINPUT_STATE inputState = {0};
for (DWORD userIndex = 0; userIndex < XUSER_MAX_COUNT; ++userIndex)
{
    DWORD result = XInputGetState(userIndex, &inputState);
    if(result != ERROR_SUCCESS) 
        continue;

    SHORT thumbLeftX = inputState.Gamepad.sThumbLX;
    if (abs(thumbLeftX) < XINPUT_GAMEPAD_LEFT_THUMB_DEADZONE) 
        thumbLeftX = 0;

    SHORT thumbLeftY = inputState.Gamepad.sThumbLY;
    if (abs(thumbLeftY) < XINPUT_GAMEPAD_LEFT_THUMB_DEADZONE) 
        thumbLeftY = 0;

    combinedTiltX += static_cast<float>(thumbLeftX) / 32768.0f;
    combinedTiltY += static_cast<float>(thumbLeftY) / 32768.0f;

    for (int i = 0; i < buttonCount; ++i)
        isButtonDown[userIndex][i] = (inputState.Gamepad.wButtons & buttons[i]) == buttons[i];
}
```

XXxxxx xxxxxxx xxx **XXXXXX\_XXXXXXX\_XXXX\_XXXXX\_XXXXXXXX** xxxxxxxx xxx xxx xxxx xxxxxxxxxx. Xxxx xx xx xxxxxxxxxxx xxxx xxxx xxxxxxxxx xxx xxxx xxxxx.

> **Xxxxxxxxx**  Xxxx xxx xxxx xxxx xxx Xxxx YYY xxxxxxxxxx, xxxxxx xxxxxxx xxx xxx xxxx xxxx. Xxx xxxx xxxx xxxxxx xx xxx xxxxxxxx xxxxx xxxxxxxx xx xxxxx xxxxxxxxxxx xx xxxxxxx xxxxxxxx. Xx xxxx xxxxxxxxxxx, x xxxxx xxxxxxxx xxx xxxxxxxx xx xxxxxxx, xxx xx xxxxxx xx xxx xxxxxxxx x xxxxxxxxxx xxxxxxx. Xx xxxxxxx xxx xxxx xx xxxx xxxx, xxxxxx x xxxx xx xxx-xxxxxxxx xxx xxxxxxx xxxxxxxxxx xxxxxxxx. Xxx xxxx xxxxxxxxxxx xxxxx xxx xxxx xxxx, xxx [Xxxxxxx Xxxxxxx Xxxx XXxxxx.](https://msdn.microsoft.com/library/windows/desktop/ee417001)

 

###  Xxxxxxxx xxxxx xx xxx xxxx xxxxx

Xxxxxxx xxxxxx xxxxx xxxxxx xx xxxxxxxxx xxxx. Xxx xxxxxxx, xxxxxxx xxxxx xxxxx xx xx xxxxxx xxxxxxxxxxx, xxx xxxxxxxxxx xxxxx xxxxx xx xx x xxxxxxxxxx xxxxxxxxx xxxxxx. Xxx xxxxxxxxx xxxx xxxxxxxxx xxxxx xxxx xxxxxxxx xxxxxxx xxxx xxx xxx xx xxxxx xxxxxx xx xxxxxxxxxxxxx, xx xxxxxxxxxx xxxxxx xx x xxxxxx xxxxxx. Xxxxxx Xxxx xxxxxxxxxx xxxxxx xx xxxxxxx xxxx xx xxx xxxxx \[-Y.Y, Y.Y\]. Xx xxxxxxxxx Xxxx YYY xxxxxxxxxx xxxxx, Xxxxxx Xxxx xxxxxxx xxx xxxxx xxxxxx xx YYYYY xxxxxxx xxxxxxxxxx xxxxx xxxxxx xxxxxx xxxx xxxxxxx -YYYYY xxx YYYYY. Xxx **XxxxxXxXxxxx** xxxxxxxx, xxxxx xx xxxxxxxxxx xxxxxxxxx xx xxxx xxxxxxx, xxxxxxxx x xxxxxxx xxxxxx xx xxxxxxxxxx xxxxxx xxxxxxxxxxx xx xxxxxxxxxx xxxxxx xxxx xxxxx xxxxxxxxxxxxx xxxxxxx -Y.Y xxx +Y.Y.

> **Xxx**  Xxxx xx xxxx xxxxxxxxxxx xxxx xxx xxxxx xxxxxx, xx xxxxxxxxx xxxx xxx xxxxxx xxxxxxxxx xxxxx xxxxxx. Xxxxx xx xxx xxxxxxxx xxx xxxxx xx xxxxxxxxxxx xx xxxxx xxxxxxxxxx xx xxxx xxxx, xxxx xx xxxxxxx xxxxxxxxxx, xxx xxxxx xx xxxxxx xx xxxxx xxxxx xxxx xxxx xx xxxxxxxxx xxxxxx xxxxxxxxxxx.

 

Xxxxx xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxxxxxx xxxxx, xx xxxxxxx x xxxxxx xxxx xxxxxxxxxx xxx xxxxxx xx xxx xxxx xx xxx xxxx xx xxx xxxxxx. Xxx xxxxxxxxx xxxxxxx xxxxx xxx Xxxxxx Xxxx xxxx xxx **XXXxxxxxYXxxxxxxxx** xxxxxxxx xx xxxxxx x xxxxxxxxxx xxxxxxx xxxxxx. Xxx *XxxXxxx* xxxxxxxx xxxxxxxxxx xxx xxxxxx xx xxxxx xxx xxxx xxxxx xxx xxxxxxxx xxx xxxx xxxx xxxxxxx xx xxx xxxx.

```cpp
const float maxTilt = 1.0f / 8.0f;
XMVECTOR gravity = XMVectorSet(combinedTiltX * maxTilt, combinedTiltY * maxTilt, 1.0f, 0.0f);
gravity = XMVector3Normalize(gravity);
```

Xx xxxxxxxx xxx xxxxxx xx xxxxx xxxxxxx, Xxxxxx Xxxx xxxxxx xxx xxxxxxx xxxxxxx xxxxxx xx xxx xxxxxxx xxxxxxxxxx, xxxxxxx xxx xxxxxxx xxxxxxxxxx xxx xxx xxxx xxxx xxx xxxxxxx xxxxx xxx xxxxxxxx xxxxx, xxx xxxxxxx xxx xxxxxxxx xxx xxxxxxxxxxx xx xxx xxxxxx. Xx xxx xxxxxx xxx xxxxxx xxxxxxx xxx xxxx, xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxxx xxx xxxxxx xxxx xx xxx xxxx xxxxxxxxxx xxxx xxx xxxxxx xxxxxxx xxx xxxxxx xxx xxxxx xx xxx xxxxxxx xxxxxxxxxx.

```cpp
XMFLOAT3 g;
XMStoreFloat3(&g, gravity);
m_physics.SetGravity(g);
```

```cpp
// Only update physics when gameplay is active.
m_physics.UpdatePhysicsSimulation(timeDelta);
```

```cpp
// Check whether the marble fell off of the maze. 
const float fadeOutDepth = 0.0f;
const float resetDepth = 80.0f;
if (marblePosition.z >= fadeOutDepth)
{
    m_targetLightStrength = 0.0f;
}
if (marblePosition.z >= resetDepth)
{
    // Reset marble.
    memcpy(&marblePosition, &m_checkpoints[m_currentCheckpoint], sizeof(XMFLOAT3));
    oldMarblePosition = marblePosition;
    m_physics.SetPosition((const XMFLOAT3&)marblePosition);
    m_physics.SetVelocity(XMFLOAT3(0, 0, 0));
    m_lightStrength = 0.0f;
    m_targetLightStrength = 1.0f;

    m_resetCamera = true;
    m_resetMarbleRotation = true;
    m_audio.PlaySoundEffect(FallingEvent);
}
```

Xxxx xxxxxxx xxxx xxx xxxxxxxx xxx xxx xxxxxxx xxxxxxxxxx xxxxx. Xxx xxxxxxx xxxxx xxxx, xxx Xxxxxxx.x xxx Xxxxxxx.xxx xx xxx Xxxxxx Xxxx xxxxxxx.

## Xxxx xxxxx


Xxxx [Xxxxxx xxxxx xx xxx Xxxxxx Xxxx xxxxxx](adding-audio-to-the-marble-maze-sample.md) xxx xxxxxxxxxxx xxxxx xxxx xx xxx xxx xxxxxxxxx xx xxxx xx xxxx xxxx xxx xxxx xxxx xxxxx. Xxx xxxxxxxx xxxxxxxxx xxx Xxxxxx Xxxx xxxx Xxxxxxxxx Xxxxx Xxxxxxxxxx xxx XXxxxxY xx xxxx, xxx, xxx xxxx xxxxx xxxxxxxxx.

## Xxxxxxx xxxxxx


* [Xxxxxx xxxxx xx xxx Xxxxxx Xxxx xxxxxx](adding-audio-to-the-marble-maze-sample.md)
* [Xxxxxx xxxxxx xxxxxxx xx xxx Xxxxxx Xxxx xxxxxx](adding-visual-content-to-the-marble-maze-sample.md)
* [Xxxxxxxxxx Xxxxxx Xxxx, x XXX xxxx xx X++ xxx XxxxxxX](developing-marble-maze-a-windows-store-game-in-cpp-and-directx.md)

 

 




<!--HONumber=Mar16_HO1-->
