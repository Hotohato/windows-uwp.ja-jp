---
xxxxx: Xxxxxx xxxxxx xxxxxxx xx xxx Xxxxxx Xxxx xxxxxx
xxxxxxxxxxx: Xxxx xxxxxxxx xxxxxxxxx xxx xxx Xxxxxx Xxxx xxxx xxxx XxxxxxYX xxx XxxxxxYX xx xxx Xxxxxxxxx Xxxxxxx Xxxxxxxx (XXX) xxx xxxxxxxxxxx xx xxxx xxx xxx xxxxx xxx xxxxxxxx xxx xxxxx xxxx xxxx xxx xxxx xxxx xxxx xxx xxxx xxxxxxx.
xx.xxxxxxx: YxYYYYYx-xYxY-xYYx-YxYx-YxYxYxxYYYYY
---

# Xxxxxx xxxxxx xxxxxxx xx xxx Xxxxxx Xxxx xxxxxx


\[ Xxxxxxx xxx XXX xxxx xx Xxxxxxx YY. Xxx Xxxxxxx Y.x xxxxxxxx, xxx xxx [xxxxxxx](http://go.microsoft.com/fwlink/p/?linkid=619132) \]


Xxxx xxxxxxxx xxxxxxxxx xxx xxx Xxxxxx Xxxx xxxx xxxx XxxxxxYX xxx XxxxxxYX xx xxx Xxxxxxxxx Xxxxxxx Xxxxxxxx (XXX) xxx xxxxxxxxxxx xx xxxx xxx xxx xxxxx xxx xxxxxxxx xxx xxxxx xxxx xxxx xxx xxxx xxxx xxxx xxx xxxx xxxxxxx. Xx xxxxx xxx xxxxxx xxxx xxxxxxxxxx xxx xx xxx xxxxxxx xxxxxxxxxxx xxxxxxxxx xx Xxxxxx Xxxx, xxx [Xxxxxx Xxxx xxxxxxxxxxx xxxxxxxxx](marble-maze-application-structure.md).

Xx xxxxxxxx xxxxx xxxxx xxxxx xx xx xxxxxxxxx xxx xxxxxx xxxxxxx xx Xxxxxx Xxxx:

1.  Xxxxxx x xxxxx xxxxxxxxx xxxx xxxxxxxxxxx xxx XxxxxxYX xxx XxxxxxYX xxxxxxxxxxxx.
2.  Xxx xxxxx xxx xxxxx xxxxxxx xxxxxxxx xx xxxxxx xxx Y-X xxx Y-X xxxxxx xxxx xxxxxx xx xxx xxxx.
3.  Xxxxxx xxxx Y-X xxx Y-X xxxxxx xxxxxxxx xxxx xxx xxxxxx xx xxx xxxx.
4.  Xxxxxxxxx xxxxxx xxx xxxxx xxxxxxx xxxx xxxxxxx xxx xxxxxx xxxxxxx xx xxx xxxx xxxxxx.
5.  Xxxxxxxxx xxxx xxxxx, xxxx xx xxxxxxxxx xxx xxxx xxxxx.

Xx xxxx xxxxxxx xxxxx xx xxxxxx Y-X xxxxxx xxx xxxx xx Y-X xxxxxx. Xxx xxxxxxx, xx xxxxxxx xx xxxx xxxx xxxxx xxxxxx xx xxxxx xxx xxxx xxxxxx xxx xxxxx.

Xx xxxx xxxxxx xx xxxxxxx xxxxxxx xxxx xx xxxxx xxxxx xxxxxxxx xxxxx xxxxxx xxx xxxxxxxxxxx xxxxxxx. Xxx xxxxxxx, xx xx xxxx xxxxxxx xx xxx xxxx xxx xxxxxx xxxxxx, xx xxx xx xxxx xxxxxx xxxx xx xxx xxxxxx xxxx xxxx xxxxxxxx xxxxx xxxxxx.

> **Xxxx**   Xxx xxxxxx xxxx xxxx xxxxxxxxxxx xx xxxx xxxxxxxx xx xxxxx xx xxx [XxxxxxX Xxxxxx Xxxx xxxx xxxxxx](http://go.microsoft.com/fwlink/?LinkId=624011).

 
Xxxx xxx xxxx xx xxx xxx xxxxxx xxxx xxxx xxxxxxxx xxxxxxxxx xxx xxxx xxx xxxx xxxx XxxxxxX xxx xxxxxx xxxx xxxxxxx, xxxxxx, xxxx xxx xxxxxxxxxx xxx XxxxxxX xxxxxxxx xxxxxxxxx, xxxx xxxxx xxxxxxxxx, xxx xxxxxx xxx xxxxxx xxx xxxxx:

-   Xxxxxx xxxx xxxxxxx xxxxxxxxx xxxxxxxx xxxx xxxxx. Xxxxx xxxxx xxxx xxxxx xxxxxxx xxxxxxxxx. Xxxx xxxxxxxxxx xxxxx xxxxx xxxxx xx xxxxxx Y-X xxxx xxxxxxx xxx xxxx xx xxxxxx Y-X xxxxxxx.
-   Xxxxx xxxx xxxxxxxxx xxx xxxx xxxx xxx x xxxxx xxxxxxxxxx xx xxxxxxxxxx xxx xxxxxxxx xxxxx xx xxxxxxxx xxxxxxxx xx xxxxxxxx.
-   Xxxxxxx xxxxxxxx xxxxxx-xxxx xxx xxx-xxxx xxxxxxx. Xxxxxxxxx xxxx xxxxxx-xxxx xxxxxx xx xxxxxxxx xxxxxxxxxxx xxx xxxxxx xxxxx xxxxxxxxxx xx xxxxxxx. Xxxxxx xxx xxxxxxxx xxxx xxxxxx xx xxxx xxx xxxxxx xx xxxxxxxxxxx xx xxxxxxxx xx xxx xxxx.
-   Xxx xxxxxx xxx XxxxxxYX xxx XxxxxxYX xxxxxxx xx x XXX xxx xxxx xxxx xxx xx xx x xxxxxxx Xxxxxxx xxxxxxx xxx. Xxx xxxxxxxxx xxxxxxxxxx xx xxx xxx xxxx xxxxx xx xxxxxxxxxx xxxx xxx xxxxxx xxxxxx.
-   Xxxx xxx xxxxxx xxxx xxxx, xxxxxx xxxx xxx xxxx xxxxxx xxxx xxx xxxxxx xxxxxxxx xxxx xxx xxxxxxxxx. Xxx xxxxxxx, xx xxxx xxxx xxxxxxxx xxxxxxxxx, xxxx xxxx xxxx xxx xxx xxxxxx xxxxxxxxx xxxx xxxx xxxx xxxxxx.
-   Xxxxxxxx xxxx xxxxx xxxx xxxxxxxxx xxxxx xx xxxxx xxxxxxxx xxx xxxxx xxxxxxx xxxxxx xxx xxxxxx xxxx.
-   Xxx xxxxxxxxx xxxx xxxx Y-X xxxxx xxxxxxx, xxx xxxx xxx Y-X xxxxxxx xxxx xxxxxx xx xxxxx xx xxx xxxxx.
-   Xxxxxxxxxxx xxxxxxx xx xxx xxxxxxxx xxxxx xx xxxxxx xxxx xxxx xxxx xxxx xxx xxxxx xxxx xxxxxxx xxxxxx xxxx xxxx xxxxx xx xxxxxxxx xxxxx xx xxx xxxxxxx.

## Xxxxxxx xxxxxxx xxxx XxxxxxX xxxxxxxx


Xxxx xx xxxxxxx xxx Xxxxxx Xxxx Xxxxxxxxx Xxxxxxx Xxxxxxxx (XXX) xxxx, xx xxxxx X++ xxx XxxxxxYX YY.Y xxxxxxx xxxx xxx xxx xxxx xxxxxxx xxx xxxxxxxx Y-X xxxxx xxxx xxxxxxx xxxxxxx xxxxxxx xxxx xxxxxxxxx xxx xxxx xxxxxxxxxxx. XxxxxxX YY.Y xxxxxxxx xxxxxxxx xxxx XxxxxxX Y xx XxxxxxX YY, xxx xxxxxxxxx xxx xxxx xxx xxxxx xxxx xxxxxxxxx xxxx xxxxxxxxxxx xxxxxxx xxx xxx'x xxxx xx xxxxxxx xxxx xxx xxxx xx xxx xxxxxxx XxxxxxX xxxxxxxx.

Xxxxxx Xxxx xxxx XxxxxxYX YY.Y xx xxxxxx xxx Y-X xxxx xxxxxx, xxxxxx xxx xxxxxx xxx xxx xxxx. Xxxxxx Xxxx xxxx xxxx XxxxxxYX, XxxxxxXxxxx, xxx Xxxxxxx Xxxxxxx Xxxxxxxxx (XXX) xx xxxx xxx Y-X xxxx xxxxxx, xxxx xx xxx xxxxx xxx xxx xxxxx. Xxxxxxx, Xxxxxx Xxxx xxxx XXXX xx xxxxxxx xx xxx xxx xxx xxxxxx xxx xx xxx XXXX xxxxxxxx.

Xxxx xxxxxxxxxxx xxxxxxxx xxxxxxxx. Xx xxx xxx xxx xx XxxxxxX xxxxxxxx, xx xxxxxxxxx xxxx xxx xxxx Xxxxxxxx x XxxxxxX xxxx xx xxxxxxxxxxx xxxxxxxx xxxx xxx xxxxx xxxxxxxx xx xxxxxxxx x XXX XxxxxxX xxxx. Xx xxx xxxx xxxx xxxxxxxx xxx xxxx xxxxxxx xxx Xxxxxx Xxxx xxxxxx xxxx, xxx xxx xxxxx xx xxx xxxxxxxxx xxxxxxxxx xxx xxxx xx-xxxxx xxxxxxxxxxx xxxxx XxxxxxX xxxxxxxx.

-   [XxxxxxYX YY Xxxxxxxx](https://msdn.microsoft.com/library/windows/desktop/ff476080) Xxxxxxxxx XxxxxxYX YY, x xxxxxxxx, xxxxxxxx-xxxxxxxxxxx Y-X xxxxxxxx XXX xxx xxxxxxxxx Y-X xxxxxxxx xx xxx Xxxxxxx xxxxxxxx.
-   [XxxxxxYX](https://msdn.microsoft.com/library/windows/desktop/dd370990) Xxxxxxxxx XxxxxxYX, x xxxxxxxx-xxxxxxxxxxx, Y-X xxxxxxxx XXX xxxx xxxxxxxx xxxx xxxxxxxxxxx xxx xxxx-xxxxxxx xxxxxxxxx xxx Y-X xxxxxxxx, xxxxxxx, xxx xxxx.
-   [XxxxxxXxxxx](https://msdn.microsoft.com/library/windows/desktop/dd368038) Xxxxxxxxx XxxxxxXxxxx, xxxxx xxxxxxxx xxxx-xxxxxxx xxxx xxxxxxxxx.
-   [Xxxxxxx Xxxxxxx Xxxxxxxxx](https://msdn.microsoft.com/library/windows/desktop/ee719902) Xxxxxxxxx XXX, xx xxxxxxxxxx xxxxxxxx xxxx xxxxxxxx xxx-xxxxx XXX xxx xxxxxxx xxxxxx.

### Xxxxxxx xxxxxx

XxxxxxYX YY xxxxxxxxxx x xxxxxxxx xxxxx xxxxxxx xxxxxx. X xxxxxxx xxxxx xx x xxxx-xxxxxxx xxx xx XXX xxxxxxxxxxxxx. Xxx xxxxxxx xxxxxx xx xxxxxx xxxx xxxx xx xxx xx xxxxxxx xxxxxxxx xx XxxxxxYX xxxxxxxx. Xxxxxx Xxxx xxxxxxxx xxxxxxx xxxxx Y.Y xxxxxxx xx xxxxxxxx xx xxxxxxxx xxxxxxxx xxxx xxx xxxxxx xxxxxx. Xx xxxxxxxxx xxxx xxx xxxxxxx xxx xxxxxxxx xxxxx xx xxxxxxxx xxxxxxxx xxx xxxxx xxxx xxxx xxxxxxx xx xxxx xxxx xxxxxxxxx xxxx xxxx xxxxxx xxxx xx xxx-xxx xxxxxxxxx xxx xxxx x xxxxx xxxxxxxxxx. Xxx xxxx xxxxxxxxxxx xxxxx xxxxxxx xxxxxx, xxx [XxxxxxYX YY xx Xxxxxxxxx Xxxxxxxx](https://msdn.microsoft.com/library/windows/desktop/ff476872).

## Xxxxxxxxxxxx XxxxxxYX xxx XxxxxxYX


X xxxxxx xxxxxxxxxx xxx xxxxxxx xxxxxxx. Xxx xxxxxx xxx XxxxxxYX xxx XxxxxxYX xxxxxxx xx x XXX xxx xxxx xxxx xxx xx xx x xxxxxxx Xxxxxxx xxxxxxx xxx. Xxx xxxx xxxxxxxxxx xx xxx xxx xxxxxxx xxx XxxxxxYX xxxx xxxxx xx xxx xxxxxxxxx xxxxxx.

Xxx *XxxxxxX YY xxx XXXX Xxx (Xxxxxxxxx Xxxxxxx)* xxxxxxx xxx xxxx xxxxxxx xxxxxxxxx xxxxxx xxx Y-X xxxxxxxxx xxxxxxxxx xxxx xxx xxxx-xxxxxxxx xxxxxxxxx. Xxx **XxxxxxXxxxxxxxx** xxxxx xx x xxxxxxxxxx xxx xxxxxxxx XxxxxxYX xxx XxxxxxYX. Xxxx xxxxx xxxxxxx xxxxxxx xxxxxxxxxxxxxx, xxx xxx xxxx-xxxxxxxx xxxxxx. Xxxxxx Xxxx xxxxxxx xxx **XxxxxxXxxx** xxxxx xx xxxxxx xxxx-xxxxxxxx xxxxxx, xxxxx xxx x xxxxxxxxx xx x **XxxxxxXxxxxxxxx** xxxxxx xx xxxx xx xxxxxx xx XxxxxxYX xxx XxxxxxYX.

Xxxxxx xxxxxxxxxxxxxx, xxx **XxxxxxXxxxxxxxx::Xxxxxxxxxx** xxxxxx xxxxxxx xxxxxx-xxxxxxxxxxx xxxxxxxxx xxx xxx XxxxxxYX xxx XxxxxxYX xxxxxxx.

```cpp
// Initialize the Direct3D resources required to run. 
void DeviceResources::DeviceResources(CoreWindow^ window, float dpi)
{
    m_window = window;

    CreateDeviceIndependentResources();
    CreateDeviceResources();
    CreateWindowSizeDependentResources();
    SetDpi(dpi);
}
```

Xxx **XxxxxxXxxxxxxxx** xxxxx xxxxxxxxx xxxx xxxxxxxxxxxxx xx xxxx xx xxx xxxx xxxxxx xxxxxxx xxxx xxx xxxxxxxxxxx xxxxxxx. Xxx xxxxxxx, xx xxxxx xxx **XxxxxxXxxxxxXxxxXxxxxxxxxXxxxxxxxx** xxxxxx xxxx xxx xxxxxx xxxx xxxxxxx.

###  Xxxxxxxxxxxx xxx XxxxxxYX, XxxxxxXxxxx, xxx XXX xxxxxxxxx

Xxx **XxxxxxXxxxxxxxx::XxxxxxXxxxxxXxxxxxxxxxxXxxxxxxxx** xxxxxx xxxxxxx xxx xxxxxxxxx xxx XxxxxxYX, XxxxxxXxxxx, xxx XXX. Xx XxxxxxX xxxxxxxx, xxxxxxxxx xxx xxx xxxxxxxx xxxxxx xxx xxxxxxxx xxxxxxxx xxxxxxxxx. Xxxxxx Xxxx xxxxxxxxx **XYXY\_XXXXXXX\_XXXX\_XXXXXX\_XXXXXXXX** xxxxxxx xx xxxxxxxx xxx xxxxxxx xx xxx xxxx xxxxxx.

```cpp
// These are the resources required independent of hardware. 
void DeviceResources::CreateDeviceIndependentResources()
{
    D2D1_FACTORY_OPTIONS options;
    ZeroMemory(&options, sizeof(D2D1_FACTORY_OPTIONS));

#if defined(_DEBUG)
     // If the project is in a debug build, enable Direct2D debugging via SDK Layers.
    options.debugLevel = D2D1_DEBUG_LEVEL_INFORMATION;
#endif

    DX::ThrowIfFailed(
        D2D1CreateFactory(
            D2D1_FACTORY_TYPE_SINGLE_THREADED,
            __uuidof(ID2D1Factory1),
            &options,
            &m_d2dFactory
            )
        );

    DX::ThrowIfFailed(
        DWriteCreateFactory(
            DWRITE_FACTORY_TYPE_SHARED,
            __uuidof(IDWriteFactory),
            &m_dwriteFactory
            )
        );

    DX::ThrowIfFailed(
        CoCreateInstance(
            CLSID_WICImagingFactory,
            nullptr,
            CLSCTX_INPROC_SERVER,
            IID_PPV_ARGS(&m_wicFactory)
            )
        );
}
```

###  Xxxxxxxx xxx XxxxxxYX xxx XxxxxxYX xxxxxxx

Xxx **XxxxxxXxxxxxxxx::XxxxxxXxxxxxXxxxxxxxx** xxxxxx xxxxx [**XYXYYXxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476082) xx xxxxxx xxx xxxxxx xxxxxx xxxx xxxxxxxxxx xxx XxxxxxYX xxxxxxx xxxxxxx. Xxxxxxx Xxxxxx Xxxx xxxxxxxx xxxxxxx xxxxx Y.Y xxx xxxxx, xxx **XxxxxxXxxxxxxxx::XxxxxxXxxxxxXxxxxxxxx** xxxxxx xxxxxxxxx xxxxxx Y.Y xxxxxxx YY.Y xx xxx xxxxx xx **\\** xxxxxx. XxxxxxYX xxxxx xxx xxxx xx xxxxx xxx xxxxx xxx xxx xxx xxxxx xxxxxxx xxxxx xxxx xx xxxxxxxxx. Xxxxxxxxx xxx **XYX\_XXXXXXX\_XXXXX** xxxxx xxxxxxx xxx xxxxxx xxxx xxxxxxx xx xxxxxx xx xxxx xxx xxx xxxx xxx xxx xxxxxxx xxxxx xxxxxxx xxxxx xxxxxxxxx. Xxx **XxxxxxXxxxxxxxx::XxxxxxXxxxxxXxxxxxxxx** xxxxxx xxxxxxx xxx XxxxxxYX YY.Y xxxxxx xx xxxxxxxx xxx XxxxxxYX YY xxxxxx xxxx'x xxxxxxxx xxxx **XYXYYXxxxxxXxxxxx**.

```cpp
// This array defines the set of DirectX hardware feature levels this app will support. 
// Note the ordering should be preserved. 
// Don't forget to declare your application's minimum required feature level in its 
// description.  All applications are assumed to support 9.1 unless otherwise stated.
D3D_FEATURE_LEVEL featureLevels[] = 
{
    D3D_FEATURE_LEVEL_11_1,
    D3D_FEATURE_LEVEL_11_0,
    D3D_FEATURE_LEVEL_10_1,
    D3D_FEATURE_LEVEL_10_0,
    D3D_FEATURE_LEVEL_9_3,
    D3D_FEATURE_LEVEL_9_2,
    D3D_FEATURE_LEVEL_9_1
};

// Create the DX11 API device object, and get a corresponding context.
ComPtr<ID3D11Device> device;
ComPtr<ID3D11DeviceContext> context;
DX::ThrowIfFailed(
    D3D11CreateDevice(
        nullptr,                    // Specify null to use the default adapter.
        D3D_DRIVER_TYPE_HARDWARE,
        0,                          // Leave as 0 unless it is a software device.
        creationFlags,              // Optionally, set debug and Direct2D compatibility flags.
        featureLevels,              // A list of feature levels that this app can support.
        ARRAYSIZE(featureLevels),   // The number of entries in the above list.
        D3D11_SDK_VERSION,          // Always set this to D3D11_SDK_VERSION for modern.
        &device,                    // Returns the Direct3D device created.
        &m_featureLevel,            // Returns the feature level of the device created.
        &context                    // Returns the device immediate context.
        )
    );    

// Get the Direct3D 11.1 device by querying the Direct3D 11 device.
DX::ThrowIfFailed(
    device.As(&m_d3dDevice)
    );
```

Xxx **XxxxxxXxxxxxxxx::XxxxxxXxxxxxXxxxxxxxx** xxxxxx xxxx xxxxxxx xxx XxxxxxYX xxxxxx. XxxxxxYX xxxx Xxxxxxxxx XxxxxxX Xxxxxxxx Xxxxxxxxxxxxxx (XXXX) xx xxxxxxxxxxxx xxxx XxxxxxYX. XXXX xxxxxxx xxxxx xxxxxx xxxxxxxx xx xx xxxxxx xxxxxxx xxxxxxxx xxxxxxxx. Xxxxxx Xxxx xxxx xxx xxxxxxxxxx XXXX xxxxxx xxxx xxx XxxxxxYX xxxxxx xx xxxxxx xxx XxxxxxYX xxxxxx xxxx xxx XxxxxxYX xxxxxxx.

```cpp
// Obtain the underlying DXGI device of the Direct3D 11.1 device.
DX::ThrowIfFailed(
    m_d3dDevice.As(&dxgiDevice)
    );

// Obtain the Direct2D device for 2-D rendering.
DX::ThrowIfFailed(
    m_d2dFactory->CreateDevice(dxgiDevice.Get(), &m_d2dDevice)
    );

// And get its corresponding device context object.
DX::ThrowIfFailed(
    m_d2dDevice->CreateDeviceContext(
        D2D1_DEVICE_CONTEXT_OPTIONS_NONE,
        &m_d2dContext
        )
    );
```

```cpp
// Obtain the underlying DXGI device of the Direct3D 11.1 device.
DX::ThrowIfFailed(
    m_d3dDevice.As(&dxgiDevice)
    );

// Obtain the Direct2D device for 2-D rendering.
DX::ThrowIfFailed(
    m_d2dFactory->CreateDevice(dxgiDevice.Get(), &m_d2dDevice)
    );

// And get its corresponding device context object.
DX::ThrowIfFailed(
    m_d2dDevice->CreateDeviceContext(
        D2D1_DEVICE_CONTEXT_OPTIONS_NONE,
        &m_d2dContext
        )
    );
```

Xxx xxxx xxxxxxxxxxx xxxxx XXXX xxx xxxxxxxxxxxxxxxx xxxxxxx XxxxxxYX xxx XxxxxxYX, xxx [XXXX Xxxxxxxx](https://msdn.microsoft.com/library/windows/desktop/bb205075) xxx [XxxxxxYX xxx XxxxxxYX Xxxxxxxxxxxxxxxx Xxxxxxxx](https://msdn.microsoft.com/library/windows/desktop/dd370966).

### Xxxxxxxxxxx XxxxxxYX xxxx xxx xxxx

Xxx **XxxxxxXxxxxxxxx::XxxxxxXxxxxxXxxxXxxxxxxxxXxxxxxxxx** xxxxxx xxxxxxx xxx xxxxxxxx xxxxxxxxx xxxx xxxxxx xx x xxxxx xxxxxx xxxx xxxx xx xxx xxxx xxxxx xxx XxxxxxYX xxx XxxxxxYX xxxxxx xxxxxxx. Xxx xxxxxxxxx xxx xxxx x XxxxxxX XXX xxx xxxxxxx xxxx x xxxxxxx xxx xx xxx xxx xxxx xxxxx xx xxxxxxxxxx xxxx xxx xxxxxx xxxxxx. X xxxx xxxxx xx xxxxxxxxxxx xxx xxxxxxxxxx xxx xxxxxx xx xxxxx xxx xxxxxx xxxxxxx xx xxx xxxxxxx. Xxx xxxxxxxx Xxxxxx Xxxx xxxxxxxxxxx xxxxxxxxx xxxxxxxxx xxx xxx xxxxxxxxx xxxxxx xxx x XXX xxx xxxxxxx xxxx x xxxxxxx xxx. Xxxxxxx x Xxxxxxx Xxxxx xxx xxxx xxx xxxx xxxx **XXXX** xxxxxxx, Xxxxxx Xxxx xxxx xxx xxx [**XXXXXXxxxxxxY::XxxxxxXxxxXxxxxXxxXxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/hh404559) xxxxxx xx xxxxxxxxx xxx xxxxxx xxxxxx xx xxx xxxx. Xxx xxxxxxxxx xxxxxxx xxxxx xxx xxxx xx xxx **XxxxxxXxxxxxxxx::XxxxxxXxxxxxXxxxXxxxxxxxxXxxxxxxxx** xxxxxx xxxx xxxxxxx xxx xxxx xxxxx.

```cpp
// Obtain the final swap chain for this window from the DXGI factory.
DX::ThrowIfFailed(
    dxgiFactory->CreateSwapChainForCoreWindow(
        m_d3dDevice.Get(),
        reinterpret_cast<IUnknown*>(m_window),
        &swapChainDesc,
        nullptr,    // Allow on all displays.
        &m_swapChain
        )
    );
```

Xx xxxxxxxx xxxxx xxxxxxxxxxx, xxxxx xx xxxxxxxxx xx xx xx xxxxxxx-xxxxxxx xxxxxxx xxxx xx xxxxxxx xxx xxxxxxx, xxx **XxxxxxXxxxxxxxx::XxxxxxXxxxxxXxxxXxxxxxxxxXxxxxxxxx** xxxxxx xxxxx xxx [**XXXXXXxxxxxY::XxxXxxxxxxXxxxxXxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ff471334) xxxxxx xx xxxxxx xxxx xxx xxxx xx xxxxxxxx xxxx xxxxx xxx xxxxxxxx xxxxx. Xxxxxxxxxxxxx xxxx xxx xxxxxxxx xxxxx xx xxxxxxxxx xx xxxxxxx xxxxxx xx xxx xxxxxxx Xxxxxxxxxx xxx xxxxx xx xxxx xxxxxxxx.

```cpp
// Ensure that DXGI does not queue more than one frame at a time. This both reduces  
// latency and ensures that the application will only render after each VSync, minimizing  
// power consumption.
DX::ThrowIfFailed(
    dxgiDevice->SetMaximumFrameLatency(1)
    );
```

Xxx **XxxxxxXxxxxxxxx::XxxxxxXxxxxxXxxxXxxxxxxxxXxxxxxxxx** xxxxxx xxxxxxxxxxx xxxxxxxx xxxxxxxxx xx x xxx xxxx xxxxx xxx xxxx xxxxx.

> **Xxxx**   Xxx xxxx *xxxx* xxx x xxxxxxxxx xxxxxxx xx xxx Xxxxxxx Xxxxxxx xxxx xx xxx xx XxxxxxYX. Xx xxx Xxxxxxx Xxxxxxx, x xxxx xxxxxx xx xxx xxxxxxxxxx xx xxxx xxxxxxxxx xxxxxxxx xxx xx xxx, xxxxxxxxx xxx xxxxxxx xxxx xxx xxx xxxxx xxxxxxxxx, xxxx xxx xxxxxx xx xxxx xxx xxxxxxxxxx. Xxx xxxxxxx xxx xxxxxxxxxxxxx xxx xxxxxxxx xxx xxxx xxxx xxx xxxxxx x xxxx. Xxx xxxxxxx xx xxxxxxx xx xxx xxx xxxx xx xxxxxxxxx xx [Xxxxxx Xxxx xxxxxxxxxxx xxxxxxxxx](marble-maze-application-structure.md). Xx XxxxxxYX, xxx xxxx xxxx xxx xxxxxxxx xxxxxxxx. Xxxxx, x xxxxxxxx xxxx xxxxxxx xxx xxxxxxxxxxxx xxxx x xxxxxxxx xxx xxxxxx. Xxx xxxxxxx, xxxx x xxxxxxx xxxxxx xx xxxxxxxxxx xxxx x xxxxxx xxxxxxxx xxxx, xxxx xxxxxx xxx xxxxx xxxxxx xxx xxxxxxx. Xxx xxxxxxxxx xx x xxxxxxxx xxxx xx xxxx xxx xxx xxxxxxxxx xxxx xx xxxxxxxxx xxxx xx xxxxxxxxx xxxxxx xx xxx xxxxxxxxx xxxxxxxx. Xxx xxxx xxxxxxxxxxx xxxxx xxxxxxxx xxxxx, xxx [Xxxxxxx Xxxxx (XxxxxxYX YY)](https://msdn.microsoft.com/library/windows/desktop/bb205128). Xxxx xxxx xx xxx xxxxxxx xx x xxxx xxxxxxxxx xx xxxx xxxxxxxxx xxxxxx, xxxx xxxxxx xx xxx xxxxxxxx xxx xxxxxxxxxxx xx xxx xxxxxx. X xxxx xxxxxxxxx xxxxxxxxx xxxxxxx xx xxx xxxxx xxxxxx xxx xxxxxx’x xxxxxxxx xxx xxxxxxxxxxx. Xxx xxxx xxxxxxxxxxx xxxxx xxxx xxxxxxxxxx, xxx [Xxxx Xxxxxxxxx (XxxxxxYX Y)](https://msdn.microsoft.com/library/windows/desktop/bb206342). Xxx Xxxxxx Xxxx xxxx xxxxxxxx xxx xxxxxx xxxxx xx xxxxxxxxx xx xxxxxxx xxxxxx xx xxxx xxxxx.

 

## Xxxxxxx xxxxx xxxxxxxxx


Xxxxxx Xxxx xxxx xxx **XxxxxXxxxxx** xxxxx, xxxxx xx xxxxxxxx xx XxxxxXxxxxx.x, xx xxxx xxxxxxxx xxx xxxxxxx. Xxxxxx Xxxx xxxx xxx **XXXXxxx** xxxxx xx xxxx xxx Y-X xxxxxx xxx xxx xxxx xxx xxx xxxxxx.

Xx xxxxxx x xxxxxxxxxx xxx, Xxxxxx Xxxx xxxxx xxxxx xxxxxxxxx xxxxxxxxxxxxxx, xx xx xxx xxxxxxxxxx. Xx xxxxxx xxxx xx xxx xxxxxxxxxx, xxxx xxxx xxx xxxxxxx xx xxxxxx xxxxxx. Xxxx xxxxxxx xx xxxxxxxxx xx xxxxxxx xxxxxx xx [Xxxxxxx xxxx xxxxxx xx xxx xxxxxxxxxx](marble-maze-application-structure.md#loading_game_assets) xx xxxx xxxxx.

###  Xxxxxxx xxx Y-X xxxxxxx xxx xxxx xxxxxxxxx

Xx Xxxxxx Xxxx, xxx xxxxxxx xx xxx xxxxx xxxx xxxxxxx xx xxx xxx xx xxx xxxxxx. Xxx xxxxxxx xxxxxx xxxxxxx xx xxxxx xx xxx xxxxx. Xx Xxxxxx Xxxx, xxx xxxxxxx xxxxxxxx xxx Xxxxxxx xxxx xxx xxx xxxx xxxxxx "XxxxxxX Xxxxxx Xxxx xxxx xxxxxx". Xxx xxxxxxxxxx xx xxx xxxxxxx xx xxxxxxxxx xx xxx **XxxxxxXxxxxxx** xxxxx, xxxxx xx xxxxxxx xx XxxxxxXxxxxxx.x. Xxxxxxxx xx xxx xxx xxxxxxx xx xxxx xx xxx XxxxxxYX xxxxxxx, xxx xxx xxxxx xxxx xxxx xx xxxxxxx xxx xxxxx xxxx xxxxxxx xx xxxxx xx xxxx xxxxx.

Xxx xxxxxxxxx xxxxxx xx xxx xxxxxxx xx xxxx, xxxxxxx xxx xxxxxxxx xx xxx xxxxxx, xxx **XxxxxxXxxxxxx** xxxxx xxxxx, xx xxxxxx, xxx xxxxxxxx xx xx [**XXYXYXxxxxxY**](https://msdn.microsoft.com/library/windows/desktop/hh404349) xxxxxx xxxxxx xxxxxxxxxxxxxx. Xx xxxx xxxx, xxx **XxxxxxXxxxxxx** xxxxx xxxx xxx xx xxxx xxx xxxxxx xx xxx xxxxxx. Xx xxxx xxx, xxxxxxxxx xxxxxxxx xxxx xx xxxx xxxxxxx xx xxx xxxx xx xx xxxxxxxxx xxx xxxxx xxxxx.

Xxx xxxx xxxxxxxxx (XX) xxxxxxxx xx Y-X xxxxxxxxxx, xxxx xx xxxxx xxx xxxxx-xx xxxxxxxx (XXXx), xxxxx xxxxxx xx xxxxx xx xxxx xxxxx. Xxxxxx Xxxx xxxxxxx xxx xxxxxxxxx XX xxxxxxxx:

-   Xxxx xxxxx xxxx xxxxxx xxx xxxx xx xxxxx xxx xxxx xx xxxx xxxx xxxxxx.
-   X xxxxx xxxx xxxxxx xxxx xxx xxxxx xxxxxxx xxxxxx xxxx xxxxxx.
-   X xxxxx xxxx xxxxxx xxx xxxxxxx xxxx xxxx.
-   X xxxxx xxxx xxxxx xxx xxxxxxx xxxxxx xxxxx.
-   Xxxx xxxx xxxxx "Xxxxxx" xxxx xxx xxxx xx xxxxxx.

Xxxxxx Xxxx xxxxxxx xxxx-xxxxxxxx XX xxxxxxxx xx XxxxXxxxxxxxx.x. Xxxxxx Xxxx xxxxxxx xxx **XxxxxxxXxxx** xxxxx xx x xxxx xxxx xxx xxx XX xxxxxxxx. Xxx **XxxxxxxXxxx** xxxxx xxxxxxx xxxxxxxxxx xxxx xx xxx xxxx, xxxxxxxx, xxxxxxxxx, xxx xxxxxxxxxx xx x XX xxxxxxx. Xx xxxx xxxxxxxx xxx xxxxxxxx xxx xxxxxxx xxx xxxxxxxx.

```cpp
class ElementBase
{
public:
    virtual void Initialize() { }
    virtual void Update(float timeTotal, float timeDelta) { }
    virtual void Render() { }

    void SetAlignment(AlignType horizontal, AlignType vertical);
    virtual void SetContainer(const D2D1_RECT_F& container);
    void SetVisible(bool visible);

    D2D1_RECT_F GetBounds();

    bool IsVisible() const { return m_visible; }

protected:
    ElementBase();

    virtual void CalculateSize() { }

    Alignment       m_alignment;
    D2D1_RECT_F     m_container;
    D2D1_SIZE_F     m_size;
    bool            m_visible;
};
```

Xx xxxxxxxxx x xxxxxx xxxx xxxxx xxx XX xxxxxxxx, xxx **XxxxXxxxxxxxx** xxxxx, xxxxx xxxxxxx xxx xxxx xxxxxxxxx, xxxx xxxx xxxx x xxxxxxxxxx xx **XxxxxxxXxxx** xxxxxxx, xxxxx xxxxxxxxxx XX xxxxxxxxxx xxx xxxxxxxx x xxxx xxxxxxxxx xxxxxxx xxxx xx xxxxxxxx. Xxxxxx Xxxx xxxxxxx xxxxx xxxx xxxxxx xxxx **XxxxxxxXxxx** xxxx xxxxxxxxx xxxx-xxxxxxxx xxxxxxxxx. Xxx xxxxxxx, **XxxxXxxxxXxxxx** xxxxxxx xxx xxxxxxxx xxx xxx xxxx xxxxx xxxxx. Xxx xxxx xxxx xxxxx xxxxx xxxxx, xxxxx xx xxx xxxxxx xxxx.

> **Xxxx**   Xxxxxxx XXXX xxxxxxx xxx xx xxxx xxxxxx xxxxxx xxxxxxx xxxx xxxxxxxxxx, xxxx xxxxx xxxxx xx xxxxxxxxxx xxx xxxxxxxx xxxxx, xxxxxxxx xxxxxxx xx xxx XXXX xx xxxxxx xxxx XX. Xxx xxxx xxxxx xxx xx xxxxxxx x xxxx xxxxxxxxx xx XXXX xx x XxxxxxX XXX xxxx, xxx [Xxxxxx xxx xxxx xxxxxx (Xxxxxxx)](tutorial-resources.md). Xxxx xxxxxxxx xxxxxx xx xxx XxxxxxX Y-X xxxxxxxx xxxx xxxxxx.

 

###  Xxxxxxx xxxxxxx

Xxxxxx Xxxx xxxx xxx **XxxxxXxxxxx::XxxxXxxxxx** xxxxxx xx xxxx x xxxxxx xxxx x xxxx.

Xxxxxxx xxx xxx xxxxxxxxxxx xxxx xx XXX xxxxxxxxxxx xx xxxxx xxxxx. Xxxxxx xxx Y-X xxxxxxxx xxxxxxxxxx xx xxxxxx xxxxxxx xxxxxxx, xxxxxxx xx xx xxxxx xxxxxxxxxxxxxx xxx xxxxx xxxxxxxx, xx xxxx xxxxxxx xxxxxxxx xxxxxxxxxx, xxxx xxxxxxxxx xxxxxxxx xx xxxxxxxxxxxx. Xxx xxxx xxxxxxxxxxx xxxxx xxx xxxxxx xxxxxxxxxxx xxxxx, xxx [XXXX](https://msdn.microsoft.com/library/windows/desktop/bb509561).

Xxxxxx Xxxx xxxx xxxxxx xxx xxxxx xxxxxxx. X xxxxxx xxxxxx xxxxxx xxxxxxxx xx xxx xxxxx xxxxxx xxx xxxxxxxx xxx xxxxxx xx xxxxxx. X xxxxx xxxxxx xxxxx xxxxxxx xxxxxx, xxxxxxx xxxx, xxxxxxxxxxxx xxx-xxxxxx xxxxxx, xxx xxxxx xxxx xx xxxxxxx x xxxxx xxxxx xx xxxxxx. Xxxxxxx x xxxxxx xxxxxxxxxx xxx xxxxxxx xx x xxxx, xxxxxxxx xxxxxxxx xxxx xxxxxxxx xxxxxxxx xxxxxx xxxxxxxxx xxx xxxxxxx xxxx xx xxxxxxxx xx xxxxxxxx. Xxx xxxxxx xx xxxxxxxx xxxxxxxxx xxxx xxx xxxxxxxxx xx xxx XXX xxx xx xxxxxx xxxxxxx xxxx xxx xxxxxx xxxx xx xxxxxxxxx xx xxx XXX. Xxxxxxxxx, xxxx xxxxx xxxxxxx xxx xxxxxxx xxxxxxx xxxxxxxxxx.

Xxx **XxxxxxXxxx::XxxxXxxxxxxxXxxxxxxxx** xxxxxx xxxxx xxx xxxxxx xxxxxx xxx xxx xxxxx xxxxxx xxxxx xx xxxxx xxx xxxxxxx. Xxx xxxxxx-xxxx xxxxxxxx xx xxxxx xxxxxxx xxx xxxxxxx xx XxxxxXxxxxxXxxxxx.xxxx xxx XxxxxXxxxxXxxxxx.xxxx, xxxxxxxxxxxx. Xxxxxx Xxxx xxxxxxx xxxxx xxxxxxx xx xxxx xxx xxxx xxx xxx xxxx xxxxxx xxx xxxxxxxxx xxxxx.

Xxx Xxxxxx Xxxx xxxxxxx xxxxxxxx xxxx .xxxx (xxx xxxxxx-xxxx xxxxxx) xxx .xxx (xxx xxx-xxxx xxxxxx) xxxxxxxx xx xxx xxxxxx xxxxx. Xx xxxxx xxxx, Xxxxxx Xxxxxx xxxx xxx xxx.xxx xxxxxx-xxxxxxxx xx xxxxxxx xxxx .xxxx xxxxxx xxxx xxxx x .xxx xxxxxx xxxxxx. Xxx xxxx xxxxxxxxxxx xxxxx xxx xxxxxx-xxxxxxxx xxxx, xxx [Xxxxxx-Xxxxxxxx Xxxx](https://msdn.microsoft.com/library/windows/desktop/bb232919).

Xxx xxxxxx xxxxxx xxxx xxx xxxxxxxx xxxxx, xxxx xxx xxxxxxxxxx xxxxxxxx xx xxxxxxxxx xxx xxxxx xxxxxxxx. Xxxxxxxx xxxx xxxx xxx xxxxx xxxxxxxx xx xxxxxxxxxxx xxx xxxxxx xxxxx: xxxx xx xxxxxx xxxxx, xxxxx xx xxxxxxxxx xxx xxxxxxxxx, xxx xxxxx xx xxxxx xxxxx xx xxxxxx xxx xxxxx xxxxxx xx xxxxxxx xxxxxxxx xxxxxxxxxxxx. Xxx xxxxxxx xxxxxx xxxxxx xx xxxxxxxxxxx xx xxxxx xxxxx, xxxxx xx xxxx xxxx xx xxx xxxxx xxxxxx xxx xxxxxxxx. Xxx xxxxxxx xxxxxxxxxxx xxx xxxxxx xxxxxxx xxxxxxxxx xx xxx xxxxx xxxxxx.

```hlsl
sPSInput main(sVSInput input)
{
    sPSInput output;
    float4 temp = float4(input.pos, 1.0f);
    temp = mul(temp, model);
    output.worldPos = temp.xyz / temp.w;
    temp = mul(temp, view);
    temp = mul(temp, projection);
    output.pos = temp;
    output.tex = input.tex;
    output.norm = mul(float4(input.norm, 0.0f), model).xyz;
    return output;
}
```

Xxx xxxxx xxxxxx xxxxxxxx xxx xxxxxx xx xxx xxxxxx xxxxxx xx xxxxx. Xxxx xxxxxx xxxxxxxx xxxxxxxx xxxxxxxxxxxx xx xxxxx x xxxx-xxxxx xxxxxxxxx xxxx xxxxxx xxxx xxx xxxx xxx xx xxxxxxx xxxx xxx xxxxxxxx xx xxx xxxxxx. Xxxxxxxx xx xxxxxxxxx xxx xxxxxxxx xxxx xxxxx xxxxxxxx xxxxxx xxx xxxxx. Xxx xxxxxxx xxxxxxxxx xxxxxx xxx xx xxxx xx xxx xxxxxxx xxxxxx xxxxxxx xxxxxxxxxxxxx xx xxx xxxxx, xxx xxx xxxxxxx xxxx xxxxxxxxxx xx xxx xxxxxx xxxxxx xxxx xxxx xxx xxxxx. Xxxxxx xxxxxx xx xxx xxxxxx (xxx xxxxxxxxx xxxxxx xx xxx xxxxxx xx xxx xxxxxxxxx) xxx xxx xxxx xxxxxxxx. Xxxxxxx, xxxxxxxx xx xxxxxxxxx xxx xxxxxx xxxxxxxxxx xxx xxxxxx xx xxxxxxxx x xxxx xxxxxx. Xx x xxxx xxxxxxxxxxx, xx xxxxxx xxxx xxx xxxxx xxxxxx xxxxx xxxxxxxxx xxxxxxx xxx xxxxxxxxx xxxx xxxxx xxxxxxx xx xxx xxxxx. Xxxx xx xxxxxxxxxxxx xxx xxx xxxxxxxx xxxx xxx xx xxxx xx xxx xxxxxx xxxx xx xxx xxxxxx. Xxx xxxxxxxxxx xxxxxxxxxxxx xxxxxxx xxx xx xxxxxxxx xxxxx xxx xxxxxxxx xx xxx xxxxxx. Xxx xxxxxxxxx xxxxx xxxxx xx x xxxxxxxxxxx xx xxx xxxxxxx xxxxxxx xxxx xxx xxxxxx xx xxx xxxxxxxx xxxxxxxxxxxx.

```hlsl
float4 main(sPSInput input) : SV_TARGET
{
    float3 lightDirection = float3(0, 0, -1);
    float3 ambientColor = float3(0.43, 0.31, 0.24);
    float3 lightColor = 1 - ambientColor;
    float spotRadius = 50;

    // Basic ambient (Ka) and diffuse (Kd) lighting from above.
    float3 N = normalize(input.norm);
    float NdotL = dot(N, lightDirection);
    float Ka = saturate(NdotL + 1);
    float Kd = saturate(NdotL);

    // Spotlight.
    float3 vec = input.worldPos - marblePosition;
    float dist2D = sqrt(dot(vec.xy, vec.xy));
    Kd = Kd * saturate(spotRadius / dist2D);

    // Shadowing from ball.
    if (input.worldPos.z > marblePosition.z)
        Kd = Kd * saturate(dist2D / (marbleRadius * 1.5));

    // Diffuse reflection of light off ball.
    float dist3D = sqrt(dot(vec, vec));
    float3 V = normalize(vec);
    Kd += saturate(dot(-V, N)) * saturate(dot(V, lightDirection))
        * saturate(marbleRadius / dist3D);

    // Final composite.
    float4 diffuseTexture = Texture.Sample(Sampler, input.tex);
    float3 color = diffuseTexture.rgb * ((ambientColor * Ka) + (lightColor * Kd));
    return float4(color * lightStrength, diffuseTexture.a);
}
```

> **Xxxxxxx**  Xxx xxxxxxxx xxxxx xxxxxx xxxxxxxx YY xxxxxxxxxx xxxxxxxxxxxx xxx Y xxxxxxx xxxxxxxxxxx. Xxxx xxxxxx xxxxxx xxxxxxx xxxx xx xxxxxxx xxxxxxxxx xxx xxxxxx-xxx xxxxxxx. Xxxxxxx, x xxxxx-xxx xxxxxxxx xxxxx xxx xx xxxx xx xxxxxxx xxxx xxxxxx xxx xxxxx xxxxxxx xx xxxxxxxxxxx xxxxx xxxx. Xxxxxxxx xxx xxxxxxx xxxxxxxx xx xxxx xxxxxx xxxxxxxx xxx xxxxxx xxxx xxxxxxx xx xxxx xxx xxxxxxxxxxxx xx xxxx xxxxxxxx.

 

Xxx **XxxxxxXxxx::XxxxXxxxxxxxXxxxxxxxx** xxxxxx xxxx xxx **XxxxxXxxxxx::XxxxXxxxxx** xxxxxx xx xxxx xxx xxxxxxx. Xxx xxxxxxxxx xxxxxxx xxxxx xxx xxxxxx xxxxxx. Xxx xxx-xxxx xxxxxx xxx xxxx xxxxxx xx XxxxxXxxxxxXxxxxx.xxx. Xxx **x\_xxxxxxXxxxxx** xxxxxx xxxxxxxx xx xx [**XXYXYYXxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476641) xxxxxx.

```cpp
\loader->LoadShader(
    L"BasicVertexShader.cso",
    layoutDesc,
    ARRAYSIZE(layoutDesc),
    &m_vertexShader,
    &m_inputLayout
    );
```

Xxx **x\_xxxxxXxxxxx** xxxxxx xxxxxxxx xx xx [**XXYXYYXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476575) xxxxxx. Xxx xxxxx-xxxxxx xxxxxx xxxxxxxxxxxx xxx xxxxx xxxxx xx xxx xxxxx xxxxxxxxx (XX) xxxxx. Xxx xxx xx xxx XX xxxxx xx xx xxxx xxxxxxx xxxx xxxxxxxxx xx xxxxx xxxxxx-xxxxxxxxx xxxxxx, xxxx xxxxx xx *xxxxxxxxx*, xx xxxxxxx xxxx xxxxx xxxxxxxxxx xx xxxxxxxx xxxx xxxx xxx xxxxxxx xxxx xxxxxxxxx. Xxx xxx [**XXYXYYXxxxxx::XxxxxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476512) xxxxxx xx xxxxxx xx xxxxx-xxxxxx xxxx xx xxxxx xx xxxxx-xxxxxxx xxxxxxxxxxxx. Xxx xxxxx xxxxxxxx xxx xx xxxx xxxxx xxxxxxxx; xxxx xxxxx xxxxxxx xxxxxxxxx xxx xxxxxx-xxxx xxxxxxx xxxx xxx xxxxxx xxxxxx. Xxx xxxxxx xxx xx xxxxx-xxxxxxx xxxxxxxxxxxx xxxxxxxxx xxx xx xxx xxxxxx-xxxx xxxxxxxx xxxx xxx xx xxx xxxxxx xxxxxxx xxxx xxxx xx xxxxx xx xxx XX xxxxx. Xxx xxxxxxxxx xxxxxxx xxxxx xxx xxxxxx xxxxxxxxxxx xxxx Xxxxxx Xxxx xxxx. Xxx xxxxxx xxxxxxxxxxx xxxxxxxxx x xxxxxx xxxxxx xxxx xxxxxxxx xxxx xxxxxx-xxxx xxxxxxxx. Xxx xxxxxxxxx xxxxx xx xxxx xxxxx xx xxx xxxxx xxx xxx xxxxxxxx xxxx, xxxx xxxxxx, xxx xxxx xxxxxx . Xxx xxxxxxx, xxx **XXXXXXXX** xxxxxxx xxxxxxxxx xxx xxxxxx xxxxxxxx xx xxxxxx xxxxx. Xx xxxxxx xx xxxx xxxxxx Y xxx xxxxxxxx xxxxx xxxxxxxx-xxxxx xxxxxxxxxx (xxx x xxxxx xx YY xxxxx). Xxx **XXXXXX** xxxxxxx xxxxxxxxx xxx xxxxxx xxxxxx. Xx xxxxxx xx xxxx xxxxxx YY xxxxxxx xx xxxxxxx xxxxxxxx xxxxx **XXXXXXXX** xx xxx xxxxxx, xxxxx xxxxxxxx YY xxxxx. Xxx **XXXXXX** xxxxxxx xxxxxxxx x xxxx-xxxxxxxxx, YY-xxx xxxxxxxx-xxxxxxx.

```cpp
D3D11_INPUT_ELEMENT_DESC layoutDesc[] = 
{
    { "POSITION", 0, DXGI_FORMAT_R32G32B32_FLOAT, 0, 0,  D3D11_INPUT_PER_VERTEX_DATA, 0 },
    { "NORMAL",   0, DXGI_FORMAT_R32G32B32_FLOAT, 0, 12, D3D11_INPUT_PER_VERTEX_DATA, 0 },
    { "TEXCOORD",  0, DXGI_FORMAT_R32G32_FLOAT,   0, 24, D3D11_INPUT_PER_VERTEX_DATA, 0 },
    { "TANGENT", 0, DXGI_FORMAT_R32G32B32_FLOAT,  0, 32, D3D11_INPUT_PER_VERTEX_DATA, 0 }, 
};
m_vertexStride = 44; // You must set this to match the size of layoutDesc above.
```

Xxxxxxx xxx xxxxx xxxxxx xxxx xxx **xXXXxxxx** xxxxxxxxx xxxx xx xxxxxxx xx xxx xxxxxx xxxxxx, xx xxxxx xx xxx xxxxxxxxx xxxxxxx. Xxx **xXXXxxxx** xxxxxxxxx xxxxxxx xxx **XXXXXXXX**, **XXXXXX**, xxx **XXXXXXXXY** xxxxxxxx. Xxx XxxxxxX xxxxxxx xxxx xxxx xxxxxxx xx xxx xxxxxx xx xxx xxxxx xxxxxxxxx xxxx xx xxxxxxx xx xxx xxxxxx.

```hlsl
struct sVSInput
{
    float3 pos : POSITION;
    float3 norm : NORMAL;
    float2 tex : TEXCOORD0;
};

struct sPSInput
{
    float4 pos : SV_POSITION;
    float3 norm : NORMAL;
    float2 tex : TEXCOORD0;
    float3 worldPos : TEXCOORD1;
};

sPSInput main(sVSInput input)
{
    sPSInput output;
    float4 temp = float4(input.pos, 1.0f);
    temp = mul(temp, model);
    output.worldPos = temp.xyz / temp.w;
    temp = mul(temp, view);
    temp = mul(temp, projection);
    output.pos = temp;
    output.tex = input.tex;
    output.norm = mul(float4(input.norm, 0.0f), model).xyz;
    return output;
}
```

Xxx xxxxxxxx [Xxxxxxxxx](https://msdn.microsoft.com/library/windows/desktop/bb509647) xxxxxxxxx xxxx xx xxx xxxxxxxxx xxxxxxxxx xx xxxxxxx xxxxxx.

> **Xxxx**   Xx x xxxxxx, xxx xxx xxxxxxx xxxxxxxxxx xxxxxxxxxx xxxx xxx xxx xxxx xx xxxxxx xxxxxxxx xxxxxxx xx xxxxx xxx xxxx xxxxxx. Xxx xxxxxxx, xxx **XXXXXXX** xxxxxxx xx xxx xxxx xx xxx xxxxxx. Xxx xxx xxx xxx **XXXXXXX** xxxxxxx xx xxx xxxx xx xxxxxxxxxx xxxx xxxxxxxxxx xxxx xx xxxxxx xxxxxxx. Xx xxxxx xxxxxx xxxxxxx, xxxx xxxxx xx xxxx xxxxxxx, xxx xxx xxxxxx xxx xxxxxx xx xxxxx xx xxx xxxxxxxx xx xxxxxxx. Xxx xxxx xxxxxxxxxxx xxxxx xxxx xxxxxxx, xxx [Xxxx Xxxxxxx (XxxxxxYX Y)](https://msdn.microsoft.com/library/windows/desktop/bb172379).

 

Xxx xxxx xxxxxxxxxxx xxxxx xxx xxxxx xxxxxxxx xxxxx xxxxx, xxx [Xxxxx-Xxxxxxxxx Xxxxx](https://msdn.microsoft.com/library/windows/desktop/bb205116) xxx [Xxxxxxx Xxxxxxx xxxx xxx Xxxxx-Xxxxxxxxx Xxxxx](https://msdn.microsoft.com/library/windows/desktop/bb205117).

Xxx xxxxxxx xx xxxxx xxx xxxxxx xxx xxxxx xxxxxxx xx xxxxxx xxx xxxxx xxx xxxxxxxxx xx xxx xxxxxxx [Xxxxxxxxx xxx xxxxx](#rendering_the_scene) xxxxx xx xxxx xxxxxxxx.

### Xxxxxxxx xxx xxxxxxxx xxxxxx

XxxxxxYX xxxxxx xxxxxx x xxxxxxxxxx xx xxxx. X xxxxxxxx xxxxxx xx x xxxx xx xxxxxx xxxx xxx xxx xxx xx xxxx xxxx xx xxxxxxx. Xxxxxx Xxxx xxxx x xxxxxxxx xxxxxx xx xxxx xxx xxxxx (xx xxxxx) xxxx, xxx xxx xxxxxxxxxx xxxxxxxx xxx xxx xxxxxx xxxxx xxxxxx.

Xxx xxxxxxxxx xxxxxxx xxxxx xxx xxx **XxxxxxXxxx::XxxxXxxxxxxxXxxxxxxxx** xxxxxx xxxxxxx x xxxxxxxx xxxxxx xxxx xxxx xxxxx xxxx xxxxxx xxxx. Xxx xxxxxxx xxxxxxx x **XYXYY\_XXXXXX\_XXXX** xxxxxxxxx xxxx xxxx xxx **XYXYY\_XXXX\_XXXXXXXX\_XXXXXX** xxxx xx xxxxxxx xxxxx xx x xxxxxxxx xxxxxx. Xxxx xxxxxxx xxxx xxxxxx xxxx xxxxxxxxx xx xxx [**XXYXYYXxxxxx::XxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476501) xxxxxx. Xxx **x\_xxxxxxxxXxxxxx** xxxxxxxx xx xx [**XXYXYYXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476351) xxxxxx.

```cpp
// Create the constant buffer for updating model and camera data.
D3D11_BUFFER_DESC constantBufferDesc = {0};
constantBufferDesc.ByteWidth           = ((sizeof(ConstantBuffer) + 15) / 16) * 16; // Multiple of 16 bytes
constantBufferDesc.Usage               = D3D11_USAGE_DEFAULT;
constantBufferDesc.BindFlags           = D3D11_BIND_CONSTANT_BUFFER;
constantBufferDesc.CPUAccessFlags      = 0;
constantBufferDesc.MiscFlags           = 0;
// This will not be used as a structured buffer, so this parameter is ignored.
constantBufferDesc.StructureByteStride = 0;

DX::ThrowIfFailed(
    m_d3dDevice->CreateBuffer(
        &constantBufferDesc,
        nullptr,             // Leave the buffer uninitialized.
        &m_constantBuffer
        )
    );
```

Xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxx xxxxxxx **XxxxxxxxXxxxxx** xxxxxxx, xxx xxx xxx xxxx xxx xxx xxx xxx xxxxxx. Xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxx xxxxx xxxx **XxxxxxxxXxxxxx** xxxxxx xx xxx xxxxxxxx xxxxxx xxxxxx xxxx xxxxxx xx xxxxxxxx. Xxx xxxxxxxxx xxxxxxx xxxxx xxx **XxxxxxxxXxxxxx** xxxxxxxxx, xxxxx xx xx XxxxxxXxxx.x.

```cpp
// Describes the constant buffer that draws the meshes.
struct ConstantBuffer
{
    float4x4 model;
    float4x4 view;
    float4x4 projection;

    float3 marblePosition;
    float marbleRadius;
    float lightStrength;
};
```

Xx xxxxxx xxxxxxxxxx xxx xxxxxxxx xxxxxxx xxx xx xxxxxx xxxx, xxxxxxx xxx **XxxxxxxxXxxxxx** xxxxxxxxx xx xxx **XxxxxxXxxxxxxxXxxxxx** xxxxxxxx xxxxxx xxxx xx xxxxxxx xx xxx xxxxxx xxxxxx xx XxxxxXxxxxxXxxxxx.xxxx:

```hlsl
cbuffer ConstantBuffer : register(b0)
{
    matrix model;
    matrix view;
    matrix projection;
    float3 marblePosition;
    float marbleRadius;
    float lightStrength;
};
```

Xxx xxxxxx xx xxx **XxxxxxxxXxxxxx** xxxxxxxxx xxxxxxx xxx **xxxxxxx** xxxxxx. Xxx **xxxxxxx** xxxxxxxx xxxxxxxxx xxxxxxxx xY, xxxxx xxxxx xxxx xxx xxxxxxxx xxxxxx xxxx xx xxxxxx xx xxxxxxxx Y. Xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxxxxxx xxxxxxxx Y xxxx xx xxxxxxxxx xxx xxxxxxxx xxxxxx. Xxxx xxxxxxx xx xxxxxxxxx xx xxxxxxx xxxxxx xxxxx xx xxxx xxxxxxxx.

Xxx xxxx xxxxxxxxxxx xxxxx xxxxxxxx xxxxxxx, xxx [Xxxxxxxxxxxx xx Xxxxxxx xx XxxxxxYX YY](https://msdn.microsoft.com/library/windows/desktop/ff476898). Xxx xxxx xxxxxxxxxxx xxxxx xxx xxxxxxxx xxxxxxx, xxx [**xxxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/dd607359).

###  Xxxxxxx xxxxxx

Xxxxxx Xxxx xxxx XXX-Xxxx xx xxx xxx-xxxx xxxxxx xxxxxxx xxxx xxxxxx xxxxxxxx x xxxxx xxx xx xxxx xxxx xxxx xxx xxxxxx xxxxxxxxxxxx. Xxx xxxxxxxxxx xxx, xxx xxxxxx xxx x xxxx xxxxxx xxxx xxxxx xxx xxxxxxxx xxxxxxxxxxxx xx xxxx xxxx.

Xxx **XxxxxxXxxx::XxxxXxxxxxxxXxxxxxxxx** xxxxxx xxxxx xxxx xxxx xxxxx xx xxxxx xxx xxxxxx xxx xxxxx xxxxxxx. X xxxx xx x xxxxxxxxxx xx xxxxxx xxxx xxxx xxxxx xxxxxxxx xxxxxxxxxxx xxxx xx xxxxxxxxx, xxxxxx xxxx, xxxxxx, xxxxxxxxx, xxx xxxxxxx xxxxxxxxxxx. Xxxxxx xxx xxxxxxxxx xxxxxxx xx Y-X xxxxxxxxx xxxxxxxx xxx xxxxxxxxxx xx xxxxx xxxx xxx xxxxxxxx xxxx xxxxxxxxxxx xxxx. Xxx xxxxxx xxx xxx xxxx xxx xxx xxxxxxxx xx xxxxxx xxxx xxx xxxx xxxx.

Xxxxxx Xxxx xxxx xxx **XXXXxxx** xxxxx xx xxxxxx xxxxxx. Xxxx xxxxx xx xxxxxxxx xx XXXXxxx.x. **XXXXxxx** xxxxxxxx xxxxxxx xx xxxx, xxxxxx, xxx xxxxxxx xxxx xxxx.

> **Xxxxxxxxx**   Xxxxxx Xxxx xxxx xxx XXX-Xxxx xxxxxx xxx xxxxxxxx xxx **XXXXxxx** xxxxx xxx xxxxxxxxxxxx xxxx. Xxxxxxxx xxx XXX-Xxxx xxxxxx xx xxxxxx xxx xxxxxxxx, xxx xxx xxxxxxxx xxxxxxxxxx, xx xx x xxxx xxxxx xxxxxx xxxx xxxxx xxx xxxx xxx xxxxxxxxxxxx xx xxxx xxxx xxxxxxxxxxx. Xx xxxxxxxxx xxxx xxx xxx x xxxx xxxxxx xxxx xxxxx xxx xxxxxxxx xxxxxxxxxxxx xx xxxx xxxx.

 

Xxx xxxxxxxxx xxxxxxx xxxxx xxx xxx **XxxxxxXxxx::XxxxXxxxxxxxXxxxxxxxx** xxxxxx xxxx xxx **XXXXxxx::Xxxxxx** xxxxxx xx xxxx xxxx xxxx xxx xxx xxxx xxx xxx xxx xxxx.

```cpp
// Load the meshes.
DX::ThrowIfFailed(
    m_mazeMesh.Create(
        m_d3dDevice.Get(),
        L"Media\\Models\\maze1.sdkmesh",
        false
        )
    );

DX::ThrowIfFailed(
    m_marbleMesh.Create(
        m_d3dDevice.Get(),
        L"Media\\Models\\marble2.sdkmesh",
        false
        )
    );
```

###  Xxxxxxx xxxxxxxxx xxxx

Xxxxxxxx xxxx xxxxxxx xxxx xxx xxxxx xx xxx Xxxxxx Xxxx xxxxxxxxxx xxx xxxxxxx xxxxxxxxxx xxxxxxx xxx xxxxxx xxx xxx xxxx, xxxx xxxx xxxx xxxxxxxx xxx xxx xxxxxxx xxxxxx xx xxxx xxxx xxx xxxxxx xxx xxxxxx.

```cpp
// Extract mesh geometry for the physics system.
DX::ThrowIfFailed(
    ExtractTrianglesFromMesh(
        m_mazeMesh,
        "Mesh_walls",
        m_collision.m_wallTriList
        )
    );

DX::ThrowIfFailed(
    ExtractTrianglesFromMesh(
        m_mazeMesh,
        "Mesh_Floor",
        m_collision.m_groundTriList
        )
    );

DX::ThrowIfFailed(
    ExtractTrianglesFromMesh(
        m_mazeMesh,
        "Mesh_floorSides",
        m_collision.m_floorTriList
        )
    );

m_physics.SetCollision(&m_collision);
float radius = m_marbleMesh.GetMeshBoundingBoxExtents(0).x / 2;
m_physics.SetRadius(radius);
```

Xxx xxx xxxx xxx xxxx xxxxxxxxx xxxx xxxxx xxxxxxx xx xxx xxx-xxxx xxxxxx xxxx xxx xxx. Xxx xxxx xxxxxxxxxxx xxxxx xxx Xxxxxx Xxxx xxxxx xxx xxxxxxxxx xxxxxxxx xxxx xx XXX-Xxxx xxxx, xxx xxx **XxxxxxXxxx::XxxxxxxXxxxxxxxxXxxxXxxx** xxxxxx xx xxx xxxxxx xxxx.

## Xxxxxxxx xxxx xxxxx


Xxxxxx Xxxx xxxxxxxxx xxxx xxxxx xxxx xxxxxxxxx xxxxx xx xxxxx xxxxxxxx xxx xxxxx xxxxxxx xxxxxx xxxxxxxxx xxxx.

Xxx xxxxxxxx Xxxxxx Xxxx xxxxxxxxxxx xxxxxxxxx xxxxxxxxx xxx xxxx xxxx xxxx. Xxxxxxxx xxx xxxxx, xxxxx xx xxxx xx xxx xxxx xxxx, xxxxxxx xxxxx Xxxxxxx xxxxxx xxx xxxxx xxx xxxxxxxxx xxx xxxxxx xxx xxxxx xx xxxxxxxx. Xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxxxx xxx xxxxxx xx xxx XX xxx xxx xxxx.

### Xxxxxxxx xxx xxxx xxxxxxxxx

Xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxx xxx **XxxxXxxxxxxxx::Xxxxxx** xxxxxx xx xxxxxx xxx xxxxx xx xxx XX.

```cpp
UserInterface::GetInstance().Update(timeTotal, timeDelta);
```

Xxx **XxxxXxxxxxxxx::Xxxxxx** xxxxxx xxxxxxx xxxx xxxxxxx xx xxx XX xxxxxxxxxx.

```cpp
void UserInterface::Update(float timeTotal, float timeDelta)
{
    for (auto iter = m_elements.begin(); iter != m_elements.end(); ++iter)
    {
        (*iter)->Update(timeTotal, timeDelta);
    }
}
```

Xxxxxxx xxxx xxxxxx xxxx **XxxxxxxXxxx** xxxxxxxxx xxx **Xxxxxx** xxxxxx xx xxxxxxx xxxxxxxx xxxxxxxxx. Xxx xxxxxxx, xxx **XxxxxxxxxXxxxx::Xxxxxx** xxxxxx xxxxxxx xxx xxxxxxx xxxx xx xxx xxxxxxxx xxxxxx xxx xxxxxxx xxx xxxx xxxx xx xxxxx xxxxxxxx.

```cpp
void StopwatchTimer::Update(float timeTotal, float timeDelta)
{
    if (m_active)
    {
        m_elapsedTime += timeDelta;

        WCHAR buffer[16];
        GetFormattedTime(buffer);
        SetText(buffer);
    }

    TextElement::Update(timeTotal, timeDelta);
}
```

###  Xxxxxxxx xxx xxxxx

Xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxxxx xxx xxxx xxxxx xx xxx xxxxxxx xxxxx xxxxxxx xxxxx. Xxxx xxx xxxx xx xx xxx xxxxxx xxxxx, Xxxxxx Xxxx xxxxxxx xxx xxxxxx xx xxxxxx xxx xxxxxx, xxxxxxx xxx xxxx xxxxxx xxxx xx xxx xxxxxxxx xxxxxxx, xxx xxxxxxx xxx xxxxxxx xxxxxxxxxx.

Xxx xxxxxxxxx xxxxxxx xxxxx xxx xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxxxx xxx xxxxxxxx xx xxx xxxxxx. Xxxxxx Xxxx xxxx xxx **x\_xxxxxXxxxxx** xxxxxxxx xx xxxx xxxx xxx xxxxxx xxxx xx xxxxx xx xx xxxxxxx xxxxxxxx xxxxx xxx xxxxxx. Xxx xxxxxx xx xxxxx xxxx xxx xxxx xxxxxx xx xxx xxxxxx xxxxx xxxxxxx xxx xxxx. Xxxx xxx xxxx xxxx xx xxxx xxxxx xxxxxxx xxxxxx xx xxxxxx, xxx xxxxxx xx xxx xx x xxxxxxxx xxxxxxxx. Xxxxxxxxx, Xxxxxx Xxxx xxxx xxx *xxxxXxxxx* xxxxxxxxx xx xxxxxxxxxxx xxx xxxxxxxx xx xxx xxxxxx xxxxxxx xxx xxxxxxx xxx xxxxxx xxxxxxxxx. Xxx xxxxxx xxxxxxxx xx xxxxxxxx xxxxx xxx xx xxxxx xx xxx xxxxxx. Xxxxx xxx xxxxxxx xxxxx xxxx xxxxxxx xxx xxxxxx xx xxxxxxxxx xxxxxx, xx xxxxx, xxx xxxxxx.

```cpp
static float eyeDistance = 200.0f;
static float3 eyePosition = float3(0, 0, 0);

// Gradually move the camera above the marble.
float3 targetEyePosition = marblePosition - (eyeDistance * float3(g.x, g.y, g.z));
if (m_resetCamera)
{
    eyePosition = targetEyePosition;
    m_resetCamera = false;
}
else
{
    eyePosition = eyePosition + ((targetEyePosition - eyePosition) * min(1, timeDelta * 8));
}

// Look at the marble. 
if ((m_gameState == GameState::MainMenu) || (m_gameState == GameState::HighScoreDisplay))
{
    // Override camera position for menus.
    eyePosition = marblePosition + float3(75.0f, -150.0f, -75.0f);
    m_camera->SetViewParameters(eyePosition, marblePosition, float3(0.0f, 0.0f, -1.0f));
}
else
{
    m_camera->SetViewParameters(eyePosition, marblePosition, float3(0.0f, 1.0f, 0.0f));
}
```

Xxx xxxxxxxxx xxxxxxx xxxxx xxx xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxxxx xxx xxxxxxxx xxxxxxx xxx xxx xxxxxx xxx xxx xxxx. Xxx xxxx’x xxxxx, xx xxxxx, xxxxxx xxxxxx xxxxxxx xxx xxxxxxxx xxxxxx. Xxxxxx xxx xxx xxxx xxxxxxxx, xxxxx xxxxxxxx xxx xxx xxxx, xxx xxxxxxxx xxxxxx xx x xxxxxx xxxxxx xxxxxxxx xx xxxxx. Xxx xxxxxx’x xxxxx xxxxxx xx xxxxx xx xxx xxxxxxxx xxxxxx xxxxx xxx xxxxxxxx xxxxxx. Xxx **xxx** xxx **xxxxxxxxxxx** xxxxxxxxx xxx xxxxxxx xx XxxxxXxxx.x.

```cpp
// Update the model matrices based on the simulation.
m_mazeConstantBufferData.model = identity();
m_marbleConstantBufferData.model = mul(
    translation(marblePosition.x, marblePosition.y, marblePosition.z),
    marbleRotationMatrix
    );

// Update the view matrix based on the camera.
float4x4 view;
m_camera->GetViewMatrix(&view);
m_mazeConstantBufferData.view = view;
m_marbleConstantBufferData.view = view;
```

Xxx xxxxxxxxxxx xxxxx xxx xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxx xxxx xxxxx xxx xxxxxxxxx xxx xxxxxx xx xxx xxxxxx, xxx [Xxxxxx xxxxx xxx xxxxxxxxxxxxx xx xxx Xxxxxx Xxxx xxxxxx](adding-input-and-interactivity-to-the-marble-maze-sample.md).

## Xxxxxxxxx xxx xxxxx


Xxxx x xxxxx xx xxxxxxxx, xxxxx xxxxx xxx xxxxxxxxx xxxxxxxx.

1.  Xxx xxx xxxxxxx xxxxxx xxxxxx xxxxx-xxxxxxx xxxxxx.
2.  Xxxxx xxx xxxxxx xxx xxxxxxx xxxxx.
3.  Xxxxxxx xxx xxxxxx xxx xxxxx xxxxxxx xxx xxxxxxx.
4.  Xxxxxx xxx Y-X xxxxxxx xx xxx xxxxx.
5.  Xxxxxx xxx Y-X xxxxxx xxxx xxx xxxx xx xxxxxx xx xxxxx xx xxx xxxxx.
6.  Xxxxxxx xxx xxxxxxxx xxxxx xx xxx xxxxxxx.

Xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxx xxx xxxxxx xxxxxx xxx xxxxx xxxxxxx xxxxx, xxxxxx xxxxx xxxxx, xxxxx xxx xxxxx, xxx xxxx xxxxx xxx xxxxxxx.

###  Xxxxxxxxx xxx xxxxxx xxxxxxx

Xxxxxx xxx xxxxxx xxxx xxxxx, xxx xxxx xxx xxx xxxxxxx xxxxxx xxxxxx xxxxx-xxxxxxx xxxxxx. Xx xxxx xxxxx xx xxx xxxxxxxxxx xx xxxx xxxx xxxxx xxxxx xx xxx xxxxxx, xxxx xxxxx xxx xxxxxx xxx xxxxxxx xxxxx. Xxxxxx Xxxx xxxxxx xxx xxxxxx xxx xxxxxxx xxxxx xx xxxxx xxxxx xx xxxxxx xxxx xxxxx xxx xx xxxxxxx xxxxxxxxx xxxx xxx xxxxxxxx xxxxx.

Xxx xxxxxxxxx xxxxxxx xxxxx xxx xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxx xxx [**XXYXYYXxxxxxXxxxxxx::XXXxxXxxxxxXxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476464) xxxxxx xx xxx xxx xxxxxx xxxxxx xxx xxx xxxxx-xxxxxxx xxxxxx xx xxx xxxxxxx xxxx. Xxx **x\_xxxxxxXxxxxxXxxx** xxxxxx xxxxxxxx, xx [**XXYXYYXxxxxxXxxxxxXxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476582) xxxxxx, xxx xxx **x\_xxxxxXxxxxxxXxxx** xxxxxx xxxxxxxx, xx [**XXYXYYXxxxxXxxxxxxXxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476377) xxxxxx, xxx xxxxxxx xxx xxxxxxxxxxx xx xxx **XxxxxxXXxxx** xxxxx.

```cpp
// Bind the render targets.
m_d3dContext->OMSetRenderTargets(
    1,
    m_renderTargetView.GetAddressOf(),
    m_depthStencilView.Get()
    );

// Clear the render target and depth stencil to default values. 
const float clearColor[4] = { 0.0f, 0.0f, 0.0f, 1.0f };

m_d3dContext->ClearRenderTargetView(
    m_renderTargetView.Get(),
    clearColor
    );

m_d3dContext->ClearDepthStencilView(
    m_depthStencilView.Get(),
    D3D11_CLEAR_DEPTH,
    1.0f,
    0
    );
```

Xxx [**XXYXYYXxxxxxXxxxxxXxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476582) xxx [**XXYXYYXxxxxXxxxxxxXxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476377) xxxxxxxxxx xxxxxxx xxx xxxxxxx xxxx xxxxxxxxx xxxx xx xxxxxxxx xx XxxxxxYX YY xxx xxxxx. Xxx xxxx xxxxxxxxxxx xxxxx xxxxxxx xxxxx, xxx [Xxxxxxx Xxxxx (XxxxxxYX YY)](https://msdn.microsoft.com/library/windows/desktop/bb205128). Xxx [**XXXxxXxxxxxXxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476464) xxxxxx xxxxxxxx xxx xxxxxx-xxxxxx xxxxx xx xxx XxxxxxYX xxxxxxxx. Xxx xxxx xxxxxxxxxxx xxxxx xxx xxxxxx-xxxxxx xxxxx, xxx [Xxxxxx-Xxxxxx Xxxxx](https://msdn.microsoft.com/library/windows/desktop/bb205120).

### Xxxxxxxxx xxx xxxxxx xxx xxxxx xxxxxxx

Xxxxxx xxx xxxxxx xxx xxxxx xxxxxxx, xxxxxxx xxx xxxxxxxxx xxxxx xx xxxxxxx xxx xxxxxx xxx xxxxx xxxxxxx xxx xxxxxxx:

1.  Xxx xxx xxxxxx xxxxx xxxxxx xx xxx xxxxxxx xxxxxx.
2.  Xxx xxx xxxxxx xxx xxxxx xxxxxxx xx xxx xxxxxxx xxxxxxx.
3.  Xxxxxx xxx xxxxxxxx xxxxxxx xxxx xxxx xxxx xxx xxxx xx xxxx xx xxx xxxxxxx.

> **Xxxxxxxxx**  Xxxxxx Xxxx xxxx xxx xxxx xx xxxxxx xxx xxxxx xxxxxxx xxx xxx Y-X xxxxxxx. Xx xxxx xxxx xxxx xxxx xxxx xxx xxxx xx xxxxxxx, xxx xxxx xxxxxxx xxxxx xxxxx xxxx xxxx xxx xxxx xxxxxxx xxxx xxx xxxxxxxxx xxxxxxx. Xx xxxxxx xxx xxxxxxxx xxxx xx xxxxxxxxxx xxxx xxxxxxxx xxx xxxxxx xxxxx, xx xxxxxxxxx xxxx xxx xxxxx xxxxxx xxxxx xxx xxx xxxxxxx xxxx xxx xxx xxxx xxxxxxx.

 

Xxx xxxxxxx [Xxxxxxx xxxxxxx](#loading_shaders) xx xxxx xxxxxxxx xxxxxxxxx xxx xxx xxxxx xxxxxx xx xxxxxxx xxxx xxx xxxxxx xxxxxx xx xxxxxxx. Xxx xxxxxxxxx xxxxxxx xxxxx xxx xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxx xxx [**XXYXYYXxxxxxXxxxxxx::XXXxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476454) xxxxxx xx xxx xxxx xxxxxx xx xxx xxxxxxx xxxxxx.

```cpp
m_d3dContext->IASetInputLayout(m_inputLayout.Get());
```

Xxx xxxxxxxxx xxxxxxx xxxxx xxx xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxx xxx [**XXYXYYXxxxxxXxxxxxx::XXXxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476493) xxx [**XXYXYYXxxxxxXxxxxxx::XXXxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476472) xxxxxxx xx xxx xxx xxxxxx xxx xxxxx xxxxxxx xx xxx xxxxxxx xxxxxxx, xxxxxxxxxxxx.

```cpp
// Set the vertex shader stage state.
m_d3dContext->VSSetShader(
    m_vertexShader.Get(),   // Use this vertex shader. 
    nullptr,                // Don't use shader linkage.
    0                       // Don't use shader linkage.
    );

// Set the pixel shader stage state.
m_d3dContext->PSSetShader(
    m_pixelShader.Get(),    // Use this pixel shader. 
    nullptr,                // Don't use shader linkage.
    0                       // Don't use shader linkage.
    );

m_d3dContext->PSSetSamplers(
    0,                       // Starting at the first sampler slot
    1,                       // set one sampler binding
    m_sampler.GetAddressOf() // to use this sampler.
    );
```

Xxxxx xxx **XxxxxxXxxx::Xxxxxx** xxxx xxx xxxxxxx xxx xxxxx xxxxx xxxxxx, xx xxxx xxx [**XXYXYYXxxxxxXxxxxxx::XxxxxxXxxxxxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476486) xxxxxx xx xxxxxx xxx xxxxxxxx xxxxxx xxxx xxx xxxxx, xxxx, xxx xxxxxxxxxx xxxxxxxx xxx xxx xxxx. Xxx **XxxxxxXxxxxxxxxxx** xxxxxx xxxxxx xxx xxxxxx xxxx xxxx XXX xxxxxx xx XXX xxxxxx. Xxxxxx xxxx xxx xxxxx xxx xxxx xxxxxxxxxx xx xxx **XxxxxxxxXxxxxx** xxxxxxxxx xxx xxxxxxx xx xxx **XxxxxxXxxx::Xxxxxx** xxxxxx. Xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxx xxxxx xxx [**XXYXYYXxxxxxXxxxxxx::XXXxxXxxxxxxxXxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476491) xxx [**XXYXYYXxxxxxXxxxxxx::XXXxxXxxxxxxxXxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476470) xxxxxxx xx xxx xxxx xxxxxxxx xxxxxx xx xxx xxxxxxx xxx.

```cpp
// Update the constant buffer with the new data.
m_d3dContext->UpdateSubresource(
    m_constantBuffer.Get(),
    0,
    nullptr,
    &m_mazeConstantBufferData,
    0,
    0
    );

m_d3dContext->VSSetConstantBuffers(
    0,                // Starting at the first constant buffer slot
    1,                // set one constant buffer binding
    m_constantBuffer.GetAddressOf() // to use this buffer.
    );

m_d3dContext->PSSetConstantBuffers(
    0,                // Starting at the first constant buffer slot
    1,                // set one constant buffer binding
    m_constantBuffer.GetAddressOf() // to use this buffer.
    );
```

Xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxxxxx xxxxxxx xxxxx xx xxxxxxx xxx xxxxxx xx xx xxxxxxxx.

### Xxxxxxxxx xxx xxxx xxx xxx xxxxxx

Xxxxx xxx xxxxxxxx xxx xxxxxxx xxxxxxx, xxx xxx xxxx xxxx xxxxx xxxxxxx. Xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxx xxx **XXXXxxx::Xxxxxx** xxxxxx xx xxxxxx xxx xxxx xxxx.

```cpp
m_mazeMesh.Render(m_d3dContext.Get(), 0, INVALID_SAMPLER_SLOT, INVALID_SAMPLER_SLOT);
```

Xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxxxxx xxxxxxx xxxxx xx xxxxxx xxx xxxxxx.

Xx xxxxxxxxx xxxxxxx xx xxxx xxxxxxxx, xxx **XXXXxxx** xxxxx xx xxxxxxxx xxx xxxxxxxxxxxxx xxxxxxxx, xxx xx xx xxx xxxxxxxxx xx xxx xxx xx x xxxxxxxxxx-xxxxxxx xxxx. Xxxxxxx, xxxxxx xxxx xxx **XXXXxxx::XxxxxxXxxx** xxxxxx, xxxxx xx xxxxxx xx **XXXXxxx::Xxxxxx**, xxxx xxx [**XXYXYYXxxxxxXxxxxxx::XXXxxXxxxxxXxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476456) xxx [**XXYXYYXxxxxxXxxxxxx::XXXxxXxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476453) xxxxxxx xx xxx xxx xxxxxxx xxxxxx xxx xxxxx xxxxxxx xxxx xxxxxx xxx xxxx, xxx xxx [**XXYXYYXxxxxxXxxxxxx::XxxxXxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ff476410) xxxxxx xx xxxx xxx xxxxxxx. Xxx xxxx xxxxxxxxxxx xxxxx xxx xx xxxx xxxx xxxxxx xxx xxxxx xxxxxxx, xxx [Xxxxxxxxxxxx xx Xxxxxxx xx XxxxxxYX YY](https://msdn.microsoft.com/library/windows/desktop/ff476898).

### Xxxxxxx xxx xxxx xxxxxxxxx xxx xxxxxxx

Xxxxx xxxxxxx Y-X xxxxx xxxxxxx, Xxxxxx Xxxx xxxxx xxx Y-X XX xxxxxxxx xxxx xxxxxx xx xxxxx xx xxx xxxxx.

Xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxx xx xxxxxxx xxx xxxx xxxxxxxxx xxx xxx xxxxxxx.

```cpp
// Draw the user interface and the overlay.
UserInterface::GetInstance().Render();

m_sampleOverlay->Render();
```

Xxx **XxxxXxxxxxxxx::Xxxxxx** xxxxxx xxxx xx [**XXYXYXxxxxxXxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/hh404479) xxxxxx xx xxxx xxx XX xxxxxxxx. Xxxx xxxxxx xxxx xxx xxxxxxx xxxxx, xxxxx xxx xxxxxx XX xxxxxxxx, xxx xxxx xxxxxxxx xxx xxxxxxxx xxxxxxx xxxxx.

```cpp
void UserInterface::Render()
{
    m_d2dContext->SaveDrawingState(m_stateBlock.Get());
    m_d2dContext->BeginDraw();
    m_d2dContext->SetTransform(D2D1::Matrix3x2F::Identity());
    m_d2dContext->SetTextAntialiasMode(D2D1_TEXT_ANTIALIAS_MODE_GRAYSCALE);

    for (auto iter = m_elements.begin(); iter != m_elements.end(); ++iter)
    {
        if ((*iter)->IsVisible())
            (*iter)->Render();
    }

    m_d2dContext->EndDraw();
    m_d2dContext->RestoreDrawingState(m_stateBlock.Get());
}
```

Xxx **XxxxxxXxxxxxx::Xxxxxx** xxxxxx xxxx x xxxxxxx xxxxxxxxx xx xxxx xxx xxxxxxx xxxxxx.

###  Xxxxxxxxxx xxx xxxxx

Xxxxx xxxxxxx xxx Y-X xxx Y-X xxxxx xxxxxxx, Xxxxxx Xxxx xxxxxxxx xxx xxxxxxxx xxxxx xx xxx xxxxxxx. Xx xxxxxxxxxxxx xxxxxxx xx xxx xxxxxxxx xxxxx xx xxxxxx xxxx xxxx xx xxx xxxxx xxxx xxxxxxx xxxxxx xxxx xxxx xxxxx xx xxxxxxxx xxxxx xx xxx xxxxxxx. Xxxxxx Xxxx xxxx xxxxxxx xxxxxx xxxxxxx xxxx xx xxxxxxxx xxx xxxxx.

Xxxxx xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxxxx, xxx xxxx xxxx xxxxx xxx **XxxxxxXxxx::Xxxxxxx** xxxxxx xx xxxx xxx xxxxxxxx xxxxx xx xxx xxxxxxx xx xxxxxxx. Xxx **XxxxxxXxxx** xxxxx xxxx xxx xxxxxxxx xxx **XxxxxxXXxxx::Xxxxxxx** xxxxxx. Xxx **XxxxxxXXxxx::Xxxxxxx** xxxxxx xxxxx [**XXXXXXxxxXxxxxY::Xxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/hh446797) xx xxxxxxx xxx xxxxxxx xxxxxxxxx, xx xxxxx xx xxx xxxxxxxxx xxxxxxx:

```cpp
// The application may optionally specify "dirty" or "scroll" rects 
// to improve efficiency in certain scenarios. 
// In this sample, however, we do not utilize those features.
DXGI_PRESENT_PARAMETERS parameters = {0};
parameters.DirtyRectsCount = 0;
parameters.pDirtyRects = nullptr;
parameters.pScrollRect = nullptr;
parameters.pScrollOffset = nullptr;

// The first argument instructs DXGI to block until VSync, putting the  
// application to sleep until the next VSync.  
// This ensures we don't waste any cycles rendering frames that will  
// never be displayed to the screen.
HRESULT hr = m_swapChain->Present1(1, 0, &parameters);
```

Xx xxxx xxxxxxx, **x\_xxxxXxxxx** xx xx [**XXXXXXxxxXxxxxY**](https://msdn.microsoft.com/library/windows/desktop/hh404631) xxxxxx. Xxx xxxxxxxxxxxxxx xx xxxx xxxxxx xx xxxxxxxxx xx xxx xxxxxxx [Xxxxxxxxxxxx XxxxxxYX xxx XxxxxxYX](#initializing) xx xxxx xxxxxxxx.

Xxx xxxxx xxxxxxxxx xx [**XXXXXXxxxXxxxxY::Xxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/hh446797), *XxxxXxxxxxxx*, xxxxxxxxx xxx xxxxxx xx xxxxxxxx xxxxxx xx xxxx xxxxxx xxxxxxxxxx xxx xxxxx. Xxxxxx Xxxx xxxxxxxxx Y xx xxxx xx xxxxx xxxxx xxx xxxx xxxxxxxx xxxxx. X xxxxxxxx xxxxx xx xxx xxxx xxxxxxx xxxx xxx xxxxx xxxxxxxx xxxxxxx xx xxx xxxxxxx xxx xxx xxxx xxxxx xxxxxx.

Xxx [**XXXXXXxxxXxxxxY::XxxxxxxY**](https://msdn.microsoft.com/library/windows/desktop/hh446797) xxxxxx xxxxxxx xx xxxxx xxxx xxxx xxxxxxxxx xxxx xxx xxxxxx xxx xxxxxxx xx xxxxxxxxx xxxxxx. Xx xxxx xxxx, Xxxxxx Xxxx xxxxxxxxxxxxx xxx xxxxxx.

```cpp
// Reinitialize the renderer if the device was disconnected  
// or the driver was upgraded. 
if (hr == DXGI_ERROR_DEVICE_REMOVED || hr == DXGI_ERROR_DEVICE_RESET)
{
    Initialize(m_window, m_dpi);
}
else
{
    DX::ThrowIfFailed(hr);
}
```

## Xxxx xxxxx


Xxxx [Xxxxxx xxxxx xxx xxxxxxxxxxxxx xx xxx Xxxxxx Xxxx xxxxxx](adding-input-and-interactivity-to-the-marble-maze-sample.md) xxx xxxxxxxxxxx xxxxx xxxx xx xxx xxx xxxxxxxxx xx xxxx xx xxxx xxxx xxx xxxx xxxx xxxxx xxxxxxx. Xxxx xxxxxxxx xxxxxxxxx xxx Xxxxxx Xxxx xxxxxxxx xxxxx, xxxxxxxxxxxxx, Xxxx YYY xxxxxxxxxx, xxx xxxxx xxxxx.

## Xxxxxxx xxxxxx


* [Xxxxxx xxxxx xxx xxxxxxxxxxxxx xx xxx Xxxxxx Xxxx xxxxxx](adding-input-and-interactivity-to-the-marble-maze-sample.md)
* [Xxxxxx Xxxx xxxxxxxxxxx xxxxxxxxx](marble-maze-application-structure.md)
* [Xxxxxxxxxx Xxxxxx Xxxx, x XXX xxxx xx X++ xxx XxxxxxX](developing-marble-maze-a-windows-store-game-in-cpp-and-directx.md)

 

 




<!--HONumber=Mar16_HO1-->
