---
xxxxx: Xxxxxx xxxxx xx xxx Xxxxxx Xxxx xxxxxx
xxxxxxxxxxx: Xxxx xxxxxxxx xxxxxxxxx xxx xxx xxxxxxxxx xx xxxxxxxx xxxx xxx xxxx xxxx xxxxx xxx xxxxx xxx Xxxxxx Xxxx xxxxxxx xxxxx xxxxxxxxx.
xx.xxxxxxx: YYxYYxYx-xxYx-YYxY-xYYx-YYxYYYYxYxYY
---

# Xxxxxx xxxxx xx xxx Xxxxxx Xxxx xxxxxx


\[ Xxxxxxx xxx XXX xxxx xx Xxxxxxx YY. Xxx Xxxxxxx Y.x xxxxxxxx, xxx xxx [xxxxxxx](http://go.microsoft.com/fwlink/p/?linkid=619132) \]


Xxxx xxxxxxxx xxxxxxxxx xxx xxx xxxxxxxxx xx xxxxxxxx xxxx xxx xxxx xxxx xxxxx xxx xxxxx xxx Xxxxxx Xxxx xxxxxxx xxxxx xxxxxxxxx. Xxxxxx Xxxx xxxx Xxxxxxxxx Xxxxx Xxxxxxxxxx xx xxxx xxxxx xxxxxxxxx xxxx xxxx, xxx XXxxxxY xx xxx xxx xxxx xxxxx xxx xx xxxxx xxxxxxx xx xxxxx.

Xxxxxx Xxxx xxxxx xxxxx xx xxx xxxxxxxxxx, xxx xxxx xxxx xxxx-xxxx xxxxxx xx xxxxxxxx xxxx xxxxxx, xxxx xx xxxx xxx xxxxxx xxxx x xxxx. Xx xxxxxxxxx xxxx xx xxx xxxxxxxxxxxxxx xx xxxx Xxxxxx Xxxx xxxx x xxxxxx, xx xxxx, xxxxxx xx xxxxxxxx xxx xxxxx xx x xxxxxx xxxx xx xxxxxxx. Xxx xxxxxx xxxxxx xxxxxxxxxxxxxx xxxxxx xxxxxx xx xxxxx xxx xxxx xxxxxxx xxx xxxxxx xx xxxxx xxxxx; xxxxxx xxx xxxxxxx xxx xxxxx xxx xxxx xxxxxx xx xxxxxx xxxxx.

> **Xxxx**   Xxx xxxxxx xxxx xxxx xxxxxxxxxxx xx xxxx xxxxxxxx xx xxxxx xx xxx [XxxxxxX Xxxxxx Xxxx xxxx xxxxxx](http://go.microsoft.com/fwlink/?LinkId=624011).

Xxxx xxx xxxx xx xxx xxx xxxxxx xxxx xxxx xxxxxxxx xxxxxxxxx xxx xxxx xxx xxxx xxxx xxxxx xx xxxx xxxx:

-   Xxxxxxxx xxxxx Xxxxx Xxxxxxxxxx xx xxxxxx xxxxx xxxxxx xxx XXxxxxY xx xxxx xxxxx. Xxxxxxx, xx xxx xxxx xx xxxxxxxx xxxxx xxxxx-xxxxxxx xxxxxxxxx xxxx xxxxx xx x Xxxxxxxxx Xxxxxxx Xxxxxxxx (XXX) xxx, xxx xxx xxx xx.
-   Xx xxxxx xxxxx xxxxxxxx xxx xxxxxx xxxxx xxx xxxx xxxxxx xxxxx, xxxx xx xxxx xxxxxx xxxxxx, xxx xxx xxxxxxxxx xxxxx. Xxxxxx xxxxxx xxx xxxx xxxx xxxxxx xxxxxx xxx/xx xxx xxxxxxxxx xxxxx. Xxxxxx xxxxxx xxxx xxxx xxxxx xxxxxx xxxxxx xx xxx xxxxxxxxx xxxxx.
-   Xx xxxx xxxxxxxxxx xxxxx xxxxx xxx xxxxx, xxxxxxxx xxxxxxxxx xxxx xxxxx xxxx xxxxxxx xxxxxxx xx xxxx xxxx xxxxxx xx xxxx.
-   Xx xx xxxxx xxxxx xx xx xx, xxxxx xxxxx xxxxxxxx xxxx xxx xxx xxxxx xxxxx xx xxxxxxxxxx, xx xx xxxxxxxxx. Xxxxxx xxxxxxxx xxxx xxxx xxx xxxxxxx xxxxx, xxxxxxx xxxxxxx, xx xx xxxxxxx.
-   Xxx xxxxx xxxxxxxxxx xx xxxxxxx xxx xxxx xx xxxx xxxxx. Xxx xxxxxxx, xxx xxxxxxxxx xxx **XxxxxXxxxxxxx\_XxxxXxxxx** xxx xxxx xxxxxxxxxx xxxxx xxx **XxxxxXxxxxxxx\_XxxxXxxxxxx** xxx xxxxx xxxxxxx.
-   Xxxxxx xxxxxx xxxxxxx, xxxxxxxxx xxxxxxxxxx, xx xxxxxxxxx xxx xxxxxxxxxx xxx xxxxx xxxxxxxxx xxx xxxxxxxxxx.
-   Xxxxxxxx xxxxxxx xx xxxxxxxx xxxxx xxxxx xxxx xxxxxxxxxx xxxx xxxxx xxx xxxxxxxxx xxxxx xx x xxxxxxxxxxx. Xxxxxxxxx, xxx xxx xxxxx xxxxx xxxxxxxxxxxx xx xxxx xx xxxxx xxxxxx.

## Xxxxxxxxxxx XXxxxxY xxx Xxxxxxxxx Xxxxx Xxxxxxxxxx


XXxxxxY xx x xxx-xxxxx xxxxx xxxxxxx xxx Xxxxxxx xxxx xxxxxxxxxxxx xxxxxxxx xxxx xxxxx. Xx xxxxxxxx x xxxxxxx xxxxxx xxxxxxxxxx (XXX) xxx xxxxx-xxxxx xxxxxx xxx xxxxx. XXxxxxY xxxxxxx xx xxx xxxxxxxxxxxx, XxxxxxXxxxx xxx XXxxxx, xx xxxxxxxxxx xxxxxxxxx xxxxxx xxxx xx XXXX xxxxxxxx-xxxxx xxxxxxxxxxxxx xxx XX xxxxx. Xx xxxx xxxxxxxx xxx xxxx xxxxxxx xxxxx xxxxxxxxxx xxxxxxx xx xxxxxâ€™x xxxxx.

Xxx xxxxxxxx [XXxxxxY Xxx Xxxxxxxx](https://msdn.microsoft.com/library/windows/desktop/ee415764) xxxxxxxx xxx xxx xxxxxxxx xxx xxxxx XXxxxxY. Xx xxxxx, xxx xxxxxxxx xxx:

-   Xxx [**XXXxxxxY**](https://msdn.microsoft.com/library/windows/desktop/ee415908) xxxxxxxxx xx xxx xxxx xx xxx XXxxxxY xxxxxx. Xxxxxx Xxxx xxxx xxxx xxxxxxxxx xx xxxxxx xxxxxx xxx xx xxxxxxx xxxxxxxxxxxx xxxx xxx xxxxxx xxxxxx xxxxxxx xx xxxxx.
-   X xxxxx xxxxxxxxx, xxxxxxx, xxx xxxxx xxxxx xxxx.
-   X xxxxxx xxxxx xx x xxxxxxxxxx xx xxxxx xxxxxxxx (xxxx, Y.Y, xxx xx xx) xxx xxxxxxxxxx xxx xxxxxx xx xxxxx xxxx. Xx XXxxxxY, x xxxxxx xxxxx xx xxxxx xxxxx xxxxxxxxxx xxxxxx. Xxxxxxxxx, xxxxx xxxx xx xxxxxx xxxx xx xxxxxxxx xxxxxx, xxxx xx x xxxx xx x xxxxxxx, xxx xx xxxx xx x xxxxxx xxxxx. Xxxxxx Xxxx xxxx [Xxxxx Xxxxxxxxxx](https://msdn.microsoft.com/library/windows/desktop/ms694197) xx xxxx xxxxx xxxx xxxx xxxxx. Xxxxx Xxxxxxxxxx xx xxxxxxxxxx xxxxx xx xxxx xxxxxxxx.
-   X xxxxxx xxxxx xxxxxxxxx xxxxx xxxx. Xxxx xxxxxxxxxx xxx xxxxxxx xxxxxxxx xxx xxxxx xxxxxx xx xxxxxxxxx xxxxxxxx xxxxxxx xxxx xxx. Xxxxxx Xxxx xxxx xxxxxxxx xx xxxxxx xxx xxxxxx xxxxxx.
-   X xxxxxxxxx xxxxx xxxxxxxx xxxx xxxx xxxxxx xxx xxxxxx xxxxxx xxx xxxxx xxxx xxxx xx xxx xxxxx xxxxxxxx.
-   Xx xxxxx xxxxx xxxxxxxx xxx xxxxxx xxxxx xxx xxxx xxxxxx xxxxx, xxxx xx xxxx xxxxxx xxxxxx, xxx xxxx xxx xxxxxxxxx xxxxx.
-   X xxxxxxxx xxxxxxx xxxxxx xxxx xxxx xxxx xxxxx xxx xxxxxxxx xx x xxxxx xx xx xx xxxxxx xxxxxx. Xx xxxxx xxxxxxxxx, xxx xxx xxxxx xxxxxx xxxx XXxxxxY xx xxxxxxxx xxxx x xxxxxx, xxxxx xxxx xxx xxxxx xxxxxx xxxxxxx (xxx xxxxxxx, xxxx xxx xxxxxxx xx xxxxxxxxxx xxxxxxxxxx), xxx xxxx. Xxx [Xxxxxxxx xxxxxxxxxx xxx xxxxxx xxxxxxx xxxxxxx](#phones) xxxxx xx xxxx xxxxxxxx xxxxxxxx xxx Xxxxxx Xxxx xxxx xxxx xxxxxxxxx xx xxxxxx xxxxxx xxxxxxx.

Xxxxxx Xxxx xxxx xxx xxxxx xxxxxxx (xx xxxxx xxxxx, xxx [**XXXxxxxY**](https://msdn.microsoft.com/library/windows/desktop/ee415908) xxxxxxx) xx xxxxxxx xxxxx. Xxx xxxxxx xxxxxxxxx xxx xxxxxxxxxx xxxxx, xxx xxx xxxxx xxxxxx xxxxxxxxx xxxx-xxxx xxxxxx.

Xxxxxx Xxxx xxxx xxxx xxxxxx xxx xxxxxxxxx xxxxx xxx xxxx xxxxxx. Xxxxxx xxxx x xxxxxxxxx xxxxxx xxxxxxxx xxxxx xxxxxxx xxxx xxx xxxxxx xxx xxxxx xxxx xxxxxx xx xxx xxxxx xxxxxxxx. Xxx xxxxxxxxxx xxxxx xxxxxx, x xxxxxx xxxxx, xxxxxxx xxxx xx x xxxxxxxxx xxxxx xxx xx xxx xxxxxx xxxxxx. Xxx xxxxxx xxxxxx xxxxxxx xxx xxxxxx xxxxxx.

Xxxxx Xxxxxxxxxx xx x xxxxxxxxxx xxxxxxx xxxx xxxxxxxx xxxx xxxxx xxx xxxxx xxxxxxx. XXxxxxY xxx Xxxxx Xxxxxxxxxx xxxxxxxxxx xxxx xxxxx. Xxxxxx Xxxx xxxx Xxxxx Xxxxxxxxxx xx xxxx xxxxx xxxxxx xxxx xxxx xxx xxxx XXxxxxY xx xxxx xxxxx. Xxx xxx'x xxxx xx xxx Xxxxx Xxxxxxxxxx xx xxxx xxxxx xxxxxx. Xx xxx xxxx xx xxxxxxxx xxxxx xxxxx xxxxxxx xxxxxxxxx xxxx xxxxx xx Xxxxxxxxx Xxxxxxx Xxxxxxxx (XXX) xxxx, xxx xx.

Xxx xxxx xxxxxxxxxxx xxxxx XXxxxxY, xxx [Xxxxxxxxxxx Xxxxx](https://msdn.microsoft.com/library/windows/desktop/ee415737). Xxx xxxx xxxxxxxxxxx xxxxx Xxxxx Xxxxxxxxxx, xxx [Xxxxxxxxx Xxxxx Xxxxxxxxxx](https://msdn.microsoft.com/library/windows/desktop/ms694197).

## Xxxxxxxxxxxx xxxxx xxxxxxxxx


Xxxxxx Xxxxx xxxx x Xxxxxxx Xxxxx Xxxxx (.xxx) xxxx xxx xxx xxxxxxxxxx xxxxx, xxx XXX (.xxx) xxxxx xxx xxxx xxxx xxxxxx. Xxxxx xxxxxxx xxx xxxxxxxxx xx Xxxxx Xxxxxxxxxx. Xxxxxxxx xxx .xxx xxxx xxxxxx xx xxxxxxxx xxxxxxxxx xx XXxxxxY, x xxxx xxx xx xxxxx xxx xxxx xxxxxx xxxxxxxx xx xxxx xxx xxx xxxxxxxxxxx XXxxxxY xxxx xxxxxxxxxx. Xxxxxx Xxxx xxxx Xxxxx Xxxxxxxxxx xx xxxx xxxxxx xxxx xxxx .xxx xxxxx. Xxx xxx xxxxxxxx xxxx xx xxx xxxxx xxxxxxx xxxx xxx xxxxxxxxx xx Xxxxx Xxxxxxxxxx, xxx [Xxxxxxxxx Xxxxx Xxxxxxx xx Xxxxx Xxxxxxxxxx](https://msdn.microsoft.com/library/windows/desktop/dd757927). Xxxxxx Xxxx xxxx xxx xxx xxxxxxxx xxxxxx-xxxx xxx xxx-xxxx xxxxx xxxxxxx, xxx xxxx xxx xxx XXxxxxY XXXXX xxxxxxxxxxx xxxxxxx. Xxx xxxx xxxxxxxxxxx xxxxx XXXXX xxxxxxxxxxx xx XXxxxxY, xxx [XXXXX Xxxxxxxx](https://msdn.microsoft.com/library/windows/desktop/ee415711).

Xxx **Xxxxx::XxxxxxXxxxxxxxx** xxxxxx, xxxxx xx xxxxxx xxxx **XxxxxxXxxx::XxxxxxXxxxxxXxxxxxxxxxxXxxxxxxxx**, xxxxx xxx xxxxx xxxxxxx xxxx xxxx, xxxxxxxxxxx xxx XXxxxxY xxxxxx xxxxxxx, xxx xxxxxxx xxx xxxxxx, xxxxxx, xxx xxxxxxxxx xxxxxx.

###  Xxxxxxxx xxx XXxxxxY xxxxxxx

Xxxxxx xxxx Xxxxxx Xxxx xxxxxxx xxx [**XXXxxxxY**](https://msdn.microsoft.com/library/windows/desktop/ee415908) xxxxxx xx xxxxxxxxx xxxx xxxxx xxxxxx xxxx xx xxxx. Xx xxxxxx xx xxxxx xxxxxx, xxxx xxx [**XXxxxxYXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee419212) xxxxxxxx. Xxx xxxxxxxxx xxxxxxx xxxxx xxx Xxxxxx Xxxx xxxxxxx xxx xxxxx xxxxxx xxxx xxxxxxxxx xxxxxxxxxx xxxxx.

```cpp
DX::ThrowIfFailed(
    XAudio2Create(&m_musicEngine)
    );
```

Xxxxxx Xxxx xxxxxxxx x xxxxxxx xxxx xx xxxxxx xxx xxxxx xxxxxx xxxx xxxxx xxxx-xxxx xxxxxx.

Xxx xx xxxx xxxx xxx [**XXXxxxxY**](https://msdn.microsoft.com/library/windows/desktop/ee415908) xxxxxxxxx xx x XXX xxx xxxxxxx xxxx x xxxxxxx xxx xx xxx xxxx. Xxxxx, xxx xxx'x xxxx xx xxxx **XxXxxxxxxxxxXx** xxxxxx xxx xxxx [**XXxxxxYXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee419212). Xx xxxxxxxx, **XXXxxxxY** xx xxxxxx xxxxxxxx xxxxxx xxxxxxxxxxx. Xxx xxxxxxxxxxx xxxxx xxx xx xxxxxxxxx xxxxx xxxxxxx, xxx [Xxxxxxxxxxx xxxxxxx](https://msdn.microsoft.com/library/windows/apps/hh464977).

###  Xxxxxxxx xxx xxxxxxxxx xxxxxx

Xxx xxxxxxxxx xxxxxxx xxxxx xxx xxx **Xxxxx::XxxxxxXxxxxxxxx** xxxxxx xxxxxxx xxx xxxxxxxxx xxxxx xxx xxx xxxxxxxxxx xxxxx. Xxx xxxx xx [**XXXxxxxY::XxxxxxXxxxxxxxxXxxxx**](https://msdn.microsoft.com/library/windows/desktop/hh405048) xxxxxxxxx xxx xxxxx xxxxxxxx. Xxxx xxxxxxxxxx xxx xxxxx xxx xxx xxxxxx xxxxxx. Xxx **XXXXXXY\_XXXXXXX\_XXXXXXXXXX** xxxxxxxxxxxxx xxxxx xxx xxxxx xxxxxx xx xxx xxx xxxxxx xxxx xxxx xx xxxxxxxxx xx xxx Xxxxx Xxxxxxx Xxxxx. Xx xxxx xxxxxxx, **x\_xxxxxXxxxxxxxxXxxxx** xx xx [**XXXxxxxYXxxxxxxxxXxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee415912) xxxxxx.

```cpp
// This sample plays the equivalent of background music, which we tag on the  
// mastering voice as AudioCategory_GameMedia. In ordinary usage, if we were  
// playing the music track with no effects, we could route it entirely through 
// Media Foundation. Here, we are using XAudio2 to apply a reverb effect to the 
// music, so we use Media Foundation to decode the data then we feed it through 
// the XAudio2 pipeline as a separate Mastering Voice, so that we can tag it 
// as Game Media. We default the mastering voice to 2 channels to simplify  
// the reverb logic.
DX::ThrowIfFailed(
    m_musicEngine->CreateMasteringVoice(
        &m_musicMasteringVoice, 
        2, 
        48000, 
        0, 
        nullptr, 
        nullptr, 
        AudioCategory_GameMedia
        )
);
```

Xxx **Xxxxx::XxxxxxXxxxxxxxx** xxxxxx xxxxxxxx x xxxxxxx xxxx xx xxxxxx xxx xxxxxxxxx xxxxx xxx xxx xxxx xxxx xxxxxx, xxxxxx xxxx xx xxxxxxxxx **XxxxxXxxxxxxx\_XxxxXxxxxxx** xxx xxx *XxxxxxXxxxxxxx* xxxxxxxxx, xxxxx xx xxx xxxxxxx. Xxxxxx Xxxx xxxxxxxxx **XxxxxXxxxxxxx\_XxxxXxxxx** xxx xxxxxxxxxx xxxxx xx xxxx xxxxx xxx xxxxxx xx xxxxx xxxx x xxxxxxxxx xxxxxxxxxxx xx xxxx xxxx xxx xxxx. Xxxx x xxxxx xxx xx xxxxxxx, Xxxxxxx xxxxx xxx xxxxxx xxxx xxx xxxxxxx xx xxx **XxxxxXxxxxxxx\_XxxxXxxxx** xxxxxx. Xxx xxxx xxxxx xxxxx xxxx-xxxx xxxxxx xxxxxxx xxxx xxx xxxxxxx xx xxx **XxxxxXxxxxxxx\_XxxxXxxxxxx** xxxxxx. Xxx xxxx xxxx xxxxx xxxxx xxxxxxxxxx, xxx [**XXXXX\_XXXXXX\_XXXXXXXX**](https://msdn.microsoft.com/library/windows/desktop/hh404178) xxxxxxxxxxx.

###  Xxxxxxxx xxx xxxxxx xxxxxx

Xxx xxxx xxxxx, xxx xxx xxx XXxxxxY xx xxxxxx xxxxxxxxx xx xxxxxxx xxxx xxxxxxx xxxxx. Xxxx x xxxxxxxx xx xxxxx xx xx xxxxxx xxxxx. Xxx xxxxxx xxxxxx xxxx xxx xxxx xx xxxxx xxx xx xxxx xxxxxxx xx x xxxxx. Xxxxxx xxxxxx xxx xx xxxxxxxxxxx; xxxx xx, xxxx xxxxxx xx xxx xxxxx xxx xxxxxxxxx xxx xxxxx xxxxxx. Xxxx xxxxxxxx xx xxxxxxxxx xxxxxxx XXxxxxY xxxxx xx xxxxxxxxx xxxx xxxxxx xxxxxxx xxx xxxxxxxxxxx xxxx xxxxxxx. Xxxxxx xxxxxxx xxx xxxxxxxxxxx xx XXxxxxY xx xxxxx-xxxxxxxx xxxxx xxxxxxxxxx xxxxxxx (XXXX). Xxx xxxx xxxxxxxxxxx xxxxx XXXX, xxx [XXXX Xxxxxxxxx](o:microsoft.directx_sdk.xapo.audio_overview_xapo).

Xxxx xxx xxxxxx xx xxxxxx xxxxx, xxxxxx xxxxx xxxxx:

1.  Xxxxxx xxx xxxxxx xxxxxx.
2.  Xxxxxxxx xx [**XXXXXXY\_XXXXXX\_XXXXXXXXXX**](https://msdn.microsoft.com/library/windows/desktop/ee419236) xxxxxxxxx xxxx xxxxxx xxxx.
3.  Xxxxxxxx xx [**XXXXXXY\_XXXXXX\_XXXXX**](https://msdn.microsoft.com/library/windows/desktop/ee419235) xxxxxxxxx xxxx xxxx.
4.  Xxxxx xxx xxxxxx xxxxx xx x xxxxx.
5.  Xxxxxxxx xx xxxxxx xxxxxxxxx xxxxxxxxx xxx xxxxx xx xx xxx xxxxxx.
6.  Xxxxxxx xx xxxxxx xxx xxxxxx xxxxxxxx xxxxxxxxxxx.

Xxx **Xxxxx** xxxxx xxxxxxx xxx **XxxxxxXxxxxx** xxxxxx xx xxxxxx xxx xxxxxx xxxxx xxxx xxxxxxxxxx xxxxxx. Xxxx xxxxxx xxxxx xxx [**XXxxxxYXxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee419213) xxxxxxxx xx xxxxxx x [**XXXxxxxYXxxxxxXxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee415915) xxxxxx, xxxxx xxxx xx xxx xxxxxx xxxxx xxx xxx xxxxxx xxxxxx.

```cpp
DX::ThrowIfFailed(
    XAudio2CreateReverb(&soundEffectXAPO)
    );
```

Xxx [**XXXXXXY\_XXXXXX\_XXXXXXXXXX**](https://msdn.microsoft.com/library/windows/desktop/ee419236) xxxxxxxxx xxxxxxxx xxxxxxxxxxx xxxxx xx XXXX xxx xxx xx xx xxxxxx xxxxx, xxx xxxxxxx, xxx xxxxxx xxxxxx xx xxxxxx xxxxxxxx. Xxx **Xxxxx::XxxxxxXxxxxx** xxxxxx xxxxxxx xx **XXXXXXY\_XXXXXX\_XXXXXXXXXX** xxxxxx xxxx xx xxx xx xxx xxxxxxxx xxxxx, xxxx xxx xxxxxx xxxxxxxx, xxx xxxxxxxxxx xxx [**XXXxxxxYXxxxxxXxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee415915) xxxxxx xxx xxx xxxxxx xxxxxx. Xxx **XXXXXXY\_XXXXXX\_XXXXXXXXXX** xxxxxx xxxxxx xx xxx xxxxxxxx xxxxx xxxxxxx xxx xxxx xxxx xxx xxxxxxxxxx xxxxxx xxx xxxxxx xxxxxx xxxxxxxxx xxxx xxxxxx. Xxxxxx Xxxx xxxx xxx xxxxxx xxxxxxxx xx xxxxxxxx xxx xxxxx xxx xxx xxxxxx xxxxxx.

```cpp
soundEffectdescriptor.InitialState = false;
soundEffectdescriptor.OutputChannels = 2;
soundEffectdescriptor.pEffect = soundEffectXAPO.Get();
```

Xx xxxx xxxxxx xxxxx xxx xxxxxxxx xxxxxxx, xxxx xxxxxx xxxxxxxx xx xxxxxx. Xxx [**XXXXXXY\_XXXXXX\_XXXXX**](https://msdn.microsoft.com/library/windows/desktop/ee419235) xxxxxxxxx xxxxx xxx xxxxx xx [**XXXXXXY\_XXXXXX\_XXXXXXXXXX**](https://msdn.microsoft.com/library/windows/desktop/ee419236) xxxxxxx xxxx xxxxxxxxxxx xx xxx xxxxxx. Xxx xxxxxxxxx xxxxxxx xxxxx xxx xxx **Xxxxx::XxxxxxXxxxxx** xxxxxx xxxxxxxxx xxx xxx xxxxxx xx xxxxxxxxx xxxxxx.

```cpp
soundEffectChain.EffectCount = 1;
soundEffectChain.pEffectDescriptors = &soundEffectdescriptor;
```

Xxx **Xxxxx::XxxxxxXxxxxx** xxxxxx xxxxx xxx [**XXXxxxxY::XxxxxxXxxxxxXxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee418608) xxxxxx xx xxxxxx xxx xxxxxx xxxxx xxx xxx xxxxxx. Xx xxxxxxxxx xxx [**XXXXXXY\_XXXXXX\_XXXXX**](https://msdn.microsoft.com/library/windows/desktop/ee419235) xxxxxx xxx xxx *xXxxxxxXxxxx* xxxxxxxxx xx xxxxxxxxx xxx xxxxxx xxxxx xxxx xxx xxxxx. Xxxxxx Xxxx xxxx xxxxxxxxx xxx xxxxxx xxxxxxxx xxx x xxxxxx xxxx xx YY xxxxxxxxx. Xx xxxxx xxxx xxxxxx xxxx xxxxxxx xx xxxxxxxxxxx x xxxxxxx xxxxxxx xxxxx xxxxxxx xxx xxx xxxxxx xx xxxxxxxx XXX xxxxxxxxxx. X xxxxxxx xxxxxx xxxx xxxxx xxxx xxxxxxxx xxxx XXX xxxxxxxxxx xxxxxxx xxxxxx x xxxxxxxxxx xxxxxxx xxxxxxx.

```cpp
DX::ThrowIfFailed(
    engine->CreateSubmixVoice(newSubmix, 2, 48000, 0, 0, nullptr, &soundEffectChain)
    );
```

> **Xxx**   Xx xxx xxxx xx xxxxxx xx xxxxxxxx xxxxxx xxxxx xx xx xxxxxxxx xxxxxx xxxxx, xx xxx xxxx xx xxxxxxx xxx xxxxxxx xxxxxx xxxxx, xxx xxx [**XXXxxxxYXxxxx::XxxXxxxxxXxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee418594) xxxxxx.

 

Xxx [**Xxxxx::XXxxxxYXxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee419213) xxxxxx xxxxx [**XXXxxxxYXxxxx::XxxXxxxxxXxxxxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee418595) xx xxx xxxxxxxxxx xxxxxxxxxx xxxx xxx xxxxxxxxxx xxxx xxx xxxxxx. Xxxx xxxxxx xxxxx x xxxxxxxxx xxxxxxxxx xxxx xx xxxxxxxx xx xxx xxxxxx. Xx [**XXXXXXYXX\_XXXXXX\_XXXXXXXXXX**](https://msdn.microsoft.com/library/windows/desktop/ee419224) xxxxxx, xxxxx xxxxxxxx xxx xxxxxx xxxxxxxxxx xxx xxxxxx, xx xxxxxxxxxxx xx xxx **Xxxxx::Xxxxxxxxxx** xxxxxx xxxxxxx xxxxx xxxxxx xxxxxx xxxxxx xxx xxxx xxxxxxxxxx. Xxx xxxxxxxxx xxxxxxx xxxxx xxx xxx **Xxxxx::Xxxxxxxxxx** xxxxxx xxxxxxxxxxx xxx xxxxxx xxxxxxxxxx xxx xxxx-xxxxx xxxxxx.

```cpp
m_reverbParametersSmall.ReflectionsDelay = XAUDIO2FX_REVERB_DEFAULT_REFLECTIONS_DELAY;
m_reverbParametersSmall.ReverbDelay = XAUDIO2FX_REVERB_DEFAULT_REVERB_DELAY;
m_reverbParametersSmall.RearDelay = XAUDIO2FX_REVERB_DEFAULT_REAR_DELAY;
m_reverbParametersSmall.PositionLeft = XAUDIO2FX_REVERB_DEFAULT_POSITION;
m_reverbParametersSmall.PositionRight = XAUDIO2FX_REVERB_DEFAULT_POSITION;
m_reverbParametersSmall.PositionMatrixLeft = XAUDIO2FX_REVERB_DEFAULT_POSITION_MATRIX;
m_reverbParametersSmall.PositionMatrixRight = XAUDIO2FX_REVERB_DEFAULT_POSITION_MATRIX;
m_reverbParametersSmall.EarlyDiffusion = 4;
m_reverbParametersSmall.LateDiffusion = 15;
m_reverbParametersSmall.LowEQGain = XAUDIO2FX_REVERB_DEFAULT_LOW_EQ_GAIN;
m_reverbParametersSmall.LowEQCutoff = XAUDIO2FX_REVERB_DEFAULT_LOW_EQ_CUTOFF;
m_reverbParametersSmall.HighEQGain = XAUDIO2FX_REVERB_DEFAULT_HIGH_EQ_GAIN;
m_reverbParametersSmall.HighEQCutoff = XAUDIO2FX_REVERB_DEFAULT_HIGH_EQ_CUTOFF;
m_reverbParametersSmall.RoomFilterFreq = XAUDIO2FX_REVERB_DEFAULT_ROOM_FILTER_FREQ;
m_reverbParametersSmall.RoomFilterMain = XAUDIO2FX_REVERB_DEFAULT_ROOM_FILTER_MAIN;
m_reverbParametersSmall.RoomFilterHF = XAUDIO2FX_REVERB_DEFAULT_ROOM_FILTER_HF;
m_reverbParametersSmall.ReflectionsGain = XAUDIO2FX_REVERB_DEFAULT_REFLECTIONS_GAIN;
m_reverbParametersSmall.ReverbGain = XAUDIO2FX_REVERB_DEFAULT_REVERB_GAIN;
m_reverbParametersSmall.DecayTime = XAUDIO2FX_REVERB_DEFAULT_DECAY_TIME;
m_reverbParametersSmall.Density = XAUDIO2FX_REVERB_DEFAULT_DENSITY;
m_reverbParametersSmall.RoomSize = XAUDIO2FX_REVERB_DEFAULT_ROOM_SIZE;
m_reverbParametersSmall.WetDryMix = XAUDIO2FX_REVERB_DEFAULT_WET_DRY_MIX;
m_reverbParametersSmall.DisableLateField = TRUE;
```

Xxxx xxxxxxx xxxx xxx xxxxxxx xxxxxx xxx xxxx xx xxx xxxxxx xxxxxxxxxx, xxx xx xxxx **XxxxxxxXxxxXxxxx** xx XXXX xx xxxxxxx xxxx-xxxxx xxxxxx, **XxxxxXxxxxxxxx** xx Y xx xxxxxxxx xxxx xxxx xxxxxxxx, xxx **XxxxXxxxxxxxx** xx YY xx xxxxxxxx xxxx xxxxxxx xxxxxxx xxxxxxxx. Xxxx xxxx xxxxxxxx xxxxx xxxxxx xx xxxxx xxx xxxx xxxxxxx xxx xxxxxx; xxxxxxx xxxxxxx xxxxxxxx xxxxx xxxxxx xx xx xxxxxxx xxx xxxxx xxx xxxx xxxxxx. Xxx xxx xxxxxxxxxx xxxx xxxxxx xxxxxx xx xxx xxx xxxxxxx xxxxxx xx xxxx xxxx xx xxx xxx **XxxxxxXxxxxxxXYXXYXxXxxxxx** xxxxxxxx xx xxx xxxxxxxx-xxxxxxxx XYXXY (Xxxxxxxxxxx YX Xxxxx Xxxxxxxxx Xxxxxxxxxx Xxxxx Y.Y) xxxxxxxxxx.

Xxx xxxxxxxxx xxxxxxx xxxxx xxx **Xxxxx::XxxxxxXxxxxx** xxxx xxx xxxxxx xxxxxxxxxx. Xxx xxxxxxxxxx xxxxxxxxx xx xx [**XXXXXXYXX\_XXXXXX\_XXXXXXXXXX**](https://msdn.microsoft.com/library/windows/desktop/ee419224) xxxxxx.

```cpp
DX::ThrowIfFailed(
    (*newSubmix)->SetEffectParameters(0, parameters, sizeof(m_reverbParametersSmall))
    );
```

Xxx **Xxxxx::XxxxxxXxxxxx** xxxxxx xxxxxxxx xx xxxxxxxx xxx xxxxxx xx xxx **xxxxxxXxxxxx** xxxx xx xxx xxx xx xxxxxxx xxx xxxxxx xxx xxxxxx xxxxxx. Xxxx xxxx xxxx xxx xxxxxx xx xxxx (Y.Y) xxx xxxx xxxxxxxxx xxx xxxxxx xxxxxx xx xx xxxxxxx xxx xxxx xxxx xxx xxxxx xxxxxx xxx xxxx xxx xxxxx xxxxxx xxxxxxxx. Xx xx xxxx xxxxxxx xxxxx xxxx xxxxx xxxxx-xxxxx xxxxxxx xxx xxx xxxxxxx (xxxxxxxxxx xxx xxxxxxxxxx xxxx xxxxx xxxx x xxxx xx xxxxx xx x xxxxx xxxx), xx xxxxx xxxx xxxxxxx xx xxxxxxxx. Xxxx xxx xxxxxx xxxx xx xxxxx xxxxxxx, xxx xxxx xxxx x xxxxxx xx {Y.Yx, Y.Yx, Y.Yx, Y.Yx} xx xxxxx xxxx xxxxxx xxxxxx xx xxx xxxx xxxxx xx xxx xxxxxxxxx xxxxx xxx xxxxx xxxxxx xxxxxx xx xxx xxxxx xxxxx xx xxx xxxxxxxxx xxxxx.

```cpp
if (enableEffect)
{
    DX::ThrowIfFailed(
        (*newSubmix)->EnableEffect(0)
        );    
}

DX::ThrowIfFailed(
    (*newSubmix)->SetVolume (1.0f)
    );

float outputMatrix[4] = {0, 0, 0, 0};
DX::ThrowIfFailed(
    (*newSubmix)->SetOutputMatrix(masteringVoice, 2, 2, outputMatrix)
    );
```

Xxxxxx Xxxx xxxxx xxx **XxxxxxXxxxxx** xxxxxx xxxx xxxxx; xxx xxxxx xxx xxx xxxxxxxxxx xxxxx xxx xxx xxxxx xxx xxx xxxx-xxxx xxxxxx. Xxx xxxxxxxxx xxxxx xxx Xxxxxx Xxxx xxxxx xxx **XxxxxxXxxxxx** xxxxxx xxx xxx xxxxxxxxxx xxxxx.

```cpp
CreateReverb(
    m_musicEngine, 
    m_musicMasteringVoice, 
    &m_reverbParametersSmall, 
    &m_musicReverbVoiceSmallRoom, 
    true
    );
CreateReverb(
    m_musicEngine, 
    m_musicMasteringVoice, 
    &m_reverbParametersLarge, 
    &m_musicReverbVoiceLargeRoom, 
    true
    );
```

Xxx x xxxx xx xxxxxxxx xxxxxxx xx xxxxxxx xxx xxx xxxx XXxxxxY, xxx [XXxxxxY Xxxxx Xxxxxxx](https://msdn.microsoft.com/library/windows/desktop/ee415756).

### Xxxxxxx xxxxx xxxx xxxx xxxx

Xxxxxx Xxxx xxxxxxx xxx **XxxxxXxxxxxxx** xxxxx, xxxxx xxxx Xxxxx Xxxxxxxxxx xx xxxx xxxxx xxxxxxxxx xxxx xxxx. Xxxxxx Xxxx xxxx xxx **XxxxxXxxxxxxx** xxxxxx xx xxxx xxxx xxxxx xxxx.

Xxxxxx Xxxx xxxxx xxx **XxxxxXxxxxxxx::Xxxxxxxxxx** xxxxxx xx xxxxxxxxxx xxxx xxxxx xxxxxx. Xxxx'x xxx xxx **Xxxxx::XxxxxxXxxxxxxxx** xxxxxx xxxxx **XxxxxXxxxxxxx::Xxxxxxxxxx** xx xxxxxxxxxx xxx xxxxx xxxxxx xxx xxx xxxxxxxxxx xxxxx:

```cpp
// Media Foundation is a convenient way to get both file I/O and format decode for 
// audio assets. You can replace the streamer in this sample with your own file I/O 
// and decode routines.
m_musicStreamer.Initialize(L"Media\\Audio\\background.wma");
```

Xxx **XxxxxXxxxxxxx::Xxxxxxxxxx** xxxxxx xxxxxx xx xxxxxxx xxx [**XXXxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ms702238) xxxxxxxx xx xxxxxxxxxx Xxxxx Xxxxxxxxxx.

```cpp
DX::ThrowIfFailed(
    MFStartup(MF_VERSION)
    );
```

**XxxxxXxxxxxxx::Xxxxxxxxxx** xxxx xxxxx [**XXXxxxxxXxxxxxXxxxxxXxxxXXX**](https://msdn.microsoft.com/library/windows/desktop/dd388110) xx xxxxxx xx [**XXXXxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/dd374655) xxxxxx. Xx **XXXXxxxxxXxxxxx** xxxxxx xxxxx xxxxx xxxx xxxx xxx xxxx xxxx xx xxxxxxxxx xx xxx.

```cpp
DX::ThrowIfFailed(
    MFCreateSourceReaderFromURL(url, nullptr, &m_reader)
    );
```

Xxx **XxxxxXxxxxxxx::Xxxxxxxxxx** xxxxxx xxxx xxxxxxx xx [**XXXXxxxxXxxx**](https://msdn.microsoft.com/library/windows/desktop/ms704850) xxxxxx xx xxxxxxxx xxx xxxxxx xx xxx xxxxx xxxxxx. Xx xxxxx xxxxxx xxx xxx xxxxx: x xxxxx xxxx xxx x xxxxxxx. Xxx xxxxx xxxx xxxxxxx xxx xxxxxxx xxxxxx xx xxx xxxxx, xxxx xx xxxxx, xxxxx, xxxxxx, xxx xx xx. Xxx xxxxxxx xxxxxxx xxx xxxxxx, xxxx xx XXX, XXXXX, xx XXX. Xxx **XxxxxXxxxxxxx::Xxxxxxxxxx** xxxxxx xxxx xxx [**XXXXxxxxXxxx::XxxXXXX**](https://msdn.microsoft.com/library/windows/desktop/bb970530) xxxxxx xx xxxxxxx xxx xxxxx xxxx xx xxxxx (**XXXxxxxXxxx\_Xxxxx**) xxx xxx xxxxx xxxx xx xxxxxxxxxxxx XXX xxxxx (**XXXxxxxXxxxxx\_XXX**). Xxx [**XXXXxxxxxXxxxxx::XxxXxxxxxxXxxxxXxxx**](https://msdn.microsoft.com/library/windows/desktop/bb970432) xxxxxx xxxxxxxxxx xxx xxxxx xxxx xxxx xxx xxxxxx xxxxxx.

```cpp
// Set the decoded output format as PCM. 
// XAudio2 on Windows can process PCM and ADPCM-encoded buffers. 
// When this sample uses Media Foundation, it always decodes into PCM.

DX::ThrowIfFailed(
    MFCreateMediaType(&mediaType)
    );

DX::ThrowIfFailed(
    mediaType->SetGUID(MF_MT_MAJOR_TYPE, MFMediaType_Audio)
    );

DX::ThrowIfFailed(
    mediaType->SetGUID(MF_MT_SUBTYPE, MFAudioFormat_PCM)
    );

DX::ThrowIfFailed(
    m_reader->SetCurrentMediaType(MF_SOURCE_READER_FIRST_AUDIO_STREAM, 0, mediaType.Get())
    );
```

Xxx **XxxxxXxxxxxxx::Xxxxxxxxxx** xxxxxx xxxx xxxxxxx xxx xxxxxxxx xxxxxx xxxxx xxxxxx xxxx Xxxxx Xxxxxxxxxx xxx xxxxx xxx [**XXXxxxxxXxxxXxxxxxXxXxxxXXXxxxxXxxx**](https://msdn.microsoft.com/library/windows/desktop/ms702177) xxxxxxxx xx xxxxxxx xxx Xxxxx Xxxxxxxxxx xxxxx xxxxx xxxx xx x [**XXXXXXXXXXXX**](https://msdn.microsoft.com/library/windows/hardware/ff538799) xxxxxxxxx. Xxx **XXXXXXXXXXXX** xxxxxxxxx xxxxxxx xxx xxxxxx xx xxxxxxxx-xxxxx xxxx. Xxxxxx Xxxx xxxx xxxx xxxxxxxxx xx xxxxxx xxx xxxxxx xxxxxx xxx xx xxxxx xxx xxx-xxxx xxxxxx xx xxx xxxxxx xxxxxxx xxxxx.

```cpp
// Get the complete WAVEFORMAT from the Media Type.
DX::ThrowIfFailed(
    m_reader->GetCurrentMediaType(MF_SOURCE_READER_FIRST_AUDIO_STREAM, &outputMediaType)
    );

uint32 formatSize = 0;
WAVEFORMATEX* waveFormat;
DX::ThrowIfFailed(
    MFCreateWaveFormatExFromMFMediaType(outputMediaType.Get(), &waveFormat, &formatSize)
    );
CopyMemory(&m_waveFormat, waveFormat, sizeof(m_waveFormat));
CoTaskMemFree(waveFormat);
```

> **Xxxxxxxxx**   Xxx [**XXXxxxxxXxxxXxxxxxXxXxxxXXXxxxxXxxx**](https://msdn.microsoft.com/library/windows/desktop/ms702177) xxxxxxxx xxxx **XxXxxxXxxXxxxx** xx xxxxxxxx xxx [**XXXXXXXXXXXX**](https://msdn.microsoft.com/library/windows/hardware/ff538799) xxxxxx. Xxxxxxxxx, xxxx xxxx xxxx xxx xxxx **XxXxxxXxxXxxx** xxxx xxx xxx xxxxxxxx xxxxx xxxx xxxxxx.

 

Xxx **XxxxxXxxxxxxx::Xxxxxxxxxx** xxxxxx xxxxxxxx xx xxxxxxxxx xxx xxxxxx xx xxx xxxxxx, x\_*xxxXxxxxxXxxxxxXxXxxxx*, xx xxxxx. Xx xx xx, xx xxxxx xxx [**XXXXxxxxxXxxxxx::XXXXxxxxxXxxxxx::XxxXxxxxxxxxxxxXxxxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/dd374662) xxxxxx xx xxx xxx xxxxxxxx xx xxx xxxxx xxxxxx xx YYY-xxxxxxxxxx xxxxx, xxxxxxxx xxx xxxxxxxx xx xxxxxxxx, xxx xxxx xxxxxxxxxx xx xxx xxxxxxx xxxx xxxxxxxx xxxx xx xxxxx xxx xxxxxx. Xxxxxx Xxxx xxxxx xxxx xxxx xxxxx xx xxxxxxxx xxx xxxxxx xxxx xxxxx xxxx xxxx xxxx xxxxx.

```cpp
// Get the total length of the stream, in bytes.
PROPVARIANT var;
DX::ThrowIfFailed(
    m_reader->GetPresentationAttribute(MF_SOURCE_READER_MEDIASOURCE, MF_PD_DURATION, &var)
    );
LONGLONG duration = var.uhVal.QuadPart;
// The duration is in 100ns units; convert the value to seconds. 
double durationInSeconds = (duration / static_cast<double>(10000000)); 
m_maxStreamLengthInBytes = 
    static_cast<unsigned int>(durationInSeconds * m_waveFormat.nAvgBytesPerSec);

// Round up the buffer size to the nearest four bytes.
m_maxStreamLengthInBytes = (m_maxStreamLengthInBytes + 3) / 4 * 4;
```

### Xxxxxxxx xxx xxxxxx xxxxxx

Xxxxxx Xxxx xxxxxxx XXxxxxY xxxxxx xxxxxx xx xxxx xxxx xx xxx xxxx xxxxxx xxx xxxxx xx xxxxxx xxxxxx. Xxx **Xxxxx** xxxxx xxxxxxx xx [**XXXxxxxYXxxxxxXxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee415914) xxxxxx xxx xxx xxxxxxxxxx xxxxx xxx xx xxxxx xx **XxxxxXxxxxxXxxx** xxxxxxx xx xxxx xxx xxxx xxxx xxxxxx. Xxx **XxxxxXxxxxxXxxx** xxxxxxxxx xxxxx xxx **XXXxxxxYXxxxxxXxxxx** xxxxxx xxx xx xxxxxx xxx xxxx xxxxxxx xxxxx xxxxxx-xxxxxxx xxxx, xxxx xx xxx xxxxx xxxxxx. Xxxxx.x xxxxxxx xxx **XxxxxXxxxx** xxxxxxxxxxx. Xxxxxx Xxxx xxxx xxxx xxxxxxxxxxx xx xxxxxxxx xxxx xxxx xxxx xxxxx. Xxx Xxxxx xxxxx xxxx xxxx xxxx xxxxxxxxxxx xx xxxxx xxx xxxxx xx **XxxxxXxxxxxXxxx** xxxxxxx.

```cpp
enum SoundEvent
{
    RollingEvent        = 0,
    FallingEvent        = 1,
    CollisionEvent      = 2,
    CheckpointEvent     = 3,
    MenuChangeEvent     = 4,
    MenuSelectedEvent   = 5,
    LastSoundEvent,
};
```

Xxx xxxxxxxxx xxxxx xxxxx xxx xxxxxxxxxxxx xxxxxxx xxxx xx xxxxx xxxxxx, xxx xxxx xxxx xxxxxxxx xxx xxxxxxxxxx xxxxx xxxx, xxx x xxxxx xxxxxxxxxxx xx xxxx xxxx xxxxx xxxxxxxxxx. Xxx xxxxx xxxxx xxx xxxxxxx xx xxx \\Xxxxx\\Xxxxx xxxxxx.

| XxxxxXxxxx xxxxx  | Xxxx xxxx      | Xxxxxxxxxxx                                              |
|-------------------|----------------|----------------------------------------------------------|
| XxxxxxxXxxxx      | XxxxxxXxxx.xxx | Xxxxxx xx xxx xxxxxx xxxxx.                              |
| XxxxxxxXxxxx      | XxxxxxXxxx.xxx | Xxxxxx xxxx xxx xxxxxx xxxxx xxx xxx xxxx.               |
| XxxxxxxxxXxxxx    | XxxxxxXxx.xxx  | Xxxxxx xxxx xxx xxxxxx xxxxxxxx xxxx xxx xxxx.           |
| XxxxxxxxxxXxxxx   | Xxxxxxxxxx.xxx | Xxxxxx xxxx xxx xxxxxx xxxxxx xxxx x xxxxxxxxxx.         |
| XxxxXxxxxxXxxxx   | XxxxXxxxxx.xxx | Xxxxxx xxxx xxx xxxx xxxx xxxxxxx xxx xxxxxxx xxxx xxxx. |
| XxxxXxxxxxxxXxxxx | XxxxXxxxxx.xxx | Xxxxxx xxxx xxx xxxx xxxx xxxxxxx x xxxx xxxx.           |

 

Xxx xxxxxxxxx xxxxxxx xxxxx xxx xxx **Xxxxx::XxxxxxXxxxxxxxx** xxxxxx xxxxxxx xxx xxxxxx xxxxx xxx xxx xxxxxxxxxx xxxxx. Xxx [**XXXxxxxY::XxxxxxXxxxxxXxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee418607) xxxxxx xxxxxxx xxx xxxxxxxxxx x xxxxxx xxxxx. Xx xxxxx x [**XXXXXXXXXXXX**](https://msdn.microsoft.com/library/windows/hardware/ff538799) xxxxxxxxx xxxx xxxxxxx xxx xxxxxx xx xxx xxxxx xxxxxxx xxxx xxx xxxx xx xxx xxxxx. Xx xxxxxxxxx xxxxxxxxxx, Xxxxxx Xxxx xxxx xxx XXX xxxxxx. Xxx [**XXXXXXY\_XXXX\_XXXXXXXXXX**](https://msdn.microsoft.com/library/windows/desktop/ee419244) xxxxxxxxx xxxxxxx xxx xxxxxx xxxxxxxxxxx xxxxx xxxx xxxxxxx xxxxx xxx xxxxxxxxx xxxxxxx x xxxxxx xxxxxx xx xxxx. Xxxxxx Xxxx xxxxx xxx **Xxxxx::XxxXxxxxXxxxxxXxxxxx** xxxxxxxx xx xxx xxx xxxxxxx xx xxxxxx xxx xxxxx xx xxx xxxx xx xx xxxxx. Xxx [**XXXXXXY\_XXXXX\_XXXXX**](https://msdn.microsoft.com/library/windows/desktop/ee419246) xxxxxxxxx xxxxxxx xxx xxx xx xxxxxx xx xxxxxxx xxxx xxxx x xxxxxx xxxxxx xxxxx. Xxxxxx Xxxx xxxxx xxxx xxxx xxx xxxxxx xxxxx xx xxx xxxxxxxxx xxxxx (xxx xxx xxx, xx xxxxxxxxx, xxxxxxx xx x xxxxxxx xxxxx) xxx xx xxx xxx xxxxxx xxxxxx xxxx xxxxxxxxx xxx xxx, xx xxxxxxxxxxx, xxxxxxx xx x xxxxxxx xxxxx.

```cpp
XAUDIO2_SEND_DESCRIPTOR descriptors[3];
descriptors[0].pOutputVoice = m_soundEffectMasteringVoice;
descriptors[0].Flags = 0;
descriptors[1].pOutputVoice = m_soundEffectReverbVoiceSmallRoom;
descriptors[1].Flags = 0;
descriptors[2].pOutputVoice = m_soundEffectReverbVoiceLargeRoom;
descriptors[2].Flags = 0;
XAUDIO2_VOICE_SENDS sends = {0};
sends.SendCount = 3;
sends.pSends = descriptors;

// The rolling sound can have pitch shifting and a low-pass filter. 
if (sound == RollingEvent)
{
    DX::ThrowIfFailed(
        m_soundEffectEngine->CreateSourceVoice(
            &m_soundEffects[sound].m_soundEffectSourceVoice,
            &(soundEffectStream.GetOutputWaveFormatEx()),
            XAUDIO2_VOICE_USEFILTER,
            2.0f,
            &m_voiceContext,
            &sends)
        );
}
else
{
    DX::ThrowIfFailed(
        m_soundEffectEngine->CreateSourceVoice(
            &m_soundEffects[sound].m_soundEffectSourceVoice,
            &(soundEffectStream.GetOutputWaveFormatEx()),
            0,
            1.0f,
            &m_voiceContext,
            &sends)
        );
}
```

## Xxxxxxx xxxxxxxxxx xxxxx


X xxxxxx xxxxx xx xxxxxxx xx xxx xxxxxxx xxxxx. Xxxxxx Xxxx xxxxxx xxx xxxxxxxxxx xxxxx xx xxx xxxx xxxx. Xxx xxxxx xxxx xx **XxxxxxXxxx::Xxxxxx** xxxxx **Xxxxx::Xxxxx** xx xxxxx xxx xxxxxxxxxx xxxxx.

```cpp
if (!m_audio.m_isAudioStarted)
{
    m_audio.Start();
}
```

Xxx **Xxxxx::Xxxxx** xxxxxx xxxxx [**XXXxxxxYXxxxxxXxxxx::Xxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee418471) xx xxxxx xx xxxxxxx xxx xxxxxx xxxxx xxx xxx xxxxxxxxxx xxxxx.

```cpp
void Audio::Start()
{     
    if (m_engineExperiencedCriticalError)
    {
        return;
    }

    HRESULT hr = m_musicSourceVoice->Start(0);

    if SUCCEEDED(hr) {
        m_isAudioStarted = true;
    }
    else
    {
        m_engineExperiencedCriticalError = true;
    }
}
```

Xxx xxxxxx xxxxx xxxxxx xxxx xxxxx xxxx xx xxx xxxx xxxxx xx xxx xxxxx xxxxx. Xx xxx xxxx xx Xxxxxx Xxxx, xxx xxxx xxxxx xxxxxxxx xxx xxxxxx xxxxxx xxxx xxxxx xxx xxx xxxxxx xxxxxxx xx xxx xxxxx. Xxx xxxxxx xxxxx xxxxxxx x xxxxx xxxx-xxxxx xxxxxx; xxx xxxxxx xxxxxxx x xxx xxxx-xxxxx xxxxxx. Xxx xxxxxx xxxx xxxx xxxxxx xxxxx xxxxxxxxxxx xx xxx xxxxx xxx xx xxxxxxxxxx xx xxx xxxx xxx xxxxx xx xxx xxxx. Xxx xxxx-xxxxx xxxxxx xxxxxxxxxxx xxxx xxxx xxx xxxx xx xxxx x xxxx xx xx x xxxxx xxxx, xxx xxx xxxx-xxxxx xxxxxx xxxxxxxxxxx xxxx xxxx xxx xxxx xx xx x xxxxx xxxxx. Xxxx xxxxxxxxx xxxxxxxx x xxxx xxxxxxxxx xxxx xxxxxx xx xxx xxxxxx xxxxx xxxxxxx xxx xxxx. Xx xxxxx xxxx xxxxx xxx Xxxxxx Xxxx xxxxxxxxxx xxxx xxxxxx, xxx **Xxxxx::XxxXxxxXxxx** xxx **Xxxxxxx::XxxxxxxxxXxxxxxxXxxxXxxx** xx xxx Xxxxxx Xxxx xxxxxx xxxx.

> **Xxxx**  Xx x xxxx xx xxxxx xxxx xxxx xxxxx xxx xxxxxxxxxx xxx xxxx, xxx xxx xxx x xxxx xxxxx xxxxxx xxxxx. Xxx xxxxxxx, xxx xxx xxx xxx xxxxxx xxxxxxx xxx xxx xxxxx xx xxx xxx xxxxxx x xxxxxxxxxx xxxxxx xxxxxxx xxx xxxx xxxx.

 

Xxx **Xxxxx::XxxxxxXxxxxxxxx** xxxxxx xxxx Xxxxx Xxxxxxxxxx xx xxxx xxx xxxxxxxxxx xxxxx. Xx xxxx xxxxx, xxxxxxx, xxx xxxxxx xxxxx xxxx xxx xxxx xxxxx xxxx xx xxxx xxxx. Xx xxxxxxxx, xxxxxxx xxx xxxxxxxxxx xxxxx xxxxx, xxx xxxxxx xxxxx xxxx xx xxxxxxxxx xxxxxxx xxxx xxxx xx xxxx xxx xxxxx xxxxxxxxx xx xxxx. Xx xxxx xxx xxxxxx xxxxx xxxxxx xxxx xxxx, xxx xxxx xxxx xxxxxxx xxx xxxxx xxxxxxx xxxxx xxxxx. Xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxx **Xxxxx::Xxxxxx** xx xxxxxxx xxx xxxxxxxxxx xxxxx xxxxx xxxxxx. Xxx **Xxxxx::Xxxxxx** xxxxxxx xx xxxxx xx xxxxx xxxxx xxxxxxx, **x\_xxxxxXxxxxxx**. Xxxx xxxxxx xxxxx YY XX (YYYYY xxxxx) xx xxxx. Xxx xxxx xxxxx xxxx xxxx xxx Xxxxx Xxxxxxxxxx xxxxxx xxx xxxxxx xxxx xxxx xx xxx xxxxxx xxxxx xxxxx xxx xxxxxx xxxxx xxx xxxxx xxxxxx xxxxxxx.

> **Xxxxxxx**  Xxxxxxxx Xxxxxx Xxxx xxxx x YY XX xxxxxx xx xxxx xxxxx xxxx, xxx xxx xxxx xx xxx x xxxxxx xx xxxxxxx xxxxxx. Xxxx xxxxxx xxxxxxx xx xxx xxxxxxxxxxxx xx xxxx xxxx.

 

```cpp
void Audio::Render()
{
    if (m_engineExperiencedCriticalError)
    {
        m_engineExperiencedCriticalError = false;
        ReleaseResources();
        Initialize();
        CreateResources();
        Start();
        if (m_engineExperiencedCriticalError)
        {
            return;
        }
    }

    try
    {
        bool streamComplete;
        XAUDIO2_VOICE_STATE state;
        uint32 bufferLength;
        XAUDIO2_BUFFER buf = {0};

        // Use MediaStreamer to stream the buffers.
        m_musicSourceVoice->GetState(&state);
        while (state.BuffersQueued <= MAX_BUFFER_COUNT - 1)
        {
            streamComplete = m_musicStreamer.GetNextBuffer(
                m_audioBuffers[m_currentBuffer], 
                STREAMING_BUFFER_SIZE, 
                &bufferLength
                );

            if (bufferLength > 0)
            {
                buf.AudioBytes = bufferLength;
                buf.pAudioData = m_audioBuffers[m_currentBuffer];
                buf.Flags = (streamComplete) ? XAUDIO2_END_OF_STREAM : 0;
                buf.pContext = 0;
                DX::ThrowIfFailed(
                    m_musicSourceVoice->SubmitSourceBuffer(&buf)
                    );

                m_currentBuffer++;
                m_currentBuffer %= MAX_BUFFER_COUNT;
            }

            if (streamComplete)
            {
                // Loop the stream.
                m_musicStreamer.Restart();
                break;
            }

            m_musicSourceVoice->GetState(&state);
        }
    }
    catch(...)
    {
        m_engineExperiencedCriticalError = true;
    }
}
```

Xxx xxxx xxxx xxxxxxx xxxx xxx Xxxxx Xxxxxxxxxx xxxxxx xxxxxxx xxx xxx xx xxx xxxxxx. Xx xxxx xxxx, xx xxxxx xxx [**XxxxxXxxxxxxx::XxXxxxxXxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ms697215) xxxxxx xx xxxxx xxx xxxxxxxx xx xxx xxxxx xxxxxx.

```cpp
void MediaStreamer::Restart()
{
    if (m_reader == nullptr)
    {
        return;
    }

    PROPVARIANT var = {0};
    var.vt = VT_I8;

    DX::ThrowIfFailed(
        m_reader->SetCurrentPosition(GUID_NULL, var)
        );
}
```

Xx xxxxxxxxx xxxxx xxxxxxx xxx x xxxxxx xxxxxx (xx xxx xx xxxxxx xxxxx xxxx xx xxxxx xxxxxx xxxx xxxxxx), xxx xxx xxx xxx **XxxxXxxxx** xxxxx xx **XXXXXXY\_XXXX\_XXXXXXXX** xxxx xxx xxxxxxxxxx xxx xxxxx. Xxxxxx Xxxx xxxx xxxx xxxxxxxxx xx xxxx xxx xxxxxxx xxxxx xxx xxx xxxxxx.

```cpp
if(sound == RollingEvent)
{
    m_soundEffects[sound].m_audioBuffer.LoopCount = XAUDIO2_LOOP_INFINITE;
}
```

Xxxxxxx, xxx xxx xxxxxxxxxx xxxxx, Xxxxxx Xxxx xxxxxxx xxx xxxxxxx xxxxxxxx xx xxxx xx xxx xxxxxx xxxxxxx xxx xxxxxx xx xxxxxx xxxx xx xxxx. Xxxx xxxx xxxxx xxxxx xxx xxxxx, xxx xxx xxxxxx xxx xxxxx xxxx xxxx xxxxxxx xxxxxxx. Xxxxx xx xxx xxxx xxxxxxx xxxxxx xxxx xxxx xxx xxxxxxxxx xx xxx xxxxâ€™x xxxxxxx xx xxxxxxx xxx xxxxxx xxxxx xxxx.

> **Xxx**  Xx xxxx xxxx xxx x xxx xx xxxxxxx xxxxx xxxx, xxxxxxxxxx xxxxx xx xxx xxxx xxxxxx xxx xxxxxxx xxxxxxxxxx xxxxxx xx xxxx xx xxx xxxxx xxxxxxx xxx xxxxx xxxxxx xxx xxxxxxxxxxxx xxxxxxxx xxxxx xxxx xx xxxx xxxx. Xx xxxx xxxx xx xxxxxxxxx xx xxxx xxxxx, xxxxxxxx xxxxxxxxxx xxxxx xx x xxxxxxxx xxxxxx xxxx xxxx xxx xxxxxxx xxxxxxxxx. Xxxx xxxxxxxx xx xxxxxxxxxx xxxxxx xx xxxxxxxxx xxxx xxxx xxxxxxxx xxxxxxxxxx xxxxxxx xxxx xxxx xxx xxx xxxx xxxxxxxxxx.

 

##  Xxxxxxxx xx xxxx xxxxxx


Xxx **XxxxxxXxxx** xxxxx xxxxxxxx xxxxxxx xxxx xx **XxxxXxxxxXxxxxx**, **XxXxxxxXxxxxxXxxxxxx**, **XxxxXxxxxXxxxxx**, **XxxXxxxxXxxxxxXxxxxx**, **XxxXxxxxXxxxxxXxxxx**, xxx **XxxXxxxxXxxxxxXxxxxx** xx xxxxxx xxx xxxx xx xxxxxxx xxxx xxxxxx xxxx xxx xxxx, xxx xx xxxxxxx xxxxx xxxxxxxxxx xxxx xx xxxxxx xxx xxxxx. Xxx xxxxxxx, xx xxx xxxxxx xxxxx xxx xxx xxxx, **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxx xxx **Xxxxx::XxxxXxxxxXxxxxx** xxxxxx xx xxxx xxx **XxxxxxxXxxxx** xxxxx.

```cpp
m_audio.PlaySoundEffect(FallingEvent);
```

Xxx **Xxxxx::XxxxXxxxxXxxxxx** xxxxxx xxxxx xxx [**XXXxxxxYXxxxxxXxxxx::Xxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee418471) xxxxxx xx xxxxx xxxxxxxx xx xxx xxxxx. Xx xxx **XXXxxxxYXxxxxxXxxxx::Xxxxx** xxxxxx xxx xxxxxxx xxxx xxxxxx, xx xx xxx xxxxxxx xxxxx. **Xxxxx::XxxxXxxxxXxxxxx** xxxx xxxxxxxx xxxxxx xxxxx xxx xxxxxxx xxxxxx.

```cpp
void Audio::PlaySoundEffect(SoundEvent sound)
{
    XAUDIO2_BUFFER buf = {0};
    XAUDIO2_VOICE_STATE state = {0};

    if (m_engineExperiencedCriticalError) {
        // If there's an error, then we'll recreate the engine on the next  
        // render pass. 
        return;
    }

    SoundEffectData* soundEffect = &m_soundEffects[sound];
    HRESULT hr = soundEffect->m_soundEffectSourceVoice->Start();
    if FAILED(hr)
    {
        m_engineExperiencedCriticalError = true;
        return;
    }

    // For one-off voices, submit a new buffer if there's none queued up, 
    // and allow up to two collisions to be queued up. 
    if(sound != RollingEvent)
    {
        XAUDIO2_VOICE_STATE state = {0};
        soundEffect->m_soundEffectSourceVoice->GetState(&state, XAUDIO2_VOICE_NOSAMPLESPLAYED);
        if (state.BuffersQueued == 0)
        {
            soundEffect->m_soundEffectSourceVoice->SubmitSourceBuffer(&soundEffect->m_audioBuffer);
        }
        else if (state.BuffersQueued < 2 && sound == CollisionEvent)
        {
            soundEffect->m_soundEffectSourceVoice->SubmitSourceBuffer(&soundEffect->m_audioBuffer);
        }

        // For the menu clicks, we want to stop the voice and replay the click right away. 
        // Note that stopping and then flushing could cause a glitch due to the 
        // waveform not being at a zero-crossing, but due to the nature of the sound  
        // (fast and 'clicky'), we don't mind. 
        if (state.BuffersQueued > 0 && sound == MenuChangeEvent)
        {
            soundEffect->m_soundEffectSourceVoice->Stop();
            soundEffect->m_soundEffectSourceVoice->FlushSourceBuffers();
            soundEffect->m_soundEffectSourceVoice->SubmitSourceBuffer(&soundEffect->m_audioBuffer);
            soundEffect->m_soundEffectSourceVoice->Start();
        }
    }

    m_soundEffects[sound].m_soundEffectStarted = true;
}
```

Xxx xxxxxx xxxxx xxxx xxxxxxx, xxx **Xxxxx::XxxxXxxxxXxxxxx** xxxxxx xxxxx [**XXXxxxxYXxxxxxXxxxx::XxxXxxxx**](https://msdn.microsoft.com/library/windows/desktop/hh405047) xx xxxxxxxxx xxx xxxxxx xx xxxxxxx xxxx xxx xxxxxx xxxxx xx xxxxxxx. Xx xxxxx [**XXXxxxxYXxxxxxXxxxx::XxxxxxXxxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee418473) xx xxx xxx xxxxx xxxx xxx xxx xxxxx xx xxx xxxxxâ€™x xxxxx xxxxx xx xx xxxxxxx xxx xxxxxx. Xxx **Xxxxx::XxxxXxxxxXxxxxx** xxxxxx xxxx xxxxxxx xxx xxxxxxxxx xxxxx xx xx xxxxxx xxx xxxxx xx xxxxxxxx. Xxxx xxxxxx, xxx xxxxxxx, xxxx xxx xxxxxx xxxxxxxx xxxx x xxxxxx xx xxx xxxx.

Xx xxxxxxx xxxxxxxxx, xxx Xxxxx xxxxx xxxx xxx **XXXXXXY\_XXXX\_XXXXXXXX** xxxx xxxx xx xxxxxxxxxxx xxx xxxxx xxx xxx xxxxxxx xxxxx. Xxx xxxxx xxxxxx xxxxxx xxxxxxxx xxx xxxxx xxxx xxxx **Xxxxx::XxxxXxxxxXxxxxx** xx xxxxxx xxx xxxx xxxxx. Xx xxxxxxxx xxx xxxxxxxx xxxxx xxx xxx xxxxxxx xxxxx, Xxxxxx Xxxx xxxxx xxx xxxxx xxxxxxx xx xxxxxxxx xx. Xx xxx xxxxxx xxxxxxx xxxxxxxx, Xxxxxx Xxxx xxxxxxx xxx xxxxx xxx xxxxxx xx xxx xxxxx xx xxxx xx x xxxx xxxxxxxxx xxxxxx. Xxx xxxxxxxxx xxxxx xxx xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxxxxx xxx xxxxx xxx xxxxxx xx xxx xxxxxx xx xxx xxxxxxxx xxxxxxx xxx xxx xx xxxxx xxx xxxxx xx xxxxxxx xxx xxxxxx xx xxxx xxxx xxx xxxxxx xxxxx.

```cpp
// Play the roll sound only if the marble is actually rolling. 
if (ci.isRollingOnFloor && volume > 0)
{
    if (!m_audio.IsSoundEffectStarted(RollingEvent))
    {
        m_audio.PlaySoundEffect(RollingEvent);
    }

    // Update the volume and pitch by the velocity.
    m_audio.SetSoundEffectVolume(RollingEvent, volume);
    m_audio.SetSoundEffectPitch(RollingEvent, pitch);

    // The rolling sound has at most 8000Hz sounds, so we linearly  
    // ramp up the low-pass filter the faster we go. 
    // We also reduce the Q-value of the filter, starting with a  
    // relatively broad cutoff and get progressively tighter.
    m_audio.SetSoundEffectFilter(
        RollingEvent, 
        600.0f + 8000.0f * volume,
        XAUDIO2_MAX_FILTER_ONEOVERQ - volume*volume
        );
}
else
{
    m_audio.SetSoundEffectVolume(RollingEvent, 0);
}
```

## Xxxxxxxx xx xxxxxxx xxx xxxxxx xxxxxx


Xxx xxxxxxxx Xxxxxx Xxxx xxxxxxxxxxx xxxxxxxxx xxxxxxxxx xxx Xxxxxx Xxxx xxxxxxxx xxxxxxx xxx xxxxxx. Xxxx xxx xxxx xx xxxxxxxxx, xxx xxxx xxxxxx xxx xxxxx. Xxxx xxx xxxx xxxxxxx, xxx xxxx xxxxxxx xxx xxxxx xxxxx xx xxxx xxx. Xx xx xx xx xxxxxx xxx xxxx xxxxxxxx xx xxx xxxxx xxxxxxxxx xxxx xxx xxxx xxxxâ€™xx xxx xxxxxx.

Xxx **Xxxxx::XxxxxxxXxxxx** xxxxxx xx xxxxxx xxxx xxx xxxx xx xxxxxxxxx. Xxxx xxxxxx xxxxx xxx [**XXXxxxxY::XxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee418628) xxxxxx xx xxxx xxx xxxxx. Xxxxxxxx **XXXxxxxY::XxxxXxxxxx** xxxxx xxx xxxxx xxxxxx xxxxxxxxxxx, xx xxxxxxxxx xxx xxxxx xxxxx xxx xxx xxxxxx xxxxxxxxxx (xxx xxxxxxx, xxx xxxxxx xxxxxx xxxxâ€™x xxxxxxx xxxx xxx xxxxxx xxxxxxx).

```cpp
// Uses the IXAudio2::StopEngine method to stop all audio immediately.  
// It leaves the audio graph untouched, which preserves all effect parameters   
// and effect histories (like reverb effects) voice states, pending buffers,  
// cursor positions and so on. 
// When the engines are restarted, the resulting audio will sound as if it had  
// never been stopped except for the period of silence. 
void Audio::SuspendAudio()
{
    if (m_engineExperiencedCriticalError)
    {
        return;
    }

    if (m_isAudioStarted)
    {
        m_musicEngine->StopEngine();
        m_soundEffectEngine->StopEngine();
    }
    m_isAudioStarted = false;
}
```

Xxx **Xxxxx::XxxxxxXxxxx** xxxxxx xx xxxxxx xxxx xxx xxxx xx xxxxxxx. Xxxx xxxxxx xxxx xxx [**XXXxxxxY::XxxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee418626) xxxxxx xx xxxxxxx xxx xxxxx. Xxxxxxx xxx xxxx xx [**XXXxxxxY::XxxxXxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee418628) xxxxxxxxx xxx xxxxx xxxxx xxx xxx xxxxxx xxxxxxxxxx, xxx xxxxx xxxxxx xxxxxxx xxxxx xx xxxx xxx.

```cpp
// Restarts the audio streams. A call to this method must match a previous call  
// to SuspendAudio. This method causes audio to continue where it left off. 
// If there is a problem with the restart, the m_engineExperiencedCriticalError  
// flag is set. The next call to Render will recreate all the resources and  
// reset the audio pipeline. 
void Audio::ResumeAudio()
{
    if (m_engineExperiencedCriticalError)
    {
        return;
    }

    HRESULT hr = m_musicEngine->StartEngine();
    HRESULT hr2 = m_soundEffectEngine->StartEngine();

    if (FAILED(hr) || FAILED(hr2))
    {
        m_engineExperiencedCriticalError = true;
    }
}
```

## Xxxxxxxx xxxxxxxxxx xxx xxxxxx xxxxxxx


Xxxxxx xxxx xxxx xxxxxx xxxxxxxxx xx xxxxxx XXxxxxY xxxxxx xxxxxxxx, xxxx xx xxxx xxx xxxxx xxxxxx xxxxxxx. X xxxxxx xxxxx xx x xxxxxx xxxxxx xx xxxx xxx xxxx xxxx xxxxxxxx xx xxxxxxxxxxx xxx xxxxxxxxxx. Xx xxxxxxxxx xxxx xxx xxxxxxxxx xxx xxxxxx xxxxxxxx xxxx xxxxxxx xxxxxx xxxxxxx. Xxxxxxxxx, xxxx xxxx xxxx xxxx xxxxxxx xxxxx xxxx xxx xxxx xxxxx xx xx xxxxxxx xxxxxxxxxx, xxxxx xxx xxxx xx xxxxxxxxx.

Xxxxx.x xxxxxxx xxx **XxxxxXxxxxxXxxxxxxxx** xxxxx. Xxxx xxxxx xxxxxxxxxx xxx [**XXXxxxxYXxxxxxXxxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee415910) xxxxxxxxx.

```cpp
class AudioEngineCallbacks: public IXAudio2EngineCallback
{
private: 
    Audio* m_audio;

public :
    AudioEngineCallbacks(){};
    void Initialize(Audio* audio);

    // Called by XAudio2 just before an audio processing pass begins.
    void _stdcall OnProcessingPassStart(){};

    // Called just after an audio processing pass ends.
    void  _stdcall OnProcessingPassEnd(){};

    // Called when a critical system error causes XAudio2
    // to be closed and restarted. The error code is given in Error.
    void  _stdcall OnCriticalError(HRESULT Error);
};
```

Xxx [**XXXxxxxYXxxxxxXxxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee415910) xxxxxxxxx xxxxxxx xxxx xxxx xx xx xxxxxxxx xxxx xxxxx xxxxxxxxxx xxxxxx xxxxx xxx xxxx xxx xxxxxx xxxxxxxxxx x xxxxxxxx xxxxx. Xx xxxxxxxx xxx xxxxxxxxx, Xxxxxx Xxxx xxxxx xxx [**XXXxxxxY::XxxxxxxxXxxXxxxxxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee418620) xxxxxx xxxxx xx xxxxxxx xxx [**XXXxxxxY**](https://msdn.microsoft.com/library/windows/desktop/ee415908) xxxxxx xxx xxx xxxxx xxxxxx.

```cpp
m_musicEngineCallback.Initialize(this);
m_musicEngine->RegisterForCallbacks(&m_musicEngineCallback);
```

Xxxxxx Xxxx xxxx xxx xxxxxxx xxxxxxxxxxxx xxxx xxxxx xxxxxxxxxx xxxxxx xx xxxx. Xxxxxxxxx, xx xxxxxxxxxx xxx [**XXXxxxxYXxxxxxXxxxxxxx::XxXxxxxxxxxxXxxxXxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee418463) xxx [**XXXxxxxYXxxxxxXxxxxxxx::XxXxxxxxxxxxXxxxXxx**](https://msdn.microsoft.com/library/windows/desktop/ee418462) xxxxxxx xx xx xxxxxxx. Xxx xxx [**XXXxxxxYXxxxxxXxxxxxxx::XxXxxxxxxxXxxxx**](https://msdn.microsoft.com/library/windows/desktop/ee418461) xxxxxx, Xxxxxx Xxxx xxxxx xxx **XxxXxxxxxXxxxxxxxxxxXxxxxxxxXxxxx** xxxxxx, xxxxx xxxx xxx **x\_xxxxxxXxxxxxxxxxxXxxxxxxxXxxxx** xxxx.

```cpp
// Called when a critical system error causes XAudio2 
// to be closed and restarted. The error code is given in Error. 
void  _stdcall AudioEngineCallbacks::OnCriticalError(HRESULT Error)
{
    m_audio->SetEngineExperiencedCriticalError();
}
```

```cpp
// This flag can be used to tell when the audio system 
// is experiencing critial errors.
// XAudio2 gives a critical error when the user unplugs
// the headphones and a new speaker configuration is generated.
void SetEngineExperiencedCriticalError()
{
    m_engineExperiencedCriticalError = true;
}
```

Xxxx x xxxxxxxx xxxxx xxxxxx, xxxxx xxxxxxxxxx xxxxx xxx xxx xxxxxxxxxx xxxxx xx XXxxxxY xxxx. Xx xxxxxxx xxxx xxxx xxxxxxxxx, xxx xxxx xxxxxxx xxx XXxxxxY xxxxxxxx xxx xxxxxx x xxx xxx. Xxx **Xxxxx::Xxxxxx** xxxxxx, xxxxx xx xxxxxx xxxx xxx xxxx xxxx xxxxx xxxxx, xxxxx xxxxxx xxx **x\_xxxxxxXxxxxxxxxxxXxxxxxxxXxxxx** xxxx. Xx xxxx xxxx xx xxx, xx xxxxxx xxx xxxx, xxxxxxxx xxx xxxxxxx XXxxxxY xxxxxxxx, xxxxxxxxxxx xxxxxxxxx, xxx xxxx xxxxxx xxx xxxxxxxxxx xxxxx.

```cpp
if (m_engineExperiencedCriticalError)
{
    m_engineExperiencedCriticalError = false;
    ReleaseResources();
    Initialize();
    CreateResources();
    Start();
    if (m_engineExperiencedCriticalError)
    {
        return;
    }
}
```

Xxxxxx Xxxx xxxx xxxx xxx **x\_xxxxxxXxxxxxxxxxxXxxxxxxxXxxxx** xxxx xx xxxxx xxxxxxx xxxxxxx xxxx XXxxxxY xxxx xx xxxxx xxxxxx xx xxxxxxxxx. Xxx xxxxxxx, xxx **XxxxxxXxxx::Xxxxxx** xxxxxx xxxx xxx xxxxxxx xxxxx xxx xxxxxxx xx xxxxxxxxx xxxxxx xxxx xxxx xxxx xx xxx. Xxx xxx xxxxxxxx xx xxxxxx xxx xxxxx xxxxxx xxxxx xxxxx xx xx xx xxxxxxxx; xxxxxxx, xxx **x\_xxxxxxXxxxxxxxxxxXxxxxxxxXxxxx** xxxx xxxxx xxxxxx xx xxx xx xxx xxxxxxxx xxxx xxx xxxx xx xxxxx xxxxxx xx xxx xxxxxxxxxx xxx xxxxxxxxx xxx xxxxx xx xx xxxxx xxxxxxxxx xxxxx xxxxxx.

> **Xxxxxxx**   Xx x xxxx, xx xxx xxxxxxx xxxxxxxx xxxxxxxxxx xx xxx xxxx xx xx xxxxxx xxxxxxxx. Xxxxx xx xxx xxxxx xxxxxxxxxxx xxxxxx. Xxxxxx Xxxx xxxx x xxxx xx xxx **XxXxxxxxxxXxxxx** xxxxxxxx xxx xxxxx xxxxxxx xxx xxxxx xxxxxx xxx xxxxxxx xxxxx xxxxxxxxxx xxxxx. Xxx xxxx xxxxxxxxxxx xxxxx XXxxxxY xxxxxxxxx, xxx [XXxxxxY Xxxxxxxxx](https://msdn.microsoft.com/library/windows/desktop/ee415745).

 

## Xxxxxxx xxxxxx


* [Xxxxxx xxxxx xxx xxxxxxxxxxxxx xx xxx Xxxxxx Xxxx xxxxxx](adding-input-and-interactivity-to-the-marble-maze-sample.md)
* [Xxxxxxxxxx Xxxxxx Xxxx, x XXX xxxx xx X++ xxx XxxxxxX](developing-marble-maze-a-windows-store-game-in-cpp-and-directx.md)

 

 




<!--HONumber=Mar16_HO1-->
