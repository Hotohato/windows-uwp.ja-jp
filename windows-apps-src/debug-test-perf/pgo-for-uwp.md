---
title: ユニバーサル Windows プラットフォーム (UWP) アプリにおけるガイド付き最適化のプロファイル (PGO) の実行
description: ユニバーサル Windows プラットフォーム (UWP) アプリをプロファイル ガイド付き最適化 (PGO) を適用するステップ バイ ステップ ガイドです。
ms.date: 02/08/2017
ms.localizationpriority: medium
ms.topic: article
ms.openlocfilehash: 8c19ea1701c6b5e82e66a54223620dace57de4b6
ms.sourcegitcommit: b034650b684a767274d5d88746faeea373c8e34f
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2019
ms.locfileid: "57632917"
---
# <a name="running-profile-guided-optimization-on-universal-windows-platform-apps"></a>ユニバーサル Windows プラットフォーム アプリにおけるガイド付き最適化のプロファイルの実行 
 
このトピックでは、ユニバーサル Windows プラットフォーム (UWP) アプリに対してガイド付き最適化のプロファイル (PGO) を適用するための手順を説明します。 従来の win32 アプリケーションで利用可能な手順の一部は UWP アプリでは利用できません。そのため、UWP 開発者にとって最適化がより簡単かつ利用しやすくなるよう、PGO を組み込むために必要な方法を説明することを目標としています。

Visual Studio 2015 Update 3 を使用して既定の DirectX 11 アプリ (UWP) テンプレートに PGO を適用する方法の基本的なチュートリアルを次に示します。
 
このガイド全体でスクリーン ショットは、次の新しいプロジェクトに基づいています。![新しいプロジェクト ダイアログ ボックス](images/pgo-001.png)

PGO を DirectX 11 アプリ テンプレートに適用するには、次の手順に従います。

1. ソリューションの構成を **[Release]** に設定するか、リリース目的の最適化されたコードを生成するソリューションの構成を選択します。 論理的には、デバッグ ビルドに対して PGO を実行することもできますが、他の最適化されないビルドを最適化するために PGO を使用するのは有効ではありません。 
 
 ![[App1] ウィンドウ](images/pgo-002.png)
 
2. プロジェクトのプロパティ (**[プロパティ]** > **[C/C++]** > **[最適化]**) で、**[プログラム全体の最適化]** に /GL フラグを設定してビルドしていることを確認します (これは構成によって既に設定されている可能性があります)。

 ![プログラム全体の最適化](images/pgo-003.png)

3. リンカーのプロパティ (**[プロパティ]** > **[リンカー]** > **[最適化]**) に移動し、**[リンク時のコード生成]** を **[ガイド付き最適化のプロファイル - インストルメント (LTCG:PGInstrument)]** に設定します。
 
 ![リンク時のコード生成](images/pgo-004.png)

4. **[ソリューションのビルド]** をクリックした後、**[ソリューションの配置]** をクリックします。 

 ![[新しいプロジェクト] ダイアログ ボックス](images/pgo-005.png)
 
 ビルドの出力場所を見て、.pgd ファイルが生成されていることを確認することで、すべてが適切に動作していることを再確認できます。 この例の場合、ビルドの出力と一緒に次のファイルが生成されていることを意味しました。
 
 `C:\Users\<USER>\Documents\Visual Studio 2015\Projects\App1\Release\App1\App1.pgd`

 既定では、.pgd ファイルは実行可能ファイルと同じ名前です。 **[ガイド付きデータベースのプロファイル]** リンカー オプションを変更することで、生成される .pgd ファイルの名前を変更することもできます。 
 
5. Visual Studio VC バイナリ ディレクトリに移動します (既定では `C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\bin` のようになります)。 x86 実行可能ファイルの場合、`pgort140.dll` をコピーします。x64 実行可能ファイルの場合、`amd64\pgort140.dll` から x64 バージョンをコピーします。 `pgort140.dll` の適切なバージョンを、配置したパッケージのルートに貼りつけます。 このサンプルのパスは次のとおりです。

 `C:\Users\<USER>\Documents\Visual Studio 2015\Projects\App1\Release\App1\AppX\`

 UWP アプリでは、パッケージ内に存在するライブラリしか読み込むことができないため、この手順は必須です。

 ![[新しいプロジェクト] ダイアログ ボックス](images/pgo-006.png)
 
6. [スタート] メニューから、または Visual Studio の **[デバッグ]** メニューから **[デバッグなしで開始]** オプションを使用してアプリを実行します。 

 ![[新しいプロジェクト] ダイアログ ボックス](images/pgo-007.png)
 
7. 現在実行しているビルドがインストルメント化され、PGO データが生成されます。 この時点で、最適化する予定の最も一般的なシナリオを通じてアプリケーションを実行する必要があります。 目的のシナリオすべてでプログラムの実行を終えたら、pgosweep.exe ツールを探します。これは、適切なバージョンの `pgort140.dll` と同じフォルダーに含まれます。 または、Visual Studio (x86/x64) Native Tools コマンド プロンプトに、既にそのパスの適切なバージョンが設定されています。 PGOデータを収集するには、アプリケーションの実行中に次のコマンドを実行し、プロファイリング データを含む .pgc ファイルを生成します。
 
  `pgosweep.exe <executable name> <output file>` 
 
  PGO データの収集方法を制御する他のオプションの引数を確認するために、pgosweep.exe のヘルプ (`pgosweep.exe /help`) を表示することもできます。
 
  .pgd が含まれるビルド場所に .pgc ファイルを出力し、ファイルに `<PGDName>!<RunIdentifier>.pgc` という名前を付けることもお勧めします。 この例では、次のようになります。
 
  ```
  pgosweep.exe App1.exe “C:\Users\<USER>\Documents\Visual Studio 2015\Projects\App1\Release\App1\App1!1.pgc”
  ```
 
  さらに収集可能性もあります`App1!CoreScenario.pgc`、`App1!UseCase5.pgc`など.Pgc ファイルの名前は、この方法でと、ビルド出力の場所、.pgd と共に、それらは自動的に統合されます手順 9. でリンクするときにします。
 
8. 省略可能。リンクと同様に、重み付け時に既定では、手順 7. で指定されていると、.pgd の横に配置されたという .pgc ファイルをすべてがマージする、大きくすることもできますが、特定の実行は重み付けを制御します。 これを行うには、**pgomgr.exe** ツールを使用します。このツールも、最初に `pgort140.dll` のコピーを見つけたフォルダーと同じフォルダーにあります。 たとえば、`CoreScenario` の実行を他の実行の優先度の 3 倍でマージするには、次のコマンドを使用します。
 
 ```
 pgomgr.exe -merge:3 “C:\Users\<USER>\Documents\Visual Studio 2015\Projects\App1\Release\App1\App1!CoreScenario.pgc” “C:\Users\<USER>\Documents\Visual Studio 2015\Projects\App1\Release\App1\App1.pgd”
 ```
 
9. 1 つ以上の .pgc ファイルを生成し、それを .pgd の隣に配置するか手動でマージ (手順 8) したら、リンカーを使用して最終的な最適化されたビルドを作成できます。 リンカーのプロパティ (**[プロパティ]** > **[リンカー]** > **[最適化]**) に戻り、**[リンク時のコード生成]** を **[ガイド付き最適化のプロファイル - 最適化 (LTCG:PGOptimize)]** に設定したら、**[ガイド付きデータベースのプロファイル]** が使用予定の .pgd をポイントしていることを確認します (これを変更していない場合、すべてを順序どおりにする必要があります)。

 ![[新しいプロジェクト] ダイアログ ボックス](images/pgo-009.png)
 
10. プロジェクトがビルドされたら、リンカーによって pgomgr.exe が呼び出され、すべての `<PGDName>!*.pgc` ファイルが既定の重み 1 が設定された .pgd にマージされます。作成されるアプリケーションは、プロファイリング データに基づいて最適化されます。

## <a name="see-also"></a>関連項目
- [パフォーマンス](performance-and-xaml-ui.md)

 

