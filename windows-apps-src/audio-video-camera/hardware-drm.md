---
author: eliotcowley
ms.assetid: A7E0DA1E-535A-459E-9A35-68A4150EE9F5
description: このトピックでは、PlayReady ハードウェア ベースのデジタル著作権管理 (DRM) をユニバーサル Windows プラットフォーム (UWP) アプリに追加する方法の概要を示します。
title: ハードウェア DRM
---

# ハードウェア DRM

\[Windows 10 の UWP アプリ向けに更新。 Windows 8.x の記事については、「[アーカイブ](http://go.microsoft.com/fwlink/p/?linkid=619132)」をご覧ください\]


このトピックでは、PlayReady ハードウェア ベースのデジタル著作権管理 (DRM) をユニバーサル Windows プラットフォーム (UWP) アプリに追加する方法の概要を示します。

**注**  ハードウェア ベースの DRM は、特定のハードウェアのファームウェアの Windows 10 バージョンを備えたハードウェアでのみサポートされます。 提供される保証について詳しくは、「[PlayReady の適合性と信頼性規則](http://www.microsoft.com/playready/licensing/compliance/)」をご覧ください。

ますます多くのコンテンツ プロバイダーが、価値の高いコンテンツをアプリで再生するためアクセス許可を付与する、ハードウェア ベースの保護に移行しています。 PlayReady がこのニーズを満たすために、暗号化コアのハードウェアの実装の強力なサポートが追加されました。 このサポートにより、複数のデバイス プラットフォーム上で、高解像度 (1080 p) と超高解像度 (UHD) のコンテンツを安全に再生できます。 キー マテリアル (秘密キー、コンテンツ キー、これらのキーを派生またはロック解除するために使われるその他のキー マテリアルを含みます)、および暗号化解除された圧縮および非圧縮ビデオ サンプルは、ハードウェア セキュリティを利用して保護されます。

## Windows TEE 実装

このトピックでは、Windows 10 で信頼された実行環境を実装する方法の概要を簡単に示します。

Windows TEE 実装の詳細については、このドキュメントでは説明しません。 ただし、標準の移植キット TEE ポートと Windows ポートの違いについては、簡単に説明します。 Windows は OEM プロキシ レイヤーを実装し、Windows メディア ファンデーション サブシステムのユーザー モード ドライバーに、シリアル化された PRITEE 関数呼び出しを転送します。 これは最終的に Windows TrEE (信頼される実行環境) ドライバーまたは OEM のグラフィックス ドライバーにルーティングされます。 これらのいずれの方法についても、このドキュメントでは説明しません。 次の図は、Windows ポートのコンポーネントの一般的な操作を示しています。 Windows PlayReady TEE 実装を開発する場合は、<WMLA@Microsoft.com> にご連絡ください。

![Windows TEE コンポーネント図](images/windowsteecomponentdiagram720.jpg)

## ハードウェア DRM を使うための考慮事項

このトピックでは、ハードウェア DRM を使うように設計されたアプリを開発するときに考慮する必要があることを、簡単な一覧で示します。

-   保護されたメディア プロセス (PMP) はサポートされません。
-   出力保護レベル (OPL) 270 のサポート (解像度の低下なし)。 ハードウェア DRM の高解像度コンテンツには、270 を超える OPL をお勧めします (ただし、必須ではありません)。 270 を超える OPL は、HDCP が必須であることを意味します。 さらに、HDCP Type 1 (バージョン 2.2 以降) を設定することをお勧めします。
-   出力の保護は、ソフトウェア DRM とは異なり、最も能力の低いモニターに基づいてすべてのモニターに適用されます。 たとえば、ユーザーが 2 台のモニターを接続していて、1 台のモニターが HDCP をサポートし、もう 1 台がサポートしていない場合、HDCP をサポートするモニターでコンテンツがレンダリングされているのみの場合でも、ライセンスに HDCP が必要な場合、再生は失敗します。 ソフトウェア DRM では、HDCP をサポートされているモニターにレンダリングされているのみの場合、コンテンツは再生されます。
-   コンテンツのキーとライセンスで、次の条件が満たされていない限り、ハードウェア DRM はクライアントで使用され、安全であることが保証されません。
    -   オーディオはプレーン テキストであるか、ビデオとは異なるコンテンツ キーに暗号化される必要があります。 再生のパフォーマンスを向上させるため、オーディオはクリア テキストにすることをお勧めします。
    -   ビデオのコンテンツ キーに使われるライセンスには、セキュリティ レベルとして 3000 が必要です。
-   永続的なライセンスには、複数のグラフィックス処理装置 (GPU) はサポートされません。

複数の GPU を持つコンピューターで、永続的なライセンスを処理するには、次のシナリオについて考えてみます。

1.  顧客が、グラフィックス カードが搭載された新しいコンピューターを購入します。
2.  顧客は、ハードウェア DRM の使用中に永続的なライセンスを取得するアプリを使います。
3.  これで、永続的なライセンスがそのグラフィックス カードのハードウェア キーにバインドされます。
4.  次に、顧客は新しいグラフィックス カードを取り付けます。
5.  ハッシュされたデータ ストア (HDS) 内のすべてのライセンスは、搭載されたビデオ カードにバインドされますが、顧客は新たに取り付けられたグラフィックス カードを使って、保護されたコンテンツを再生したいと考えています。

ハードウェアでライセンスの暗号化を解除できないために再生エラーが発生しないようにするため、PlayReady は、見つかったグラフィックス カードごとに、ハッシュされた別のデータ ストア (HDS) を使います。 これにより、PlayReady は、通常は既にライセンスを持っているコンテンツのライセンスの取得を試みます (ソフトウェア DRM の場合、またはハードウェアの変更がない場合、PlayReady はライセンスを再取得する必要はありません)。 したがって、アプリが、ハードウェア DRM の使用中に永続的なライセンスを取得した場合、アプリは、エンド ユーザーがグラフィックス カードを取り付けた (または取り外した) 場合にそのライセンスが実質的に失われるケースに対応できる必要があります。 これは一般的なシナリオではないため、ハードウェアの変更後にコンテンツが再生されなくなった場合、クライアント/サーバー コードでハードウェアの変更を処理する方法の調査よりも、サポートへの問い合わせの対応が必要になることがあります。

## ハードウェア DRM のオーバーライド

このセクションでは、再生するコンテンツがハードウェア DRM をサポートしていない場合に、ハードウェア DRM をオーバーライドする方法について説明します。

既定では、システムによってサポートされている場合は、ハードウェア DRM が使われます。 ただし、一部のコンテンツは、ハードウェア DRM ではサポートされません。 この 1 つの例として、Cocktail コンテンツがあります。 別の例として、H.264 と HEVC 以外のビデオ コーデックを使う任意のコンテンツがあります。 さらに別の例として、HEVC コンテンツがあります。ハードウェアによって、HEVC をサポートしているものと、そうでないものがあります。 そのため、コンテンツを再生する場合に、ハードウェア DRM が該当のシステムでこれをサポートしていない場合は、ハードウェア DRM を除外することができます。

次の例は、ハードウェア DRM の除外方法を示しています。 この操作は、切り替えの前にのみ行う必要があります。 また、メモリ内に PlayReady オブジェクトが存在していないことも確認してください。存在する場合は、動作が未定義になります。

```js
var applicationData = Windows.Storage.ApplicationData.current;
var localSettings = applicationData.localSettings.createContainer("PlayReady", Windows.Storage.ApplicationDataCreateDisposition.always);
localSettings.values["SoftwareOverride"] = 1;
```

ハードウェア DRM に切り替えるには、**SoftwareOverride** の値を **0** に設定します。

すべてのメディア再生で、**MediaProtectionManager** を次のように設定する必要があります。

```js
mediaProtectionManager.properties["Windows.Media.Protection.UseSoftwareProtectionLayer"] = true;
```

ハードウェア DRM であるか、ソフトウェア DRM であるかを確認する最適な方法は、C:\\Users\\&lt;ユーザー名&gt;\\AppData\\Local\\Packages\\&lt;アプリケーション名&gt;\\LocalState\\PlayReady\\\* を調べることです。

-   mspr.hds ファイルがある場合は、ソフトウェア DRM を使っています。
-   他の \*.hds ファイルがある場合は、ハードウェア DRM を使っています。
-   PlayReady フォルダー全体を削除して、テストを再試行することもできます。

## ハードウェア DRM の種類を検出する

このセクションでは、システムでサポートされているハードウェア DRM の種類を検出する方法について説明します。

[
            **PlayReadyStatics.CheckSupportedHardware**](https://msdn.microsoft.com/library/windows/apps/dn986441) メソッドを使って、システムが特定のハードウェア デジタル権利管理 (DRM) 機能をサポートしているかどうかを判断できます。 次に例を示します。

```cpp
boolean PlayReadyStatics->CheckSupportedHardware(PlayReadyHardwareDRMFeatures enum);
```

[
            **PlayReadyHardwareDRMFeatures**](https://msdn.microsoft.com/library/windows/apps/dn986265) 列挙体には、照会できるハードウェア DRM 機能の値の有効な一覧が含まれます。 ハードウェア DRM がサポートされているかどうかを判断するには、クエリで **HardwareDRM** メンバーを使います。 ハードウェアが高効率ビデオ コーディング (HEVC)/H.265 コーデックをサポートしているかどうかを判断するには、クエリで **HEVC** メンバーを使います。

[
            **PlayReadyStatics.PlayReadyCertificateSecurityLevel**](https://msdn.microsoft.com/library/windows/apps/windows.media.protection.playready.playreadystatics.playreadycertificatesecuritylevel.aspx) プロパティを使って、クライアント証明書のセキュリティ レベルを取得し、ハードウェア DRM がサポートされているかどうか判断することもできます。 返された証明書のセキュリティ レベルが 3000 以上でない限り、クライアントが個別化またはプロビジョニングされていないか (この場合、このプロパティは 0 を返します)、ハードウェア DRM が使われていません (この場合、このプロパティは 3000 未満の値を返します)。



<!--HONumber=May16_HO2-->


