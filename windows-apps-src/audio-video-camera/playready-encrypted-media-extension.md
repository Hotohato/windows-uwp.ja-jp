---
xx.xxxxxxx: YYXYYYXX-XYYX-YXYY-YYYX-YXYXXYXYYXXX
xxxxxxxxxxx: Xxxx xxxxxxx xxxxxxxxx xxx xx xxxxxx xxxx XxxxXxxxx Xxx xxx xx xxxxxxx xxx xxxxxxx xxxx xxxx xxx xxxxxxxx Xxxxxxx Y.Y xxxxxxx xx xxx Xxxxxxx YY xxxxxxx.
xxxxx: XxxxXxxxx Xxxxxxxxx Xxxxx Xxxxxxxxx
---

# XxxxXxxxx Xxxxxxxxx Xxxxx Xxxxxxxxx

\[ Xxxxxxx xxx XXX xxxx xx Xxxxxxx YY. Xxx Xxxxxxx Y.x xxxxxxxx, xxx xxx [xxxxxxx](http://go.microsoft.com/fwlink/p/?linkid=619132) \]


Xxxx xxxxxxx xxxxxxxxx xxx xx xxxxxx xxxx XxxxXxxxx Xxx xxx xx xxxxxxx xxx xxxxxxx xxxx xxxx xxx xxxxxxxx Xxxxxxx Y.Y xxxxxxx xx xxx Xxxxxxx YY xxxxxxx.

Xxxxx XxxxXxxxx xxxxx xxxxxxxx xx Xxxxxxxx Xxxxxxxx xxxxxxx xxxxxxxxxx xx xxxxxx Xxx xxxx xxxxxxx xx xxxxxxxxx XxxxXxxxx xxxxxxx xx xxx xxxx xxxxx xxxxxxxxx xxx xxxxxx xxxxx xxxxxxx xx xxx xxxxxxx xxxxxxxx. Xxxx xxxxxxx xxxxxxxxx xxx xx xxx XxxxXxxxx xxxxx xxxxxxxx xx xxxx xxxxxxxx Xxx xxxx xxxxx xxxx XXXXY xxx XxxxXxxxxx.

## Xxxx'x Xxx xx XxxxXxxxx Xxxxxxxxx Xxxxx Xxxxxxxxx

Xxxx xxxxxxx xxxxxxxx x xxxx xx xxxxxxx xxxx xx xxx XxxxXxxxx Xxxxxxxxx Xxxxx Xxxxxxxxx xx xxxxxx XxxxXxxxx xxxxxxx xxxxxxxxxx xx Xxxxxxx YY.

Xxx xxxxxxxxx xxxx xxxxxxxxx xxx xxx xxxxxxxx xxx xxxxxxx xxxx xx XxxxXxxxx Xxxxxxxxx Xxxxx Xxxxxxxxx xxx Xxxxxxx YY:

-   Xxxxx xxxxxxxx xxxxxxx xxxxxx xxxxxxxxxx (XXX).

    Xxxxxxxx-xxxxx xxxxxxx xxxxxxxxxx xxxxxxx xxxxxxx xxxxxx xxxxxxxx xx xxxx xxxxxxxxxx (XX) xxx xxxxx-xxxx xxxxxxxxxx (XXX) xxxxxxx xx xxxxxxxx xxxxxx xxxxxxxxx. Xxx xxxxxxxx (xxxxxxxxx xxxxxxx xxxx, xxxxxxx xxxx, xxx xxx xxxxx xxx xxxxxxxx xxxx xx xxxxxx xx xxxxxx xxxx xxxx), xxx xxxxxxxxx xxxxxxxxxx xxx xxxxxxxxxxxx xxxxx xxxxxxx xxx xxxxxxxxx xx xxxxxxxxxx xxxxxxxx xxxxxxxx.

-   Xxxxxxxx xxxxxxxxx xxxxxxxxxxx xx xxx-xxxxxxxxxx xxxxxxxx.
-   Xxxxxxxx xxxxxxxxxxx xx xxxxxxxx xxxxxxxx xx xxx xxxxxxx.

    Xxx xxx xxxxxx xxx x XxxxXxxxx xxxxxx xxxx xxxxxxxx xxx xxxxxxxxxxx (XxxXXx) xx xx Xxxxxxx Y.Y, xx xxx [xxxxxxx xxxxxxxxxx xxxxx xxxx (XXXXxxx)](https://go.microsoft.com/fwlink/p/?LinkID=626819) xxxx xxxxxxxx XxxXXx.

    **Xxxx**  Xx Xxxxxxx YY, xxxxxxxx xxx xxxxxxxxxxx xxx xxxxxxxxx xxxxx &xx;XxxXX&xx; xx XXXXxxx.

     

-   Xxxxx xxxx xxxx xxxxxxxxxx xxxxxxx, xx xxxxxxx xxxxxxxx xxxxxxx (XXX).

    Xxxxxxxx xxx xxxxxxx xx xxx xxxx-xxxx xxxxxxxxxx xx xxxxxxxx.

-   Xxxxx XXXX Xxxx Y (xxxxxxx Y.Y) xxxxxx xxxxxxx.
-   Xxxxxxxx xx xxx xxxxxxxx xx xx xxxxxx.
-   Xxxxx xxxxxx xxxx.

    Xxxxxx xxxx xxxxxxxx xxx xxxxx xxx x XxxxXxxxx xxxxxx xx xxxxxxxxxxx xxxxxx xx x xxxxx xxxxxxxxx xxxxxxx xxxx xxxxx xxxxxxxx xxx xxxxxxx xxx xxx xxxxx xxxxx xx xxxxxxx.

-   Xxxxx xxxxx xxx xxxxx xxxxxxx xxxxxxxxxx.

    Xxxxxxxx xxxxxx xxxxxxx xxxxx xxxx xxxxx xxxxxxx xx xxxxx; xxxxxxxx xxxx xxxxxx xxxxxxx xxxxxxxxxx. Xxxxxxxx xxxxxxxxx xxx xxxxxxxxx xxxxxxxx xxxx xxx xxxxx xxx xxxxxx xxxxxx.

-   Xxxxx XxxXxxXxxxxx.

    Xxxx xxxxxxx xxx xxxxx xx xxxxx xxxxxxxx xx xxxxxxx xx x xxxxxxx xxxxxxxxxx xxxx xxxx xx xxxxxxxxxx xx x xxxx xxxxxxx xxx (xxx xxx x xxxxxxx). Xx xxxxxxxx xxxxx xxxxx xxxxxxxx xxxxxx xxxxx xxx xxxxxxx xxxx x xxxxxx xxx.

## Xxxxxxxxx Xxxxx Xxxxxxxxx Xxxxxxx xx XxxxXxxxx

Xxxx xxxxxxx xxxxxxxxx xxx xxxxxxx xx xxx XYX Xxxxxxxxx Xxxxx Xxxxxxxxx xxxxxxxxx xx XxxxXxxxx.

XxxxXxxxx xxx Xxx Xxxx xx xxxxxxxxx xxxxx xx xxx [XYX Xxxxxxxxx Xxxxx Xxxxxxxxx (XXX) xxxxx xx Xxx YY, YYYY](http://www.w3.org/TR/2013/WD-encrypted-media-20130510/). Xxxx xxxxxxx xxxx xx xxxxxxx xx xxx xxxxxxx XXX xxxxxxxxxxxxx xx xxxxxx xxxxxxxx xx Xxxxxxx.

## Xxx Xxxxxxxx XXX

Xxxx xxxxxxx xxxxxxxxx xxx xxxx xxx xxx xxx xxx XxxxXxxxx xxxxxxxx XXX, xxx xxx xx xxxxxxx xxxxxxxx XXX xx xxx xxxxxxxxx xxxxxxx xxxx xxx xxxxxxx xx.

Xx xxx XxxxXxxxx xxxxxxxx XXX, xxxx XxxxXxxxxx xxx xxx xxxxxx xxx xxx **xxXxxxXxxxxxxxx** XXX xxxxxx xxxx x xxx xxxxxx xxxxxxxxxx xx `com.microsoft.playready.hardware` xx xxxxx xxx XxxxXxxxx xxxxxxxx XXX xxxxxxx xxxx xxx xxxxxxx.

Xxxxxxxxxxxx, xxxx xxxxxxx xx xxx xxxxxxxxx xx xxxxxxxx XXX. Xxxxxxxx xxxxxxx xx xxxxx xxxxxxxxx xx xxxxxxxx XXX; xx xxx xxxx xx xxxx xxxxxxxx xxxxxxx, xxx xxxx xxx xxx xx xxxxxxxx XXX. Xxxx xxxxxxxx XXX xxxx xxxxxxx XXXX xxx xxxx xxxx xxx; xx xxx xxxx xx xxxx XXXX xxxxxxx xxx xxxxxxxx XXX xxxxx’x xxxxxxx xx, xxx xxxx xxxx xx xxx xxx xx xxxx.

**Xxxx**  Xx xxxxxxxxx xxxxxxx XXXX xxxxxxx xx xxxxxxxxx, xxxxx xxxxxxxxxxxxx `com.microsoft.playready`, xxx xxx [**XxxxXxxxxXxxxxxx.XxxxxXxxxxxxxxXxxxxxxx**](https://msdn.microsoft.com/library/windows/apps/dn986441) xxxxxx.

 

## Xxx Xxxxxx Xxxx xx xxxx Xxx Xxx

Xxxx xxxxxxx xxxxxxxxx xxx xx xxx xxxxxx xxxx xx xxxx xxx xxx.

Xxxxxx xxxx xxxxxxxx xxx xxxxx xxx x XxxxXxxxx xxxxxx xx xxxxxxxxxxx xxxxxx xx x xxxxx xxxxxxxxx xxxxxxx xxxx xxxxx xxxxxxxx xxx xxxxxxx xxx xxx xxxxx xxxxx xx xxxxxxx. Xxxx xxxxxxxxxx xxxxxxx xxxx xxxxx xxxxxxxxx xxxxxxxx xxxxxxx xxxxxxxx xxxxxxxxxxx xxx xxxxxxxxx xx xxxxx xxxxxxxxxxx xx xxxxxxxxx xxxxxxx xxx x xxxxx xxxxxxx.

Xxxxx xxx xxx xxxxxxx xxxxxxxxx xxx xxxxxxx x xxxxxx xxxx xxxxxxxxx:

-   Xxxx xxx xxxxx xxxxxxxxxxxx xxxxx xxxxxxx xxx xx xxxxxxx xxx xxxxxxx xx xxxx xxx xxxx xxxxxxx xxx xxxxx xxxxxxxxxxxx xxxxxxxxx xx xxx xxxxxx.
-   Xxxx xxx xxxxxxxx xxxxxxx xxxx xxxxxxxxxxxx (xxx xxxxxxx, xxx xx x xxxxxx xx xxx xxxxx). Xxx xxx xxxx xxxx xx xxxxx, xxxxxx xx xxxxxxx xx xxxxxxxx, xxx xxx xxxxxxxxxxx xxxxxx xxxx xxxxxxxx xxx xxxx xxxxxxxxx(x) xxxxxxxx xxxx xxx xxxxx xxxxx xxxxxxxx.

Xxx xxxxxxxxx xxxxxxxxxx xxxxxxxx xxx xx xxx xx xxxxxx xxxx xxx xxxxxxx xxxxxxxxx.

Xx xxx xx xxxxxx xxxx xxx x xxxxxx xxx xx x xxxxxxxxxxxx:

1.  Xxxxxxxx xxx **xxXxxxx** xxxxx xxxxxx xxxxxxxx xxxxxx.
2.  Xxx **xxXxxxx** xxxxx xxxxxxx xxxxx xx xxxx `removeAttribute(“src”)` xxxx xxx xxxxx/xxxxx xxxxxxx xxxxxx xx xxx xxx xxxxxx xx **XXXX** xxxxx xxxx xxxxxxx xxx xxxxx xxxxxxxxxx xx xxxx xxxx xxx xxxxxxxx, xxxxxxx xxx xxxxxxxxx(x), xxx xxx xxx xxxx xxxxx.
3.  Xxx xxx xxxxx xxx xxxxxx xxxx XXX xxxxxxx xxxxxx xxx xxxxxxx xx xxxx xxx xxxxxx xxxx xxxxxxxxx xx xxx xxxxxx xx xxxxxx xxx xxxxxxxx xxx xxxxxxx xx xxxx xxxx, xxx xx xxx xx xxxx xxxxx xx xxxx.

Xx xxx xx xxxxxx xxxx xx xxx xxxx xxxxxxxxx xxxx xxxx xxx xxxx xx xxxxxx xxxx xxx xxx xx xxxxxxx:

-   Xx xxx xxxxxx xx xxxxxxxx xx xxxxxx xxx xxxx xxxxx; xx xxxx xx xxxxxxxx xxx xxx.

Xx xxx xx xxxxxx xxxx xxx xxxxxx xxxx xxxxxxxx xx xxxx xxxxxxx (xxxx xx xxxxxx xxxxxxxxxx xxxxxxx xx xxxxxxxx x xxx xxxxxxxxxxxx xxxxxx xxx xxxxxxx xxxxxxxxxxxx xxxxxxxxx):

-   Xxxx xxxxxx xxxx xxxxxx xxxxxx, xxx xxx xxxxx xx xxx xxx xxxxxx xx **XXXX** xxxxx xxxx xxxxxxx xxx xxxxx xxxxxxxxxx xx xxxx xxxx xxx xxxxxxxx, xxxxxxx xxx xxxxxxxxx(x), xxx xxx xxx xxxx xxxxx.

Xxx xxxxxxxxx xxxxxxx xxxxxxxxxxxx xxx xx xxx xxxxxx xxxx xx xxxx xxx xxx:

``` syntax
// JavaScript source code

var g_prkey = null;
var g_keySession = null;
var g_fUseSpecificSecureStopSessionID = false;
var g_encodedMeteringCert = 'Base64 encoded of your metering cert (aka publisher cert)';

// Note: g_encodedLASessionId is the CDM session ID of the proactive or reactive license acquisition 
//       that we want to initiate the secure stop process.
var g_encodedLASessionId = null;

function main()
{
    ...

    g_prkey = new MSMediaKeys("com.microsoft.playready");

    ...

    // add 'onended' event handler to the video element
    // Assume 'myvideo' is the ID of the video element
    var videoElement = document.getElementById("myvideo");
    videoElement.onended = function (e) { 

        //
        // Calling removeAttribute("src") will set the source to null
        // which will trigger the MF to tear down the topology, destroy the
        // decryptor(s) and set the stop state.  This is required in order
        // to set the stop state.
        //
        videoElement.removeAttribute("src");

        onEndOfStream();
    };
}

function onEndOfStream()
{
    ...

    createSecureStopCDMSession();

    ...    
}

function createSecureStopCDMSession()
{
    try{    
        var targetMediaCodec = "video/mp4";
        var customData = "my custom data";

        var encodedSessionId = g_encodedLASessionId;
        if( !g_fUseSpecificSecureStopSessionID )
        {
            // Use "*" (wildcard) as the session ID to include all secure stop sessions
            // TODO: base64 encode "*" and place encoded result to encodedSessionId
        }

        var int8ArrayCDMdata = formatSecureStopCDMData( encodedSessionId, customData,  g_encodedMeteringCert );
        var emptyArrayofInitData = new Uint8Array();

        g_keySession = g_prkey.createSession(targetMediaCodec, emptyArrayofInitData, int8ArrayCDMdata);

        addPlayreadyKeyEventHandler();

    } catch( e )
    {
        // TODO: Handle exception
    }
}

function addPlayreadyKeyEventHandler()
{
    // add 'keymessage' eventhandler   
    g_keySession.addEventListener('mskeymessage', function (event) {

        // TODO: Get the keyMessage from event.message.buffer which contains the secure stop challenge
        //       The keyMessage format for the secure stop is similar to LA as below:
        //
        //            <PlayReadyKeyMessage type="SecureStop" >
        //              <SecureStop version="1.0" >
        //                <Challenge encoding="base64encoded">
        //                    secure stop challenge
        //                </Challenge>
        //                <HttpHeaders>
        //                    <HttpHeader>
        //                      <name>Content-Type</name>
        //                         <value>"content type data"</value>
        //                    </HttpHeader>
        //                    <HttpHeader>
        //                         <name>SOAPAction</name>
        //                         <value>soap action</value>
        //                     </HttpHeader>
        //                    ....
        //                </HttpHeaders>
        //              </SecureStop>
        //            </PlayReadyKeyMessage>
                
        // TODO: send the secure stop challenge to a server that handles the secure stop challenge

        // TODO: Recevie and response and call event.target.Update() to proecess the response
    });
    
    // add 'keyerror' eventhandler
    g_keySession.addEventListener('mskeyerror', function (event) {
        var session = event.target;
        
        ...

        session.close();
    });
    
    // add 'keyadded' eventhandler
    g_keySession.addEventListener('mskeyadded', function (event) {
        
        var session = event.target;

        ...

        session.close();             
    });
}

/**
* desc@ formatSecureStopCDMData
*   generate playready CDMData
*   CDMData is in xml format:
*   <PlayReadyCDMData type="SecureStop">
*     <SecureStop version="1.0">
*       <SessionID>B64 encoded session ID</SessionID>
*       <CustomData>B64 encoded custom data</CustomData>
*       <ServerCert>B64 encoded server cert</ServerCert>
*     </SecureCert>
* </PlayReadyCDMData>        
*/
function formatSecureStopCDMData(encodedSessionId, customData, encodedPublisherCert) 
{
    var encodedCustomData = null;

    // TODO: base64 encode the custom data and place the encoded result to encodedCustomData

    var CDMDataStr = "<PlayReadyCDMData type=\"SecureStop\">" +
                     "<SecureStop version=\"1.0\" >" +
                     "<SessionID>" + encodedSessionId + "</SessionID>" +
                     "<CustomData>" + encodedCustomData + "</CustomData>" +
                     "<ServerCert>" + encodedPublisherCert + "</ServerCert>" +
                     "</SecureStop></PlayReadyCDMData>";
    
    var int8ArrayCDMdata = null

    // TODO: Convert CDMDataStr to Uint8 byte array and palce the converted result to int8ArrayCDMdata

    return int8ArrayCDMdata;
}
```

**Xxxx**  Xxx xxxxxx xxxx xxxx’x `<SessionID>B64 encoded session ID</SessionID>` xx xxx xxxxxx xxxxx xxx xx xx xxxxxxxx (\*), xxxxx xx x xxxx xxxx xxx xxx xxx xxxxxx xxxx xxxxxxxx xxxxxxxx. Xxxx xx, xxx **XxxxxxxXX** xxx xxx xx x xxxxxxxx xxxxxxx, xx x xxxx xxxx (\*) xx xxxxxx xxx xxx xxxxxx xxxx xxxxxxxx.

## Xxxxxxxxxxx Xxxxxxxxxxxxxx xxx Xxxxxxxxx Xxxxx Xxxxxxxxx

Xxxx xxxxxxx xxxxx xxx xxxxxxxxxxx xxxxxxxxxxxxxx xxxx xxx xxxxxx xxxx xxxx xxxxxxx xxxx xxxxxxxx xxxx XxxxXxxxx-xxxxxxx xxx xxx xxx Xxxxxxx YY.

Xxx **XXXxxxxXxxx** xxx **XXXxxxxXxxXxxxxxx** xxxxxxx xxxxxxx xx xxxx xxx xxxx xx xxxx xxxxx xxxxx xxxx xxx xxxxxx. Xxx xxx xx xxxxxxxx xxxxx xxxxxxx xxxx xxxxx xx xx xxxxxx xxxx xx xxxxxx xxxxxxxxx (xxx xxxxxxxxx xxxxx xxxxxx xxx xx xxxxx xxx xxxxxxx xx xxxxxxx xxxxxxxxxx xx xxxxxxxx xx x xxxxx xxxxxxxx xxxxxx xx x xxxxxxxx). Xxx xxxxxxx, xxx xxxxxxxxx xxxxxx xxxxxxx xxx xxxxxxxxx *x\_xxXxxxxXxxx* xxx *x\_xxxxxXxxXxxxxxx* xx xxxxxx xxxxxxxxx, xxxxx xxx xxxx xxxxxxxx xx xxx **XXXxxxxXxxx** xxx **XXXxxxxXxxXxxxxxx** xxxxxxx xx xxx xxxxxxxx.

``` syntax
var g_msMediaKeys;
var g_mediaKeySession;

function foo() {
  ...
  g_msMediaKeys = new MSMediaKeys("com.microsoft.playready");
  ...
  g_mediaKeySession = g_msMediaKeys.createSession("video/mp4", intiData, null);
  g_mediaKeySession.addEventListener(this.KEYMESSAGE_EVENT, function (e) 
  {
    ...
    downloadPlayReadyKey(url, keyMessage, function (data) 
    {
      g_mediaKeySession.update(data);
    });
  });
  g_mediaKeySession.addEventListener(this.KEYADDED_EVENT, function () 
  {
    ...
    g_mediaKeySession.close();
    g_mediaKeySession = null;
  });
}
```

Xxxxx xx xxx [xxxxxx xxxxxxxxxxxx](https://code.msdn.microsoft.com/windowsapps/PlayReady-samples-for-124a3738) xxx xxxx xxxxxxxxxxx.

 

 




<!--HONumber=Mar16_HO1-->
