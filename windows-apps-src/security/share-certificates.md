---
xxxxx: Xxxxx xxxxxxxxxxxx xxxxxxx xxxx
xxxxxxxxxxx: Xxxxxxxxx Xxxxxxx Xxxxxxxx (XXX) xxxx xxxx xxxxxxx xxxxxx xxxxxxxxxxxxxx xxxxxx x xxxx Xx xxx xxxxxxxx xxxxxxxxxxx xxx xxx xxxxxxxxxxxx xxx xxxxxxxxxxxxxx.
xx.xxxxxxx: YYYXXYYY-YXXY-YYYX-XXYY-XYYXYYXYYYXY
---

# Xxxxx xxxxxxxxxxxx xxxxxxx xxxx


\[ Xxxxxxx xxx XXX xxxx xx Xxxxxxx YY. Xxx Xxxxxxx Y.x xxxxxxxx, xxx xxx [xxxxxxx](http://go.microsoft.com/fwlink/p/?linkid=619132) \]


Xxxxxxxxx Xxxxxxx Xxxxxxxx (XXX) xxxx xxxx xxxxxxx xxxxxx xxxxxxxxxxxxxx xxxxxx x xxxx Xx xxx xxxxxxxx xxxxxxxxxxx xxx xxx xxxxxxxxxxxx xxx xxxxxxxxxxxxxx. Xxxxxxxxxxx xxxxxxxxxxxxxx xxxxxxxx x xxxx xxxxx xx xxxxx xxxx xxxxxxxxxxxxxx x xxxx. Xx xxxx xxxxx, x xxxxx xx xxxxxxxx xxxx xxxx xx xxxxxxxxxxxx x xxxx xxx xxxxxxxx xxxx. Xxxx xxxxxxx xxxxx xxx xxx xxx xxxxxxxxxxxx xxxxxxxx xxxx xxxxx xxx xxxx xxxxxxxxxxx, xxx xxx xxx xxx xxxxxxx xxxxxxxxxx xxxx xxx x xxxx xx xxxxxx x xxxxxxxxxxx xxxx xxx xxxxxxxx xx xxxxxx xxxxxxx xxx xxxxxxxx.

Xxxx xxx xxxxxxxxxxxx xx x xxx xxxxxxx xxxxx x xxxxxxxxxxx, xxx xxxxxxxx xxxx xxx xxx x xxxxxx xxxxxxxxxxx xxxx xxx xxxxxxxxxxx xxxxx xx xxxxxxxxxxxx xxx xxxx xxxx. Xx x xxxxxxxxxxx xxxx xxx xxxxx xx xxx xxxxx, xxx xxx xxx xxxx xx xxxx xxx xx xxxxxx x xxxxxxxxxxx xxxx x XXX xxxx.

## Xxxxxx Xxxxxxxxx Xxxxxxxx Xxxxxxxxxxx Xxxxxxxx (XXX) xxx xxxxxx xxxxxxxxxxx xxxxxxx


Xxxx xxxxxxx xxxx Xxxxxxxxx Xxxxxxxx Xxxxxxxxxxx Xxxxxxxx (XXX) xxx xxxxxxx xxxxxxxx. XXX xx xxx xxxxxxx xx xxxxxxx. Xxx xxx xxxxxx XXX xx xxxxx xxx Xxxxxxx Xxxxx.

1.  Xxxx xxx Xxxxxxx Xxxxx xxx xxxxxx **Xxxxxxxx**.
2.  Xxxxxx **Xxxx Xxxxxxx xxxxxxxx xx xx xxx**.
3.  Xxxxxx **Xxxxxxxx Xxxxxxxxxxx Xxxxxxxx** xxx xxxx xxxxxx **Xxxxx Xxxx Xxx Xxxxxxxx**. Xxxxxx **Xxxxxxxxxxx Xxxxxxxxxxx Xxxxxxxx** xxx xxxxxx **XXX.XXX Y.Y** xxx **XXX.XXX Y.Y**. Xxxxxx xxxxx xxxxxxxxxx xxxx xxxxxxxxxxxxx xxxxxx **Xxxxxxxx Xxxxxxxxxxx Xxxxxxxx**.
4.  Xxxxx **XX** xx xxxxx xxx xxxxxxx.

## Xxxxxx xxx xxxxxxx x xxxxxxx xxx xxxxxxx


1.  Xxx Xxxxxxxxx Xxxxxx Xxxxxx xx xxxxxxxxxxxxx xxx xxxxxx **Xxx Xxxxxxx** xxxx xxx xxxxx xxxx. Xxxxxxxxxxxxx xxxxxx xx xxxxxxxx xx xxxxxxx x xxx xxxxxxx xx xx XXX xxxxxx. Xx xxx Xxx Xxxxxxx xxxxxx, xxxxxx xxx xxxxxxxxx xx **.XXX Xxxxxxxxx Y.Y**. Xxxxxx **Xxxxxx X#** -&xx; **Xxx** -&xx; **Xxxxxx Xxxxxx** -&xx; **XXX.XXX Xxx Xxxxxxx Xxxxxxxxxxx**. Xxxx xxx xxxxxxxxxxx "XxxxxXxxxxxxXxxx". Xxxxx **XX** xx xxxxxx xxx xxxxxxx.
2.  Xx xxx **XxxxxxxY.xxxx.xx** xxxx, xxxxxxx xxx xxxxxxx **XxxxxXxxxx** xxx xxxxxx xxxx xxx xxxxxxxxx "Xxxxx" xxxxxx.
    ```cs
            [WebMethod]
            public string Login()
            {
                // Verify certificate with CA
                var cert = new System.Security.Cryptography.X509Certificates.X509Certificate2(
                    this.Context.Request.ClientCertificate.Certificate);
                bool test = cert.Verify();
                return test.ToString();
            }
    ```

3.  Xxxx xxx **XxxxxxxY.xxxx.xx** xxxx.
4.  Xx xxx **Xxxxxxxx Xxxxxxxx**, xxxxx-xxxxx xxx "XxxxxXxxxxxxXxxx" xxx xxx xxxxxx **Xxxxxxx**.
5.  Xx xxx **Xxxxxxx Xxx** xxxxxx, xxxxxx x xxx xxxxxxx xxx xxxx xx "XxxxxxxXxxxxxx". Xxxxx **Xxxx.**
6.  Xx xxx xxxx xxxx, xxxxx xxx xxxxxx xxxx xxx xxxx XXX xxxxxx, xxx xxxxxxx x xxxx xxxx xx "Xxxxxxx Xxx Xxxx/XxxxxXxxxxxxXxxx". Xxxxx **Xxxxxxx** xx xxxxxxx xxxx xxx xxxxxxx.

## Xxxxxxxxx xxxx xxx xxxxxxx xx xxx xxxxxx xxxxxxxxxxx xxxxxxxxxxxxxx


1.  Xxx xxx **Xxxxxxxx Xxxxxxxxxxx Xxxxxxxx (XXX) Xxxxxxx**.
2.  Xxxxxx xxx xxxxx xxx xxxx XXX xxxxxx. Xxxxx xxx **Xxxxxxx Xxx Xxxx**, xxxxxx xxx xxx "XxxxxXxxxxxxXxxx" xxx xxxxxxx. Xx xxx **Xxxxxxx** xxxxxxx, xxxxxx **Xxxxxxxx Xxxxxxxx...**.
3.  Xxx xxx **Xxxxxxxxxxx Xxxx** xx **.XXX xY.Y** xxx xxxxx **XX**.
4.  Xx xxx **Xxxxxxxx Xxxxxxxxxxx Xxxxxxxx (XXX) Xxxxxxx**, xxxxxx xxxx XXX xxxxxx xxx xxxx xxxxxx-xxxxx **Xxxxxx Xxxxxxxxxxxx**. Xx xxx **Xxxxxxx** xxxxxxx, xxxxxx **Xxxxxx Xxxx-Xxxxxx Xxxxxxxxxxx...**. Xxxxx "XxxxxxxXxxx" xx xxx xxxxxxxx xxxx xxx xxx xxxxxxxxxxx xxx xxxxx **XX**. Xxxx xxxx xxxxxx x xxx xxxxxxxxxxx xxx xxx xx xxx XXX xxxxxx xx xxx xxxx xx "&xx;xxxxxx-xxxx&xx;.&xx;xxxxxx-xxxx&xx;".
5.  Xx xxx **Xxxxxxxx Xxxxxxxxxxx Xxxxxxxx (XXX) Xxxxxxx**, xxxxxx xxx xxxxxxx xxx xxxx. Xx xxx **Xxxxxxx** xxxxxxx, xxxxxx **Xxxxxxx** xxx xxxx xxxxx **Xxx...**. Xxxxxx "xxxxx" xx xxx xxxx, xxx xxx xxxx xx "YYY", xxx xxxxx xxx xxxx xxxx xxxx xxx xxxx XXX xxxxxx ("&xx;xxxxxx-xxxx&xx;.&xx;xxxxxx-xxxx&xx;"). Xxx xxx XXX xxxxxxxxxxx xx "XxxxxxxXxxx". Xxxxx **XX**. Xxxxx **Xxxxx** xx xxx **Xxxx Xxxxxxxx** xxxxxx.
6.  Xx xxx **Xxxxxxxx Xxxxxxxxxxx Xxxxxxxx (XXX) Xxxxxxx**, xxxxxx xxx "XxxxxXxxxxxxXxxx" xxx xxxxxxx. Xxxxxx-xxxxx **XXX Xxxxxxxx**. Xxxxx **Xxxxxxx XXX**. Xxxxx **Xxxxxx xxxxxxxxxxxx**, xxxxxx **Xxxxxxx**. Xx xxx **Xxxxxxx** xxxxxxx, xxxxx **Xxxxx**.
7.  Xxx xxx xxxxxx xxxx xxx xxx xxxxxxx xx xxxxxxxxxx xxxxxxxxx xx xxxxxxx xxxx xxx xxxxxxx xxx xxxxxxxx xxx xxxxxxxxx xxx xxxxxxx: "xxxxx://&xx;xxxxxx-xxxx&xx;.&xx;xxxxxx-xxxx&xx;/XxxxxXxxxxxxXxxx/XxxxxxxY.xxxx". Xxx xxxxxxx, "xxxxx://xxxxxxxx.xxxxxxx.xxx/XxxxxXxxxxxxXxxx/XxxxxxxY.xxxx". Xx xxxx xxx xxxxxxx xx xxxxxxxxxx xxxxxxxxx, xxx xxxx xx xxxxxxxx xx xxxxxx x xxxxxx xxxxxxxxxxx xx xxxxx xx xxxxxx xxx xxx xxxxxxx.

Xxx xxx xxxxxx xxx xxxxxxxx xxxxx xx xxxxxx xxxxxxxx xxx xxxxxxxx xxxx xxx xx xxxxxxxx xxxxx xxx xxxx xxxxxx xxxxxxxxxxx.

## Xxxxxx x Xxxxxxx Xxxxx xxx xxxx xxxx xxxxxxxxxxx xxxxxxxxxxxxxx


Xxx xxxx xxx xxxx xxx xx xxxx xxxxxxx xxx xxxxxxxx, xxxx xxxx xxx xxx xxxxxxxxxxxx xx xxxxxxxxxxxx xx xxxxx xxx xxxxxxxx. Xxxx xxx xxxx x xxxxxxx xx xx xxxxxxxxxxxxx xxx xxxxxxx xxxxx xxx [**XxxxXxxxxx**](https://msdn.microsoft.com/library/windows/apps/dn298639) xxxxxx, xxx xxxxxxx xxxxxxx xxxx xxx xxxxxxx x xxxxxx xxxxxxxxxxx. Xxx xxxxxxxxxxxxx xxx xxxxxxx xxxx xxxxxxx xxxx x xxxxxxx xxx xxxxxx xxxxxxxxxxxxxx. Xxxx xxxx xxxxxx, xxx Xxxxxxx xxxxxx xxxx xxxxxxxxxxxxx xxxxx xxx xxxxxxxxxxx xxxxx xxx xxxxxxxxx xxxxxx xxxxxxxxxxxx. Xxxx xxxx xxx xxxxxx xxxx xxxxx xxxxxxxxxxxx xx xxxxxxxxxxxx xx xxx xxx xxxxxxx. Xxxx xxxxxxxxxxxx xxx xxxxxxxx xxxxxxxxx, xx xxx xxxx xxxx xx xxxxxxx xxx xxxx xxxx x xxx xx xxxxx xxx xxxxxxxx xxx x xxxxxxxxxxx.

Xx xxxxx xxx xx xxxxxx xxxxxxxxxxxx xxxxxxxxx, xxxx xxx xxxx xxxx xxxx xx xxx x xxxxxxxxxxx xx xxx xxxxxxxxxxx xxxxx. Xxx xxx xxxxxxx xxxx xx xxxx xxx xxxx xxxxxxx x xxxx xx xxxxxx x XXX xxxx xxxx xxxxxxxx x xxxxxx xxxxxxxxxxx xxx xxxx xxxxxx xxxx xxxxxxxxxxx xxxx xxx xxxxxx xxxxxxxxxxx xxxxx.

**Xxx**  Xxx xxx xxx xxxxxxxx.xxx xx xxxxxx x XXX xxxx xx xxx xxxx xxxx xxxxxxxxxx. Xxx xxxxxxxxxxx xx xxxxx xxxxxxxx.xxx, xxx [XxxxXxxx.](https://msdn.microsoft.com/library/windows/desktop/aa386968)

 

1.  Xxxx Xxxxxx Xxxxxx xxx xxxxxx x xxx xxxxxxx xxxx xxx xxxxx xxxx. Xxxx xxx xxx xxxxxxx "XxxxxXxxxxxxXxxxXxx". Xxxxx **XX** xx xxxxxx xxx xxx xxxxxxx.
2.  Xx xxx XxxxXxxx.xxxx xxxx, xxx xxx xxxxxxxxx XXXX xx xxx xxxxxxx **Xxxx** xxxxxxx. Xxxx XXXX xxxxxxxx x xxxxxx xx xxxxxx xxx x XXX xxxx xx xxxxxx, x xxxx xxx xx xxxxx x xxxxxxxx xxx x xxxxxxxx-xxxxxxxxx XXX xxxx, x xxxxxx xx xxxxxx x xxxxxxxx XXX xxxx, x xxxxxx xx xxx xx xx xxx xxxxxxx xxx xxxxxxx, xxx x xxxx xxxxx xx xxxxxxx xxx xxxxxx xx xxx xxxxxxx xxxxxx.
    ```xaml
    <Button x:Name="Import" Content="Import Certificate (PFX file)" HorizontalAlignment="Left" Margin="352,305,0,0" VerticalAlignment="Top" Height="77" Width="260" Click="Import_Click" FontSize="16"/>
    <Button x:Name="Login" Content="Login" HorizontalAlignment="Left" Margin="611,305,0,0" VerticalAlignment="Top" Height="75" Width="240" Click="Login_Click" FontSize="16"/>
    <TextBlock x:Name="Result" HorizontalAlignment="Left" Margin="355,398,0,0" TextWrapping="Wrap" VerticalAlignment="Top" Height="153" Width="560"/>
    <PasswordBox x:Name="PfxPassword" HorizontalAlignment="Left" Margin="483,271,0,0" VerticalAlignment="Top" Width="229"/>
    <TextBlock HorizontalAlignment="Left" Margin="355,271,0,0" TextWrapping="Wrap" Text="PFX password" VerticalAlignment="Top" FontSize="18" Height="32" Width="123"/>
    <Button x:Name="Browse" Content="Browse for PFX file" HorizontalAlignment="Left" Margin="352,189,0,0" VerticalAlignment="Top" Click="Browse_Click" Width="499" Height="68" FontSize="16"/>
    <TextBlock HorizontalAlignment="Left" Margin="717,271,0,0" TextWrapping="Wrap" Text="(Optional)" VerticalAlignment="Top" Height="32" Width="83" FontSize="16"/>
    ```
    
3.  Xxxx xxx XxxxXxxx.xxxx xxxx.
4.  Xx xxx XxxxXxxx.xxxx.xx xxxx, xxx xxx xxxxxxxxx xxxxx xxxxxxxxxx.
    ```cs
    using Windows.Web.Http;
    using System.Text;
    using Windows.Security.Cryptography.Certificates;
    using Windows.Storage.Pickers;
    using Windows.Storage;
    using Windows.Storage.Streams;
    ```

5.  Xx xxx XxxxXxxx.xxxx.xx xxxx, xxx xxx xxxxxxxxx xxxxxxxxx xx xxx **XxxxXxxx** xxxxx. Xxxx xxxxxxx xxx xxxxxxx xxx xxx xxxxxxx "Xxxxx" xxxxxx xx xxxx "XxxxxXxxxxxxXxxx" xxx xxxxxxx, xxx x xxxxxx xxxxxxxx xxxx xxxxx x XXX xxxxxxxxxxx xx xxxxxx xxxx xxx xxxxxxxxxxx xxxxx. Xxxxxx xxx &xx;xxxxxx-xxxx&xx; xx xxx xxxxx-xxxxxxxxx xxxxxx xxxx xxx xxxx Xxxxxxxxx Xxxxxxxx Xxxxxxxxxxx Xxxxxx (XXX) xxxxxx.
    ```cs
    private Uri requestUri = new Uri("https://&lt;server-name&gt;/FirstContosoBank/Service1.asmx?op=Login");
    private string pfxCert = null;
    ```

6.  Xx xxx XxxxXxxx.xxxx.xx xxxx, xxx xxx xxxxxxxxx xxxxx xxxxxxx xxx xxx xxxxx xxxxxx xxx xxxxxx xx xxxxxx xxx xxxxxxx xxx xxxxxxx.
    ```cs
    private void Login_Click(object sender, RoutedEventArgs e)
    {
        MakeHttpsCall();
    }

    private async void MakeHttpsCall()
    {

        StringBuilder result = new StringBuilder("Login ");
        HttpResponseMessage response;
        try
        {
            Windows.Web.Http.HttpClient httpClient = new Windows.Web.Http.HttpClient();
            response = await httpClient.GetAsync(requestUri);
            if (response.StatusCode == HttpStatusCode.Ok)
            {
                result.Append("successful");
            }
            else
            {
                result = result.Append("failed with ");
                result = result.Append(response.StatusCode);
            }
        }
        catch (Exception ex)
        {
            result = result.Append("failed with ");
            result = result.Append(ex.Message);
        }

        Result.Text = result.ToString();
    }
    ```

7.  Xx xxx XxxxXxxx.xxxx.xx xxxx, xxx xxx xxxxxxxxx xxxxx xxxxxxxx xxx xxx xxxxxx xx xxxxxx xxx x XXX xxxx xxx xxx xxxxxx xx xxxxxx x xxxxxxxx XXX xxxx xxxx xxx xxxxxxxxxxx xxxxx.
    ```cs
    private async void Import_Click(object sender, RoutedEventArgs e)
    {
        try
        {
            Result.Text = "Importing selected certificate into user certificate store....";
            await CertificateEnrollmentManager.UserCertificateEnrollmentManager.ImportPfxDataAsync(
                pfxCert,
                PfxPassword.Password,
                ExportOption.Exportable,
                KeyProtectionLevel.NoConsent,
                InstallOptions.DeleteExpired,
                "Import Pfx");

            Result.Text = "Certificate import succeded";
        }
        catch (Exception ex)
        {
            Result.Text = "Certificate import failed with " + ex.Message;
        }
    }

    private async void Browse_Click(object sender, RoutedEventArgs e)
    {

        StringBuilder result = new StringBuilder("Pfx file selection ");
        FileOpenPicker pfxFilePicker = new FileOpenPicker();
        pfxFilePicker.FileTypeFilter.Add(".pfx");
        pfxFilePicker.CommitButtonText = "Open";
        try
        {
            StorageFile pfxFile = await pfxFilePicker.PickSingleFileAsync();
            if (pfxFile != null)
            {
                IBuffer buffer = await FileIO.ReadBufferAsync(pfxFile);
                using (DataReader dataReader = DataReader.FromBuffer(buffer))
                {
                    byte[] bytes = new byte[buffer.Length];
                    dataReader.ReadBytes(bytes);
                    pfxCert = System.Convert.ToBase64String(bytes);
                    PfxPassword.Password = string.Empty;
                    result.Append("succeeded");
                }
            }
            else
            {
                result.Append("failed");
            }
        }
        catch (Exception ex)
        {
            result.Append("failed with ");
            result.Append(ex.Message); ;
        }

        Result.Text = result.ToString();
    }
    ```

8.  Xxx xxxx xxx xxx xxx xx xx xxxx xxxxxxx xxx xxxxxxx xx xxxx xx xxxxxx x XXX xxxx xxxx xxx xxxxx xxxxxxxxxxx xxxxx.

Xxx xxx xxx xxxxx xxxxx xx xxxxxx xxxxxxxx xxxx xxxx xxx xxx xxxx xxxx xxxxxxxxxxx xx xxxxxx xxx xxxx xx xxxxxxxxx xxxxxxx xxx xxxxxxxx.

 

 




<!--HONumber=Mar16_HO1-->
